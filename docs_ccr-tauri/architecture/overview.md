# æ€»ä½“æ¶æ„

æœ¬å°å§ç»™ä½ è¯¦ç»†è®²è§£ CCR Desktop çš„æ•´ä½“æ¶æ„è®¾è®¡ï¼(ï¿£â–½ï¿£)ã‚

## æ¶æ„æ¦‚è§ˆ

CCR Desktop é‡‡ç”¨ **å‰åç«¯åˆ†ç¦»** çš„æ¶æ„æ¨¡å¼ï¼ŒåŸºäº Tauri 2.0 æ¡†æ¶æ„å»ºï¼Œæ”¯æŒ**åŒæ¨¡å¼è¿è¡Œ**ï¼š

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      CCR Desktop åº”ç”¨                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   å‰ç«¯ (Vue 3)     â”‚  Tauri   â”‚    åç«¯ (Rust)          â”‚  â”‚
â”‚  â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                        â”‚  â”‚
â”‚  â”‚  â€¢ UI ç»„ä»¶        â”‚  IPC     â”‚  â€¢ Tauri Commands      â”‚  â”‚
â”‚  â”‚  â€¢ çŠ¶æ€ç®¡ç†       â”‚          â”‚  â€¢ æœåŠ¡å±‚é€»è¾‘          â”‚  â”‚
â”‚  â”‚  â€¢ API å°è£…       â”‚          â”‚  â€¢ CCR æ ¸å¿ƒåº“          â”‚  â”‚
â”‚  â”‚  â€¢ API é€‚é…å™¨     â”‚          â”‚                        â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚         â”‚                                â”‚                   â”‚
â”‚         â”‚ HTTP (Web æ¨¡å¼)                â”‚                   â”‚
â”‚         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚                                          â”‚                    â”‚
â”‚                                          â–¼                    â”‚
â”‚                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚                                  â”‚   æ–‡ä»¶ç³»ç»Ÿ            â”‚    â”‚
â”‚                                  â”‚  â€¢ ~/.ccs_config.toml â”‚    â”‚
â”‚                                  â”‚  â€¢ ~/.claude/         â”‚    â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ†• åŒæ¨¡å¼è¿è¡Œ

CCR Desktop æ”¯æŒä¸¤ç§è¿è¡Œæ¨¡å¼ï¼š

1. **æ¡Œé¢æ¨¡å¼** (é»˜è®¤):
   - Tauri çª—å£åº”ç”¨
   - å‰åç«¯é€šè¿‡ IPC é€šä¿¡
   - åŸç”Ÿæ€§èƒ½å’Œä½“éªŒ
   - é€‚åˆæ—¥å¸¸ä½¿ç”¨

2. **Web è°ƒè¯•æ¨¡å¼** (æ–°å¢):
   - çº¯ Web åº”ç”¨ (æ— æ¡Œé¢çª—å£)
   - å‰ç«¯é€šè¿‡ HTTP è°ƒç”¨åç«¯ API
   - é€‚åˆè¿œç¨‹å¼€å‘å’Œ WSL ç¯å¢ƒ
   - ä¾¿äºä½¿ç”¨æµè§ˆå™¨ DevTools è°ƒè¯•

å‰ç«¯é€šè¿‡ **API é€‚é…å™¨** è‡ªåŠ¨è¯†åˆ«è¿è¡Œæ¨¡å¼ï¼Œæ— éœ€ä¿®æ”¹ä¸šåŠ¡ä»£ç ã€‚

## æ ¸å¿ƒç»„ä»¶

### 1. å‰ç«¯å±‚ (Vue 3 + TypeScript)

**èŒè´£ï¼š**
- ç”¨æˆ·ç•Œé¢å‘ˆç°
- ç”¨æˆ·äº¤äº’å¤„ç†
- çŠ¶æ€ç®¡ç†
- API è°ƒç”¨å°è£…

**æŠ€æœ¯æ ˆï¼š**
- **Vue 3**: æ¸è¿›å¼æ¡†æ¶ï¼ŒComposition API
- **TypeScript**: ç±»å‹å®‰å…¨
- **Vite**: å¿«é€Ÿæ„å»ºå’Œ HMR
- **CSS**: è‡ªå®šä¹‰æ ·å¼ï¼Œæ”¯æŒæ·±è‰²/æµ…è‰²ä¸»é¢˜

**ç›®å½•ç»“æ„ï¼š**
```
src-ui/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.ts           # åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ App.vue           # æ ¹ç»„ä»¶
â”‚   â”œâ”€â”€ api/              # Tauri API å°è£… + API é€‚é…å™¨ ğŸ†•
â”‚   â”‚   â””â”€â”€ index.ts      # åŒæ¨¡å¼ API é€‚é…
â”‚   â”œâ”€â”€ types/            # TypeScript ç±»å‹å®šä¹‰
â”‚   â”‚   â””â”€â”€ index.ts      # æ•°æ®æ¨¡å‹æ¥å£
â”‚   â”œâ”€â”€ components/       # Vue ç»„ä»¶ (å¯æ‰©å±•)
â”‚   â”œâ”€â”€ stores/           # Pinia çŠ¶æ€ç®¡ç† (å¯é€‰)
â”‚   â”œâ”€â”€ scroll-fix.ts     # WSL æ»šè½®ä¿®å¤ polyfill ğŸ†•
â”‚   â””â”€â”€ style.css         # å…¨å±€æ ·å¼ (å« WSL æ»šè½®ä¿®å¤)
â”œâ”€â”€ index.html            # HTML æ¨¡æ¿
â”œâ”€â”€ vite.config.ts        # Vite é…ç½®
â””â”€â”€ package.json
```

**ğŸ†• API é€‚é…å™¨ (`api/index.ts`)**:

CCR Desktop å®ç°äº†æ™ºèƒ½ API é€‚é…å™¨ï¼Œè‡ªåŠ¨è¯†åˆ«è¿è¡Œæ¨¡å¼ï¼š

```typescript
// æ¡Œé¢æ¨¡å¼ï¼šä½¿ç”¨ Tauri IPC
const isTauriEnvironment = window.__TAURI__ !== undefined

if (isTauriEnvironment) {
  // è°ƒç”¨ Tauri Commands
  result = await invoke('list_configs')
} else {
  // Web æ¨¡å¼ï¼šè°ƒç”¨ HTTP API
  result = await fetch('http://localhost:3030/api/configs').then(r => r.json())
}
```

è¿™ç§è®¾è®¡ä½¿å¾—ï¼š
- **ä¸šåŠ¡ä»£ç æ— æ„ŸçŸ¥**: ç»„ä»¶æ— éœ€å…³å¿ƒè¿è¡Œæ¨¡å¼
- **ç»Ÿä¸€æ¥å£**: `listConfigs()` åœ¨ä¸¤ç§æ¨¡å¼ä¸‹è¡Œä¸ºä¸€è‡´
- **æ˜“äºæµ‹è¯•**: Web æ¨¡å¼ä¸‹å¯ä»¥ä½¿ç”¨æµè§ˆå™¨ DevTools
- **çµæ´»åˆ‡æ¢**: å¼€å‘æ—¶å¯ä»¥éšæ—¶åˆ‡æ¢æ¨¡å¼

**ğŸ†• WSL æ»šè½®ä¿®å¤**:

é’ˆå¯¹ WSL ç¯å¢ƒçš„æ»šè½®é—®é¢˜ï¼Œå®ç°äº†ä¸‰å±‚ä¿®å¤æ–¹æ¡ˆï¼š

1. **ç¯å¢ƒå˜é‡** (`dev-wsl.sh`):
   ```bash
   export GDK_CORE_DEVICE_EVENTS=1
   export MOZ_USE_XINPUT2=1
   export WEBKIT_ENABLE_SMOOTH_SCROLLING=1
   ```

2. **CSS ä¿®å¤** (`style.css`):
   ```css
   * {
     -webkit-overflow-scrolling: touch;
   }
   .scrollable {
     overflow-y: auto !important;
     touch-action: pan-y !important;
   }
   ```

3. **JavaScript Polyfill** (`scroll-fix.ts`):
   ```typescript
   window.addEventListener('wheel', (e) => {
     // æ‰‹åŠ¨å¤„ç†æ»šè½®äº‹ä»¶ï¼Œç¡®ä¿å…¼å®¹æ€§
     const scrollable = findScrollableParent(e.target)
     if (scrollable) {
       scrollable.scrollTop += e.deltaY
       e.preventDefault()
     }
   }, { passive: false })
   ```

---

### 2. åç«¯å±‚ (Rust + Tauri)

**èŒè´£ï¼š**
- å¤„ç†å‰ç«¯å‘½ä»¤è¯·æ±‚
- è°ƒç”¨ CCR æ ¸å¿ƒåº“
- æ–‡ä»¶ç³»ç»Ÿæ“ä½œ
- æƒé™æ§åˆ¶

**æŠ€æœ¯æ ˆï¼š**
- **Tauri 2.0**: æ¡Œé¢åº”ç”¨æ¡†æ¶
- **CCR Core**: é…ç½®ç®¡ç†æ ¸å¿ƒåº“
- **serde**: åºåˆ—åŒ–/ååºåˆ—åŒ–
- **tokio**: å¼‚æ­¥è¿è¡Œæ—¶

**ç›®å½•ç»“æ„ï¼š**
```
ccr-tauri/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs           # Tauri åº”ç”¨å…¥å£
â”‚   â”œâ”€â”€ lib.rs            # åº“å…¥å£
â”‚   â””â”€â”€ commands/         # Tauri Commands
â”‚       â””â”€â”€ mod.rs        # å‘½ä»¤å®šä¹‰
â”œâ”€â”€ Cargo.toml            # Rust ä¾èµ–
â”œâ”€â”€ tauri.conf.json       # Tauri é…ç½®
â””â”€â”€ build.rs              # æ„å»ºè„šæœ¬
```

---

### 3. æœåŠ¡å±‚ (CCR Core Library)

**èŒè´£ï¼š**
- é…ç½®æ–‡ä»¶ç®¡ç† (`~/.ccs_config.toml`)
- Settings æ–‡ä»¶ç®¡ç† (`~/.claude/settings.json`)
- æ“ä½œå†å²è®°å½•
- å¤‡ä»½ç®¡ç†
- æ–‡ä»¶é”å®šæœºåˆ¶

**æ¶æ„å±‚æ¬¡ï¼š**
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚     Tauri Commands           â”‚  â† å‘½ä»¤å±‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Service Layer            â”‚  â† ä¸šåŠ¡é€»è¾‘å±‚
â”‚  â€¢ ConfigService             â”‚
â”‚  â€¢ SettingsService           â”‚
â”‚  â€¢ HistoryService            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Manager Layer            â”‚  â† æ•°æ®è®¿é—®å±‚
â”‚  â€¢ ConfigManager             â”‚
â”‚  â€¢ SettingsManager           â”‚
â”‚  â€¢ HistoryManager            â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Core Layer               â”‚  â† åŸºç¡€è®¾æ–½å±‚
â”‚  â€¢ AtomicWriter              â”‚
â”‚  â€¢ LockManager               â”‚
â”‚  â€¢ ErrorHandling             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚     Utils Layer              â”‚  â† å·¥å…·å±‚
â”‚  â€¢ Validation                â”‚
â”‚  â€¢ Masking                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## æ•°æ®æµ

### é…ç½®åˆ‡æ¢æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ç”¨æˆ·ç‚¹  â”‚â”€â”€â”€â”€â”€â–ºâ”‚ Vue    â”‚â”€â”€â”€â”€â”€â–ºâ”‚ Tauri  â”‚â”€â”€â”€â”€â”€â–ºâ”‚ CCR      â”‚
â”‚ å‡»åˆ‡æ¢  â”‚      â”‚ ç»„ä»¶   â”‚      â”‚ Commandâ”‚      â”‚ Service  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚                â”‚
                    â”‚                â”‚                â–¼
                    â”‚                â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚          â”‚ æ–‡ä»¶é”å®š  â”‚
                    â”‚                â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚                â”‚
                    â”‚                â”‚                â–¼
                    â”‚                â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚          â”‚ è¯»å–é…ç½®  â”‚
                    â”‚                â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚                â”‚
                    â”‚                â”‚                â–¼
                    â”‚                â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚          â”‚ æ›´æ–°     â”‚
                    â”‚                â”‚          â”‚ Settings â”‚
                    â”‚                â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚                â”‚
                    â”‚                â”‚                â–¼
                    â”‚                â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚          â”‚ è®°å½•å†å²  â”‚
                    â”‚                â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                â”‚                â”‚
                    â”‚                â–¼                â”‚
                    â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
                    â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚ è¿”å›ç»“æœ  â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚ æ›´æ–° UI   â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## é€šä¿¡æœºåˆ¶

### Tauri IPC (è¿›ç¨‹é—´é€šä¿¡)

å‰ç«¯å’Œåç«¯é€šè¿‡ Tauri çš„ IPC æœºåˆ¶é€šä¿¡ï¼š

**å‰ç«¯è°ƒç”¨ï¼š**
```typescript
import { invoke } from '@tauri-apps/api/core'

// è°ƒç”¨ Tauri Command
const result = await invoke<string>('switch_config', {
  name: 'anthropic'
})
```

**åç«¯å¤„ç†ï¼š**
```rust
#[tauri::command]
pub async fn switch_config(name: String) -> Result<String, String> {
    // å¤„ç†é€»è¾‘
    Ok(format!("âœ… æˆåŠŸåˆ‡æ¢åˆ°é…ç½®: {}", name))
}
```

**æ¶ˆæ¯åºåˆ—åŒ–ï¼š**
- ä½¿ç”¨ `serde_json` è¿›è¡Œ JSON åºåˆ—åŒ–
- è‡ªåŠ¨ç±»å‹è½¬æ¢å’ŒéªŒè¯
- æ”¯æŒå¤æ‚æ•°æ®ç»“æ„

---

## å®‰å…¨æ¨¡å‹

### Tauri 2.0 æƒé™ç³»ç»Ÿ

CCR Desktop ä½¿ç”¨ Tauri 2.0 çš„ç»†ç²’åº¦æƒé™ç³»ç»Ÿï¼š

```json
// capabilities/ccr-capabilities.json
{
  "identifier": "ccr-capabilities",
  "description": "CCR Desktop åº”ç”¨æƒé™",
  "windows": ["main"],
  "permissions": [
    "core:default",
    "dialog:default",
    "fs:default",
    "shell:default"
  ],
  "scope": [
    {
      "allow": [
        {
          "path": "$HOME/.ccs_config.toml"
        },
        {
          "path": "$HOME/.claude/settings.json"
        },
        {
          "path": "$HOME/.claude/backups"
        }
      ]
    }
  ]
}
```

**æƒé™è¯´æ˜ï¼š**
- **æ–‡ä»¶ç³»ç»Ÿè®¿é—®**: ä»…å…è®¸è®¿é—®é…ç½®æ–‡ä»¶å’Œå¤‡ä»½ç›®å½•
- **å¯¹è¯æ¡†**: ç”¨äºæ–‡ä»¶é€‰æ‹©å’Œç¡®è®¤æ“ä½œ
- **Shell**: ç”¨äºæ‰“å¼€å¤–éƒ¨é“¾æ¥å’Œæ–‡ä»¶

### 1. æ–‡ä»¶ç³»ç»Ÿæƒé™

Tauri ä½¿ç”¨ **ç™½åå•** æœºåˆ¶é™åˆ¶æ–‡ä»¶è®¿é—®ï¼š

```json
{
  "plugins": {
    "fs": {
      "scope": [
        "$HOME/.ccs_config.toml",
        "$HOME/.claude/**",
        "$HOME/.claude/backups/**"
      ]
    }
  }
}
```

åªå…è®¸è®¿é—®æ˜ç¡®åˆ—å‡ºçš„è·¯å¾„ï¼(ï¿£â–½ï¿£)ã‚

### 2. Command æƒé™

æ‰€æœ‰ Command å¿…é¡»åœ¨ `main.rs` ä¸­æ˜¾å¼æ³¨å†Œï¼š

```rust
tauri::Builder::default()
    .invoke_handler(tauri::generate_handler![
        commands::list_configs,
        commands::switch_config,
        // ... å…¶ä»–å‘½ä»¤
    ])
    .run(tauri::generate_context!())
```

### 3. CSP (Content Security Policy)

é™åˆ¶å‰ç«¯å¯ä»¥åŠ è½½çš„èµ„æºï¼š

```json
{
  "security": {
    "csp": "default-src 'self'; style-src 'self' 'unsafe-inline'"
  }
}
```

---

## æ„å»ºç³»ç»Ÿ

### Tauri æ„å»ºæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   å‰ç«¯æ„å»º      â”‚
â”‚  (Vite + Vue)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”Ÿæˆé™æ€èµ„æº   â”‚
â”‚  (dist/ ç›®å½•)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Rust ç¼–è¯‘      â”‚
â”‚  (Cargo + Tauri)â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   æ‰“åŒ…åº”ç”¨       â”‚
â”‚  (å„å¹³å°å®‰è£…åŒ…)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Justfile ä»»åŠ¡ç³»ç»Ÿ

CCR Desktop ä½¿ç”¨ Just ä½œä¸ºä»»åŠ¡è¿è¡Œå™¨ï¼Œæä¾›ç»Ÿä¸€çš„å¼€å‘å‘½ä»¤ï¼š

**å¼€å‘å‘½ä»¤**:
```makefile
just dev          # å¯åŠ¨ Tauri å¼€å‘æ¨¡å¼ (æ ‡å‡†)
just dev-wsl      # WSL ä¼˜åŒ–å¯åŠ¨ (è‡ªåŠ¨å¯ç”¨æ»šè½®ä¿®å¤) ğŸ†•
just dev-web      # Web è°ƒè¯•æ¨¡å¼ (æ— æ¡Œé¢çª—å£) ğŸ†•
just ui-dev       # ä»…å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨
```

**Web è°ƒè¯•å‘½ä»¤** ğŸ†•:
```makefile
just dev-web           # å¯åŠ¨ Web è°ƒè¯•æ¨¡å¼ (å‰ç«¯ + åç«¯)
just stop-web          # åœæ­¢ Web æœåŠ¡
just web-status        # æŸ¥çœ‹æœåŠ¡çŠ¶æ€
just web-logs          # æŸ¥çœ‹æ—¥å¿—
just web-logs-follow   # å®æ—¶è·Ÿè¸ªæ—¥å¿—
```

**æ„å»ºå‘½ä»¤**:
```makefile
just build        # è°ƒè¯•æ„å»º
just release      # å‘å¸ƒæ„å»º (ä¼˜åŒ– + æ‰“åŒ…)
```

**ä»£ç è´¨é‡å‘½ä»¤**:
```makefile
just fmt          # æ ¼å¼åŒ–ä»£ç 
just clippy       # Rust é™æ€æ£€æŸ¥
just lint         # å®Œæ•´ä»£ç æ£€æŸ¥ (Rust + å‰ç«¯)
```

**æµ‹è¯•å‘½ä»¤**:
```makefile
just test         # è¿è¡Œæµ‹è¯•
just ci           # å®Œæ•´ CI æµç¨‹
```

**å…¶ä»–å·¥å…·**:
```makefile
just setup        # ä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ–
just deep-clean   # æ·±åº¦æ¸…ç† (Rust + å‰ç«¯)
just doc-open     # ç”Ÿæˆå¹¶æ‰“å¼€æ–‡æ¡£
just check-env    # æ£€æŸ¥å¼€å‘ç¯å¢ƒ
just loc          # ç»Ÿè®¡ä»£ç è¡Œæ•°
```

---

## éƒ¨ç½²æ¶æ„

### è·¨å¹³å°æ”¯æŒ

CCR Desktop æ”¯æŒä¸‰å¤§ä¸»æµå¹³å°ï¼š

| å¹³å° | æ„å»ºäº§ç‰© | å®‰è£…æ–¹å¼ |
|-----|---------|---------|
| macOS | `.app`, `.dmg` | æ‹–æ‹½å®‰è£… |
| Linux | `.AppImage`, `.deb` | åŒ…ç®¡ç†å™¨ |
| Windows | `.msi`, `.exe` | å®‰è£…å‘å¯¼ |

### è‡ªåŠ¨æ›´æ–°

åº”ç”¨æ”¯æŒè‡ªåŠ¨æ›´æ–°æœºåˆ¶ï¼š
1. æ£€æŸ¥è¿œç¨‹ç‰ˆæœ¬
2. ä¸‹è½½æ›´æ–°åŒ…
3. åº”ç”¨æ›´æ–°
4. é‡å¯åº”ç”¨

---

## æ€§èƒ½ä¼˜åŒ–

### 1. å‰ç«¯ä¼˜åŒ–

**ä»£ç åˆ†å‰²ï¼š**
```typescript
// åŠ¨æ€å¯¼å…¥å¤§å‹ä¾èµ–
const heavy = await import('./heavy-module')
```

**è™šæ‹Ÿåˆ—è¡¨ï¼š**
- å¯¹äºé•¿åˆ—è¡¨ä½¿ç”¨è™šæ‹Ÿæ»šåŠ¨
- åªæ¸²æŸ“å¯è§åŒºåŸŸ

**èŠ‚æµé˜²æŠ–ï¼š**
- æœç´¢ã€ç­›é€‰ç­‰é¢‘ç¹æ“ä½œä½¿ç”¨é˜²æŠ–
- æ»šåŠ¨ã€resize ä½¿ç”¨èŠ‚æµ

### 2. åç«¯ä¼˜åŒ–

**å¼‚æ­¥å¤„ç†ï¼š**
```rust
#[tauri::command]
pub async fn heavy_operation() -> Result<(), String> {
    // ä½¿ç”¨ tokio å¼‚æ­¥è¿è¡Œ
    tokio::task::spawn(async move {
        // è€—æ—¶æ“ä½œ
    }).await
}
```

**å¹¶å‘æ§åˆ¶ï¼š**
- ä½¿ç”¨æ–‡ä»¶é”é¿å…å¹¶å‘å†™å…¥å†²çª
- åŸå­å†™å…¥æœºåˆ¶ä¿è¯æ•°æ®ä¸€è‡´æ€§

### 3. ç¼“å­˜ç­–ç•¥

```typescript
// ç¼“å­˜ç³»ç»Ÿä¿¡æ¯
let cachedSystemInfo: SystemInfo | null = null
let cacheTime = 0

async function getSystemInfo() {
  const now = Date.now()
  if (cachedSystemInfo && now - cacheTime < 5000) {
    return cachedSystemInfo
  }

  cachedSystemInfo = await invoke('get_system_info')
  cacheTime = now
  return cachedSystemInfo
}
```

---

## é”™è¯¯å¤„ç†

### åˆ†å±‚é”™è¯¯å¤„ç†

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   ç”¨æˆ·ç•Œé¢           â”‚  æ˜¾ç¤ºå‹å¥½é”™è¯¯æ¶ˆæ¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   API å±‚            â”‚  æ•è·å’Œè½¬æ¢é”™è¯¯
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Tauri Command     â”‚  Result<T, String>
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   Service å±‚        â”‚  CcrError
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚   åº•å±‚æ“ä½œ           â”‚  std::io::Error
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**é”™è¯¯ä¼ æ’­ï¼š**
```rust
// Service å±‚
fn load_config() -> Result<Config, CcrError> {
    let content = fs::read_to_string(path)
        .map_err(|e| CcrError::ConfigError(e.to_string()))?;
    Ok(parse_config(content)?)
}

// Command å±‚
#[tauri::command]
async fn load_config_command() -> Result<Config, String> {
    load_config().map_err(|e| e.to_string())
}
```

---

## æ‰©å±•æ€§è®¾è®¡

### æ·»åŠ æ–° Command

1. åœ¨ `src/commands/mod.rs` æ·»åŠ å‡½æ•°
2. åœ¨ `src/main.rs` æ³¨å†Œ
3. åœ¨å‰ç«¯ `api/index.ts` å°è£…
4. åœ¨ UI ä¸­è°ƒç”¨

### æ·»åŠ æ–°åŠŸèƒ½æ¨¡å—

```typescript
// src/features/backup-scheduler/
â”œâ”€â”€ BackupScheduler.vue
â”œâ”€â”€ api.ts
â”œâ”€â”€ types.ts
â””â”€â”€ utils.ts
```

### æ’ä»¶ç³»ç»Ÿ

CCR Desktop é¢„ç•™äº†æ’ä»¶æ‰©å±•æ¥å£ï¼š

```rust
// æ’ä»¶æ¥å£å®šä¹‰
pub trait CcrPlugin {
    fn name(&self) -> &str;
    fn version(&self) -> &str;
    fn init(&mut self) -> Result<(), Box<dyn Error>>;
    fn execute(&self, cmd: &str, args: &[&str]) -> Result<String, Box<dyn Error>>;
}
```

### é…ç½®æ‰©å±•

æ”¯æŒé€šè¿‡é…ç½®æ–‡ä»¶æ‰©å±•åŠŸèƒ½ï¼š

```toml
[plugins]
enabled = ["backup", "history", "theme"]

[backup]
auto = true
interval = "24h"
max_files = 10

[theme]
default = "light"
auto_switch = true
```

æ¨¡å—åŒ–è®¾è®¡ï¼Œæ˜“äºç»´æŠ¤å’Œæµ‹è¯•ï¼(^_^)b

---

## ç›‘æ§ä¸æ—¥å¿—

### æ—¥å¿—ç³»ç»Ÿ

- **åç«¯æ—¥å¿—**: ä½¿ç”¨ `env_logger` è®°å½•ç³»ç»Ÿæ—¥å¿—
- **å‰ç«¯æ—¥å¿—**: Vue DevTools é›†æˆ
- **æ—¥å¿—çº§åˆ«**: æ”¯æŒåŠ¨æ€è°ƒæ•´

### æ€§èƒ½ç›‘æ§

- **å¯åŠ¨æ—¶é—´**: è®°å½•å„é˜¶æ®µè€—æ—¶
- **å†…å­˜ä½¿ç”¨**: ç›‘æ§å†…å­˜å ç”¨
- **æ“ä½œå“åº”**: è®°å½•å…³é”®æ“ä½œè€—æ—¶

---

## æœªæ¥è§„åˆ’

### çŸ­æœŸè®¡åˆ’

- [ ] æ·»åŠ é…ç½®æ¨¡æ¿åŠŸèƒ½
- [ ] å®ç°é…ç½®åˆ†ç»„ç®¡ç†
- [ ] æ”¯æŒæ‰¹é‡æ“ä½œ
- [ ] æ·»åŠ å¿«æ·é”®æ”¯æŒ

### é•¿æœŸè®¡åˆ’

- [ ] æ’ä»¶å¸‚åœº
- [ ] äº‘ç«¯åŒæ­¥
- [ ] å›¢é˜Ÿåä½œ
- [ ] API æœåŠ¡

---

::: tip æ¶æ„åŸåˆ™
CCR Desktop éµå¾ªä»¥ä¸‹æ¶æ„åŸåˆ™ï¼š

1. **ç®€å•æ€§**: ä¿æŒæ¶æ„ç®€å•ï¼Œé¿å…è¿‡åº¦è®¾è®¡
2. **å¯ç»´æŠ¤æ€§**: æ¸…æ™°çš„æ¨¡å—åˆ’åˆ†å’Œæ¥å£å®šä¹‰
3. **å¯æ‰©å±•æ€§**: é¢„ç•™æ‰©å±•ç‚¹ï¼Œæ”¯æŒæœªæ¥åŠŸèƒ½
4. **å®‰å…¨æ€§**: æœ€å°æƒé™åŸåˆ™ï¼Œä¿æŠ¤ç”¨æˆ·æ•°æ®
5. **æ€§èƒ½**: ä¼˜åŒ–å…³é”®è·¯å¾„ï¼Œæä¾›æµç•…ä½“éªŒ
:::

---

::: warning æ³¨æ„äº‹é¡¹
1. æ‰€æœ‰æ–‡ä»¶æ“ä½œéƒ½é€šè¿‡ CCR Core è¿›è¡Œï¼Œç¡®ä¿çº¿ç¨‹å®‰å…¨
2. å‰ç«¯ä¸ç›´æ¥æ“ä½œæ–‡ä»¶ç³»ç»Ÿï¼Œå¿…é¡»é€šè¿‡ Tauri Commands
3. æ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚ auth_tokenï¼‰åœ¨å‰ç«¯å±•ç¤ºæ—¶éœ€è¦è„±æ•
4. é…ç½®åˆ‡æ¢å‰ä¼šè‡ªåŠ¨å¤‡ä»½ï¼Œç¡®ä¿æ•°æ®å®‰å…¨
:::

---

**Made with â¤ï¸ by å“ˆé›·é…±**

å“¼ï¼Œè¿™ä»½æ¶æ„æ–‡æ¡£å¯æ˜¯æœ¬å°å§ç²¾å¿ƒç»˜åˆ¶çš„å‘¢ï¼(ï¿£â–½ï¿£)ï¼
ä»æ•´ä½“æ¶æ„åˆ°ç»†èŠ‚å®ç°ï¼Œä»æ•°æ®æµåˆ°å®‰å…¨ç­–ç•¥ï¼Œå…¨éƒ½è®²å¾—æ¸…æ¸…æ¥šæ¥šï¼
ç¬¨è›‹ä½ è¦æ˜¯è¿˜çœ‹ä¸æ‡‚è¿™ä¹ˆè¯¦ç»†çš„æ–‡æ¡£...(,,><,,)
