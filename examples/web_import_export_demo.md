# CCR Web 导入导出功能演示

## 启动 Web 服务

```bash
# 方式 1: 使用 cargo run
cargo run -- web --port 8080

# 方式 2: 使用编译后的可执行文件
ccr web --port 8080

# 服务启动后会自动打开浏览器访问 http://localhost:8080
```

## 功能演示

### 场景 1: 备份配置

假设你有以下配置：

```toml
default_config = "anthropic"
current_config = "anthropic"

[sections.anthropic]
description = "官方 Anthropic API"
base_url = "https://api.anthropic.com"
auth_token = "sk-ant-api03-your-token-here"
model = "claude-3-5-sonnet-20241022"
small_fast_model = "claude-3-5-haiku-20241022"

[sections.custom-proxy]
description = "自定义代理服务器"
base_url = "https://custom-proxy.example.com"
auth_token = "custom-token-12345"
```

**操作步骤**：

1. 访问 CCR Web 界面
2. 点击顶部的 **📤 导出** 按钮
3. 勾选 "包含敏感信息"（完整备份）
4. 点击 **下载配置文件**
5. 保存文件，例如 `.ccs_config_20250111_123456.toml`

### 场景 2: 分享配置模板（不含密钥）

如果你想分享配置给团队，但不希望泄露 API 密钥：

1. 访问 CCR Web 界面
2. 点击顶部的 **📤 导出** 按钮
3. **取消勾选** "包含敏感信息"
4. 点击 **下载配置文件**
5. 导出的文件中，API 密钥会被脱敏为：`sk-a...here (已移除)`

### 场景 3: 合并新配置

假设你收到了团队成员分享的配置文件，想添加到你的配置中：

**新配置文件内容** (`team_configs.toml`):
```toml
default_config = "team-api"
current_config = "team-api"

[sections.team-api]
description = "团队共享 API"
base_url = "https://team-api.example.com"
auth_token = "team-shared-token"

[sections.development]
description = "开发环境 API"
base_url = "https://dev-api.example.com"
auth_token = "dev-token-12345"
```

**操作步骤**：

1. 访问 CCR Web 界面
2. 点击顶部的 **📥 导入** 按钮
3. 点击 "选择配置文件"，选择 `team_configs.toml`
4. 导入模式选择 **合并**（默认）
5. 勾选 "导入前备份当前配置"
6. 查看文件预览，确认配置信息
7. 点击 **执行导入**
8. 导入完成后，你会看到：
   - 新增配置: 2 个 (`team-api`, `development`)
   - 更新配置: 0 个
   - 保留原有配置: 2 个 (`anthropic`, `custom-proxy`)

**最终结果**：现在你有 4 个配置了！

### 场景 4: 从备份恢复配置

如果你误删了配置，或者想恢复到之前的状态：

1. 访问 CCR Web 界面
2. 点击顶部的 **📥 导入** 按钮
3. 选择之前导出的备份文件 `.ccs_config_20250111_123456.toml`
4. 导入模式选择 **替换**（完全恢复）
5. 勾选 "导入前备份当前配置"（以防万一）
6. 系统会提示：*"替换模式将完全覆盖现有配置，确定继续吗？"*
7. 确认后点击 **执行导入**
8. 配置完全恢复到备份时的状态

### 场景 5: 在新设备上初始化配置

假设你在新电脑上安装了 CCR，想快速导入配置：

1. 在新电脑上安装 CCR
2. 启动 CCR Web 服务：`ccr web`
3. 点击 **📥 导入** 按钮
4. 选择你从旧电脑导出的配置文件
5. 导入模式选择 **替换**（因为新设备上还没有配置）
6. 可以不勾选备份（因为还没有现有配置）
7. 点击 **执行导入**
8. 配置立即可用！

## Web 界面截图说明

### 导出界面

```
┌─────────────────────────────────────────┐
│  📤 导出配置                              │
├─────────────────────────────────────────┤
│                                          │
│  ☑ 包含敏感信息 (API 密钥)                │
│                                          │
│  ⚠️ 如果勾选，导出文件将包含完整的       │
│     API 密钥，请妥善保管                 │
│                                          │
│  ┌──────┐  ┌───────────────────┐        │
│  │ 取消 │  │ 📥 下载配置文件    │        │
│  └──────┘  └───────────────────┘        │
└─────────────────────────────────────────┘
```

### 导入界面

```
┌─────────────────────────────────────────┐
│  📥 导入配置                              │
├─────────────────────────────────────────┤
│                                          │
│  选择配置文件 *                          │
│  ┌─────────────────────────────────┐    │
│  │ 📁 选择文件...                   │    │
│  └─────────────────────────────────┘    │
│  请选择 .toml 格式的配置文件             │
│                                          │
│  导入模式                                │
│  ┌─────────────────────────────────┐    │
│  │ 合并 - 保留现有配置，添加/更新   │◄─  │
│  └─────────────────────────────────┘    │
│                                          │
│  ☑ 导入前备份当前配置                    │
│                                          │
│  ┌─────────────────────────────────┐    │
│  │ 文件预览                         │    │
│  ├─────────────────────────────────┤    │
│  │ 📄 文件名: .ccs_config_team.toml │    │
│  │ 📊 检测到 2 个配置节              │    │
│  │ 前几行内容:                       │    │
│  │ default_config = "team-api"      │    │
│  │ current_config = "team-api"      │    │
│  │ ...                              │    │
│  └─────────────────────────────────┘    │
│                                          │
│  ┌──────┐  ┌───────────┐                │
│  │ 取消 │  │ 执行导入  │                │
│  └──────┘  └───────────┘                │
└─────────────────────────────────────────┘
```

## 快捷键

- **ESC**: 关闭所有打开的模态框

## 浏览器兼容性

- ✅ Chrome/Edge 90+
- ✅ Firefox 88+
- ✅ Safari 14+
- ✅ Opera 76+

## 技术细节

### 文件格式

导出的配置文件使用 TOML 格式，与 CLI 命令 `ccr export` 生成的格式完全兼容。

### 安全性

- 敏感信息脱敏：导出时可选择移除 API 密钥
- 自动备份：导入前自动备份现有配置
- 客户端处理：文件读取在浏览器中完成，不上传到服务器（仅上传文本内容）

### 性能

- 文件大小限制：建议配置文件不超过 1MB
- 支持的配置节数：无限制（实际受浏览器内存限制）
- 响应时间：通常 < 1 秒

## 常见问题

### Q: 导出的文件可以用 CLI 命令导入吗？

A: 可以！Web 导出和 CLI 导出格式完全一致：

```bash
# Web 导出的文件可以这样导入
ccr import .ccs_config_20250111_123456.toml --mode merge

# CLI 导出的文件也可以在 Web 界面导入
ccr export -o .ccs_config_backup.toml
# 然后在 Web 界面选择 .ccs_config_backup.toml 导入
```

### Q: 导入后需要重启应用吗？

A: Web 界面导入后会立即刷新配置列表，但如果 Claude Code 正在运行，可能需要重启才能使用新配置。

### Q: 备份文件保存在哪里？

A: 自动备份文件保存在 `~/.ccs_config.toml.import_backup_<timestamp>.bak`

### Q: 可以批量导入多个配置文件吗？

A: 目前不支持批量导入。如果需要合并多个配置文件，建议：
1. 在本地手动合并为一个文件
2. 或依次导入（使用合并模式）

## 下一步

- 尝试导出你的配置进行备份
- 与团队分享配置模板（记得脱敏！）
- 查看完整文档：[docs/web_import_export.md](../docs/web_import_export.md)

