# ccr é¡¹ç›® Justfile(ç”¨äºå¿«é€Ÿæ‰§è¡Œå¸¸ç”¨å‘½ä»¤)ğŸ”§ğŸš€

# ä½¿ç”¨æŒ‡å— ğŸ“–
# - åœ¨ ccr ç›®å½•æ‰§è¡Œï¼š`just --list` æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
# - å¿«é€Ÿå¼€å‘ï¼š`just dev` æˆ– `just watch`(è‡ªåŠ¨é‡æ–°ç¼–è¯‘)
# - ä»£ç æ£€æŸ¥ï¼š`just lint` æˆ– `just ci`(å®Œæ•´ CI æµç¨‹)
# - æ„å»ºå‘å¸ƒç‰ˆï¼š`just release`
# - è¿è¡Œå¹¶ä¼ å‚ï¼š`just run -- --help` æˆ– `just run-release -- --version`
# - å®‰è£…åˆ°æœ¬åœ°ï¼š`just install`(å®‰è£…åˆ° ~/.cargo/bin)
# - å‰ç½®è¦æ±‚ï¼šå·²å®‰è£… Rust å·¥å…·é“¾(cargo, rustc)ğŸ¦€
# - å¦‚æœä½ æ›´æ”¹äº†äºŒè¿›åˆ¶å,è¯·åŒæ­¥ä¿®æ”¹ä¸‹æ–¹ BIN å˜é‡ âœï¸

# äºŒè¿›åˆ¶åç§°(ä¸ Cargo.toml [[bin]] ä¿æŒä¸€è‡´)
BIN := "ccr"

# ä½¿ç”¨ bash ä½œä¸ºæ‰§è¡Œå…¥å£ä»¥æå‡è·¨ shell çš„å¯ç§»æ¤æ€§ ğŸ§­
set shell := ["bash", "-cu"]

# ANSI é¢œè‰²ä»£ç 
BOLD := "\\033[1m"
CYAN := "\\033[36m"
GREEN := "\\033[32m"
YELLOW := "\\033[33m"
BLUE := "\\033[34m"
MAGENTA := "\\033[35m"
RED := "\\033[31m"
RESET := "\\033[0m"

# é»˜è®¤ä»»åŠ¡ï¼šæ˜¾ç¤ºå¸®åŠ©èœå• â„¹ï¸
default: help

# æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨ä»»åŠ¡ ğŸ“œ
help:
  @echo -e "{{CYAN}}{{BOLD}}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—{{RESET}}"
  @echo -e "{{CYAN}}{{BOLD}}â•‘           CCR Justfile - å¯ç”¨å‘½ä»¤åˆ—è¡¨                    â•‘{{RESET}}"
  @echo -e "{{CYAN}}{{BOLD}}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•{{RESET}}"
  @just --list

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ—ï¸  æ„å»ºå‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è°ƒè¯•æ„å»º(Debug æ¨¡å¼)ğŸ—ï¸
build:
  @echo -e "{{BLUE}}{{BOLD}}â–¶ å¼€å§‹è°ƒè¯•æ„å»º...{{RESET}}"
  @echo -e "{{BLUE}}  ç›®æ ‡: Debug æ¨¡å¼(åŒ…å«ç¬¦å·ä¿¡æ¯){{RESET}}"
  cargo build
  @echo -e "{{GREEN}}{{BOLD}}âœ“ è°ƒè¯•æ„å»ºå®Œæˆ{{RESET}} â†’ target/debug/{{BIN}}"

# å‘å¸ƒæ„å»º(Release ä¼˜åŒ–)âš¡
release:
  @echo -e "{{MAGENTA}}{{BOLD}}â–¶ å¼€å§‹å‘å¸ƒæ„å»º...{{RESET}}"
  @echo -e "{{MAGENTA}}  ç›®æ ‡: Release æ¨¡å¼(LTO ä¼˜åŒ– + ç¬¦å·å‰¥ç¦»){{RESET}}"
  cargo build --release
  @echo -e "{{GREEN}}{{BOLD}}âœ“ å‘å¸ƒæ„å»ºå®Œæˆ{{RESET}} â†’ target/release/{{BIN}}"
  @ls -lh target/release/{{BIN}} | awk '{print "  äºŒè¿›åˆ¶å¤§å°: " $$5}'

# å¿«é€Ÿç±»å‹æ£€æŸ¥(ä¸ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶)ğŸ©º
check:
  @echo -e "{{CYAN}}{{BOLD}}â–¶ è¿è¡Œç±»å‹æ£€æŸ¥...{{RESET}}"
  @echo -e "{{CYAN}}  æ¨¡å¼: å¿«é€ŸéªŒè¯(ä¸ç”ŸæˆäºŒè¿›åˆ¶){{RESET}}"
  cargo check
  @echo -e "{{GREEN}}{{BOLD}}âœ“ ç±»å‹æ£€æŸ¥é€šè¿‡{{RESET}}"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# â–¶ï¸  è¿è¡Œå‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è¿è¡Œç¨‹åº(å¯é€šè¿‡ -- ä¼ é€’å‚æ•°)â–¶ï¸ ç¤ºä¾‹ï¼š`just run -- --help`
run *args:
  @echo -e "{{BLUE}}{{BOLD}}â–¶ è¿è¡Œ Debug ç‰ˆæœ¬...{{RESET}}"
  @echo -e "{{BLUE}}  å‚æ•°: {{args}}{{RESET}}"
  cargo run -- {{args}}

# è¿è¡Œå‘å¸ƒç‰ˆäºŒè¿›åˆ¶(æ™ºèƒ½æ„å»º)ğŸš€
run-release *args:
  @echo -e "{{MAGENTA}}{{BOLD}}â–¶ è¿è¡Œ Release ç‰ˆæœ¬...{{RESET}}"
  @if [ ! -f target/release/{{BIN}} ]; then \
    echo -e "{{YELLOW}}  âš  Release äºŒè¿›åˆ¶ä¸å­˜åœ¨,å¼€å§‹æ„å»º...{{RESET}}"; \
    just release; \
  fi
  @echo -e "{{MAGENTA}}  å‚æ•°: {{args}}{{RESET}}"
  ./target/release/{{BIN}} {{args}}

# é€šè¿‡ç¨‹åºè¾“å‡ºç‰ˆæœ¬å· ğŸ·ï¸
version:
  @echo -e "{{CYAN}}{{BOLD}}â–¶ è·å–ç‰ˆæœ¬ä¿¡æ¯...{{RESET}}"
  @cargo run -- --version

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœ… æµ‹è¯•å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è¿è¡Œæµ‹è¯• âœ…
test:
  @echo -e "{{GREEN}}{{BOLD}}â–¶ è¿è¡Œæµ‹è¯•å¥—ä»¶...{{RESET}}"
  @echo -e "{{GREEN}}  æ¨¡å¼: æ ‡å‡†æµ‹è¯•{{RESET}}"
  cargo test
  @echo -e "{{GREEN}}{{BOLD}}âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡{{RESET}}"

# è¿è¡Œæ‰€æœ‰æµ‹è¯•(åŒ…æ‹¬å¿½ç•¥çš„æµ‹è¯•)ğŸ§ª
test-all:
  @echo -e "{{GREEN}}{{BOLD}}â–¶ è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶...{{RESET}}"
  @echo -e "{{GREEN}}  æ¨¡å¼: åŒ…å«è¢«å¿½ç•¥çš„æµ‹è¯•{{RESET}}"
  cargo test -- --include-ignored
  @echo -e "{{GREEN}}{{BOLD}}âœ“ å®Œæ•´æµ‹è¯•é€šè¿‡{{RESET}}"

# è¿è¡ŒåŸºå‡†æµ‹è¯• ğŸ“Š
bench:
  @echo -e "{{YELLOW}}{{BOLD}}â–¶ è¿è¡ŒåŸºå‡†æµ‹è¯•...{{RESET}}"
  cargo bench
  @echo -e "{{GREEN}}{{BOLD}}âœ“ åŸºå‡†æµ‹è¯•å®Œæˆ{{RESET}}"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœ¨ ä»£ç è´¨é‡å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ä»£ç æ ¼å¼åŒ– âœ¨
fmt:
  @echo -e "{{CYAN}}{{BOLD}}â–¶ æ ¼å¼åŒ–ä»£ç ...{{RESET}}"
  cargo fmt
  @echo -e "{{GREEN}}{{BOLD}}âœ“ ä»£ç æ ¼å¼åŒ–å®Œæˆ{{RESET}}"

# æ£€æŸ¥ä»£ç æ ¼å¼(ä¸ä¿®æ”¹æ–‡ä»¶)ğŸ”
fmt-check:
  @echo -e "{{CYAN}}{{BOLD}}â–¶ æ£€æŸ¥ä»£ç æ ¼å¼...{{RESET}}"
  @echo -e "{{CYAN}}  æ¨¡å¼: ä»…éªŒè¯,ä¸ä¿®æ”¹æ–‡ä»¶{{RESET}}"
  cargo fmt -- --check
  @echo -e "{{GREEN}}{{BOLD}}âœ“ ä»£ç æ ¼å¼ç¬¦åˆè§„èŒƒ{{RESET}}"

# é™æ€æ£€æŸ¥(Clippy),å°†è­¦å‘Šè§†ä¸ºé”™è¯¯ â—
clippy:
  @echo -e "{{YELLOW}}{{BOLD}}â–¶ è¿è¡Œ Clippy é™æ€æ£€æŸ¥...{{RESET}}"
  @echo -e "{{YELLOW}}  æ¨¡å¼: æ‰€æœ‰è­¦å‘Šè§†ä¸ºé”™è¯¯{{RESET}}"
  cargo clippy -- -D warnings
  @echo -e "{{GREEN}}{{BOLD}}âœ“ Clippy æ£€æŸ¥é€šè¿‡{{RESET}}"

# å®Œæ•´ä»£ç æ£€æŸ¥(æ ¼å¼åŒ– + Clippy)ğŸ”§
lint: fmt clippy
  @echo -e "{{GREEN}}{{BOLD}}âœ“ ä»£ç è´¨é‡æ£€æŸ¥å…¨éƒ¨é€šè¿‡{{RESET}}"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸš€ å¼€å‘å·¥ä½œæµå‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# å¿«é€Ÿå¼€å‘å¾ªç¯(æ£€æŸ¥ â†’ æµ‹è¯•)âš¡
dev: check test
  @echo -e "{{GREEN}}{{BOLD}}âœ“ å¼€å‘éªŒè¯å®Œæˆ{{RESET}}"

# ç›‘æ§æ–‡ä»¶å˜åŒ–å¹¶è‡ªåŠ¨é‡æ–°ç¼–è¯‘ ğŸ‘€
watch:
  @echo -e "{{BLUE}}{{BOLD}}â–¶ å¯åŠ¨æ–‡ä»¶ç›‘æ§æ¨¡å¼...{{RESET}}"
  @echo -e "{{BLUE}}  ä½¿ç”¨ cargo-watch (éœ€è¦å®‰è£…: cargo install cargo-watch){{RESET}}"
  @if ! command -v cargo-watch &> /dev/null; then \
    echo -e "{{RED}}âœ— cargo-watch æœªå®‰è£…{{RESET}}"; \
    echo -e "{{YELLOW}}  è¯·è¿è¡Œ: cargo install cargo-watch{{RESET}}"; \
    exit 1; \
  fi
  cargo watch -x check -x test

# å®Œæ•´ CI æµç¨‹(æ ¼å¼æ£€æŸ¥ + Clippy + æµ‹è¯• + æ„å»º)ğŸ¯
ci: fmt-check clippy test release
  @echo -e "{{GREEN}}{{BOLD}}â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—{{RESET}}"
  @echo -e "{{GREEN}}{{BOLD}}â•‘            âœ“ CI æµç¨‹å…¨éƒ¨é€šè¿‡                             â•‘{{RESET}}"
  @echo -e "{{GREEN}}{{BOLD}}â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•{{RESET}}"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“¦ å®‰è£…ä¸ç®¡ç†å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# å®‰è£…åˆ°æœ¬åœ°(~/.cargo/bin)ğŸ“¦
install:
  @echo -e "{{MAGENTA}}{{BOLD}}â–¶ å®‰è£…åˆ°æœ¬åœ°...{{RESET}}"
  @echo -e "{{MAGENTA}}  ç›®æ ‡è·¯å¾„: ~/.cargo/bin/{{BIN}}{{RESET}}"
  @echo -e "{{MAGENTA}}  æ¨¡å¼: é”å®šä¾èµ–ç‰ˆæœ¬ (--locked){{RESET}}"
  cargo install --path . --locked
  @echo -e "{{GREEN}}{{BOLD}}âœ“ å®‰è£…å®Œæˆ{{RESET}}"
  @which {{BIN}} && {{BIN}} --version

# å¼ºåˆ¶é‡æ–°å®‰è£… â™»ï¸
reinstall:
  @echo -e "{{MAGENTA}}{{BOLD}}â–¶ å¼ºåˆ¶é‡æ–°å®‰è£…...{{RESET}}"
  @echo -e "{{MAGENTA}}  æ¨¡å¼: è¦†ç›–ç°æœ‰å®‰è£…{{RESET}}"
  cargo install --path . --locked --force
  @echo -e "{{GREEN}}{{BOLD}}âœ“ é‡æ–°å®‰è£…å®Œæˆ{{RESET}}"
  @which {{BIN}} && {{BIN}} --version

# å¸è½½å·²å®‰è£…çš„äºŒè¿›åˆ¶ ğŸ—‘ï¸
uninstall:
  @echo -e "{{RED}}{{BOLD}}â–¶ å¸è½½ {{BIN}}...{{RESET}}"
  cargo uninstall {{BIN}}
  @echo -e "{{GREEN}}{{BOLD}}âœ“ å¸è½½å®Œæˆ{{RESET}}"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ“š æ–‡æ¡£å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ„å»ºæ–‡æ¡£(ä¸åŒ…å«ä¾èµ–)ğŸ“š
doc:
  @echo -e "{{CYAN}}{{BOLD}}â–¶ ç”Ÿæˆæ–‡æ¡£...{{RESET}}"
  @echo -e "{{CYAN}}  æ¨¡å¼: ä»…æœ¬é¡¹ç›®ä»£ç (--no-deps){{RESET}}"
  cargo doc --no-deps
  @echo -e "{{GREEN}}{{BOLD}}âœ“ æ–‡æ¡£ç”Ÿæˆå®Œæˆ{{RESET}}"

# æ„å»ºå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ–‡æ¡£ ğŸŒ
doc-open:
  @echo -e "{{CYAN}}{{BOLD}}â–¶ ç”Ÿæˆå¹¶æ‰“å¼€æ–‡æ¡£...{{RESET}}"
  cargo doc --no-deps --open

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ğŸ§¹ æ¸…ç†ä¸ç»´æŠ¤å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ¸…ç†æ„å»ºäº§ç‰© ğŸ§¹
clean:
  @echo -e "{{RED}}{{BOLD}}â–¶ æ¸…ç†æ„å»ºäº§ç‰©...{{RESET}}"
  @echo -e "{{RED}}  æ¸…ç†ç›®æ ‡: target/ ç›®å½•{{RESET}}"
  cargo clean
  @echo -e "{{GREEN}}{{BOLD}}âœ“ æ¸…ç†å®Œæˆ{{RESET}}"

# æ£€æŸ¥ä¾èµ–æ›´æ–° ğŸ“¦
update-deps:
  @echo -e "{{YELLOW}}{{BOLD}}â–¶ æ£€æŸ¥ä¾èµ–æ›´æ–°...{{RESET}}"
  @echo -e "{{YELLOW}}  ä½¿ç”¨ cargo-outdated (éœ€è¦å®‰è£…: cargo install cargo-outdated){{RESET}}"
  @if ! command -v cargo-outdated &> /dev/null; then \
    echo -e "{{RED}}âœ— cargo-outdated æœªå®‰è£…{{RESET}}"; \
    echo -e "{{YELLOW}}  è¯·è¿è¡Œ: cargo install cargo-outdated{{RESET}}"; \
    exit 1; \
  fi
  cargo outdated

# æ·±åº¦æ¸…ç†(åŒ…æ‹¬ Cargo ç¼“å­˜å’Œç›®æ ‡æ–‡ä»¶)ğŸ’£
deep-clean: clean
  @echo -e "{{RED}}{{BOLD}}â–¶ æ·±åº¦æ¸…ç†...{{RESET}}"
  @echo -e "{{RED}}  æ¸…ç† Cargo æ³¨å†Œè¡¨ç¼“å­˜{{RESET}}"
  rm -rf ~/.cargo/registry/index/*
  rm -rf ~/.cargo/registry/cache/*
  @echo -e "{{GREEN}}{{BOLD}}âœ“ æ·±åº¦æ¸…ç†å®Œæˆ{{RESET}}"