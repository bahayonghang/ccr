# ccr-tauri é¡¹ç›® Justfile (Tauri æ¡Œé¢åº”ç”¨æž„å»ºè„šæœ¬) ðŸš€ðŸ–¥ï¸

# ä½¿ç”¨æŒ‡å— ðŸ“–
# - åœ¨ ccr-tauri ç›®å½•æ‰§è¡Œï¼š`just --list` æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
# - å¿«é€Ÿå¼€å‘ï¼š`just dev` å¯åŠ¨ Tauri å¼€å‘æ¨¡å¼ (çƒ­é‡è½½)
# - æž„å»ºæ¡Œé¢åº”ç”¨ï¼š`just build` æˆ– `just release`
# - å‰ç«¯å¼€å‘ï¼š`just ui-dev` ä»…å¯åŠ¨å‰ç«¯æœåŠ¡å™¨
# - å®Œæ•´æ£€æŸ¥ï¼š`just ci` è¿è¡Œ CI æµç¨‹
# - å®‰è£…ä¾èµ–ï¼š`just setup` ä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ–
# - å‰ç½®è¦æ±‚ï¼šRust å·¥å…·é“¾ + Node.js 18+ ðŸ¦€ðŸ“¦

# äºŒè¿›åˆ¶åç§°
BIN := "ccr-tauri"
# å‰ç«¯ç›®å½•
UI_DIR := "src-ui"

# è·¨å¹³å° shell é…ç½® ðŸ§­
# Windows: ä½¿ç”¨ PowerShell, Linux/macOS: ä½¿ç”¨ç³»ç»Ÿ bash
set windows-shell := ["powershell.exe", "-NoLogo", "-Command"]
set shell := ["bash", "-cu"]

# é»˜è®¤ä»»åŠ¡ï¼šæ˜¾ç¤ºå¸®åŠ©èœå• â„¹ï¸
default: help

# æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨ä»»åŠ¡ ðŸ“œ
help:
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘        CCR Tauri Justfile - å¯ç”¨å‘½ä»¤åˆ—è¡¨                 â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  @just --list

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸš€ å¿«é€Ÿå¼€å§‹å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ– ðŸ“¦
setup:
  @echo "â–¶ è®¾ç½®å¼€å‘çŽ¯å¢ƒ..."
  @echo "  æ­¥éª¤ 1/3: å®‰è£… Tauri CLI"
  just _install-tauri-cli
  @echo "  æ­¥éª¤ 2/3: æ£€æŸ¥ Rust ä¾èµ–"
  cargo check
  @echo "  æ­¥éª¤ 3/3: å®‰è£…å‰ç«¯ä¾èµ–"
  npm install --prefix {{UI_DIR}}
  @echo "âœ“ çŽ¯å¢ƒè®¾ç½®å®Œæˆï¼çŽ°åœ¨å¯ä»¥è¿è¡Œ 'just dev' å¯åŠ¨å¼€å‘æ¨¡å¼"

# å†…éƒ¨ä»»åŠ¡ï¼šå®‰è£… Tauri CLIï¼ˆè·¨å¹³å°ï¼‰
_install-tauri-cli:
  cargo install tauri-cli --version "^2.0.0"

# å¼€å‘æ¨¡å¼ (Tauri Dev) - çƒ­é‡è½½æ”¯æŒ ðŸ”¥
dev:
  @echo "â–¶ å¯åŠ¨ Tauri å¼€å‘æ¨¡å¼..."
  @echo "  ç‰¹æ€§: Rust åŽç«¯ + Vue å‰ç«¯çƒ­é‡è½½"
  @echo "  å‰ç«¯åœ°å€: http://localhost:5173"
  just _check-node-modules
  cargo tauri dev

# å†…éƒ¨ä»»åŠ¡ï¼šæ£€æŸ¥å¹¶å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆè·¨å¹³å°ï¼‰
_check-node-modules:
  npm install --prefix {{UI_DIR}}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ—ï¸  æž„å»ºå‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è°ƒè¯•æž„å»º (Debug æ¨¡å¼) ðŸ—ï¸
build:
  @echo "â–¶ å¼€å§‹è°ƒè¯•æž„å»º..."
  @echo "  åŽç«¯: Rust Debug æ¨¡å¼"
  @echo "  å‰ç«¯: Vue ç”Ÿäº§æž„å»º"
  cargo build
  @echo "âœ“ è°ƒè¯•æž„å»ºå®Œæˆ â†’ target/debug/{{BIN}}"

# å‘å¸ƒæž„å»º (Release ä¼˜åŒ–) - ç”Ÿæˆå®‰è£…åŒ… âš¡
release:
  @echo "â–¶ å¼€å§‹å‘å¸ƒæž„å»º..."
  @echo "  æ¨¡å¼: Release ä¼˜åŒ– (LTO + ç¬¦å·å‰¥ç¦»)"
  @echo "  è¾“å‡º: è·¨å¹³å°å®‰è£…åŒ…"
  cargo tauri build
  @echo "âœ“ å‘å¸ƒæž„å»ºå®Œæˆ"
  @echo "  å®‰è£…åŒ…ä½ç½®: target/release/bundle/"
  @ls -lh target/release/{{BIN}} 2>/dev/null | awk '{print "  äºŒè¿›åˆ¶å¤§å°: " $$5}' || true

# å¿«é€Ÿç±»åž‹æ£€æŸ¥ (ä¸ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶) ðŸ©º
check:
  @echo "â–¶ è¿è¡Œ Rust ç±»åž‹æ£€æŸ¥..."
  cargo check
  @echo "âœ“ Rust ç±»åž‹æ£€æŸ¥é€šè¿‡"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸŽ¨ å‰ç«¯å¼€å‘å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# å®‰è£…å‰ç«¯ä¾èµ– ðŸ“¦
ui-install:
  @echo "â–¶ å®‰è£…å‰ç«¯ä¾èµ–..."
  npm install --prefix {{UI_DIR}}
  @echo "âœ“ å‰ç«¯ä¾èµ–å®‰è£…å®Œæˆ"

# ä»…å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ (æ—  Tauri) ðŸŽ¨
ui-dev:
  @echo "â–¶ å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨..."
  @echo "  åœ°å€: http://localhost:5173"
  @echo "  æ³¨æ„: è¿™åªæ˜¯å‰ç«¯é¢„è§ˆï¼ŒTauri Commands ä¸å¯ç”¨"
  npm run dev --prefix {{UI_DIR}}

# å‰ç«¯ç”Ÿäº§æž„å»º ðŸ“¦
ui-build:
  @echo "â–¶ æž„å»ºå‰ç«¯ç”Ÿäº§ç‰ˆæœ¬..."
  npm run build --prefix {{UI_DIR}}
  @echo "âœ“ å‰ç«¯æž„å»ºå®Œæˆ â†’ {{UI_DIR}}/dist"

# å‰ç«¯ TypeScript ç±»åž‹æ£€æŸ¥ âœ…
ui-check:
  @echo "â–¶ æ£€æŸ¥å‰ç«¯ TypeScript ç±»åž‹..."
  npx --prefix {{UI_DIR}} vue-tsc --noEmit
  @echo "âœ“ TypeScript ç±»åž‹æ£€æŸ¥é€šè¿‡"

# å‰ç«¯é¢„è§ˆç”Ÿäº§æž„å»º ðŸ‘€
ui-preview:
  @echo "â–¶ é¢„è§ˆå‰ç«¯ç”Ÿäº§æž„å»º..."
  @if [ ! -d "{{UI_DIR}}/dist" ]; then \
    echo "  âš  æœªæ‰¾åˆ°æž„å»ºäº§ç‰©ï¼Œæ­£åœ¨æž„å»º..."; \
    just ui-build; \
  fi
  npm run preview --prefix {{UI_DIR}}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœ… æµ‹è¯•å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è¿è¡Œ Rust æµ‹è¯• âœ…
test:
  @echo "â–¶ è¿è¡Œ Rust æµ‹è¯•å¥—ä»¶..."
  cargo test
  @echo "âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡"

# è¿è¡Œæ‰€æœ‰æµ‹è¯• (åŒ…æ‹¬å¿½ç•¥çš„æµ‹è¯•) ðŸ§ª
test-all:
  @echo "â–¶ è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶..."
  cargo test -- --include-ignored
  @echo "âœ“ å®Œæ•´æµ‹è¯•é€šè¿‡"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœ¨ ä»£ç è´¨é‡å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Rust ä»£ç æ ¼å¼åŒ– âœ¨
fmt:
  @echo "â–¶ æ ¼å¼åŒ– Rust ä»£ç ..."
  cargo fmt
  @echo "âœ“ Rust ä»£ç æ ¼å¼åŒ–å®Œæˆ"

# æ£€æŸ¥ Rust ä»£ç æ ¼å¼ (ä¸ä¿®æ”¹æ–‡ä»¶) ðŸ”
fmt-check:
  @echo "â–¶ æ£€æŸ¥ Rust ä»£ç æ ¼å¼..."
  cargo fmt -- --check
  @echo "âœ“ Rust ä»£ç æ ¼å¼ç¬¦åˆè§„èŒƒ"

# Rust é™æ€æ£€æŸ¥ (Clippy) â—
clippy:
  @echo "â–¶ è¿è¡Œ Clippy é™æ€æ£€æŸ¥..."
  @echo "  æ¨¡å¼: æ‰€æœ‰è­¦å‘Šè§†ä¸ºé”™è¯¯"
  cargo clippy --all-targets --all-features -- -D warnings
  @echo "âœ“ Clippy æ£€æŸ¥é€šè¿‡"

# å®Œæ•´ä»£ç æ£€æŸ¥ (Rust + å‰ç«¯) ðŸ”§
lint: fmt clippy ui-check
  @echo "âœ“ ä»£ç è´¨é‡æ£€æŸ¥å…¨éƒ¨é€šè¿‡"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸš€ å¼€å‘å·¥ä½œæµå‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# å¿«é€Ÿå¼€å‘å¾ªçŽ¯ (æ£€æŸ¥ â†’ æµ‹è¯•) âš¡
quick: check test
  @echo "âœ“ å¼€å‘éªŒè¯å®Œæˆ"

# å®Œæ•´ CI æµç¨‹ (æ ¼å¼æ£€æŸ¥ + Clippy + æµ‹è¯• + å‰ç«¯æ£€æŸ¥) ðŸŽ¯
ci: fmt-check clippy test ui-check
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘            âœ“ CI æµç¨‹å…¨éƒ¨é€šè¿‡                             â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# å‘å¸ƒå‰æ£€æŸ¥ (CI + æž„å»ºæµ‹è¯•) ðŸš¢
pre-release: ci
  @echo "â–¶ æ‰§è¡Œå‘å¸ƒå‰æ£€æŸ¥..."
  @echo "  æ­¥éª¤: æµ‹è¯•å‘å¸ƒæž„å»º"
  just release
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘          âœ“ å‘å¸ƒå‰æ£€æŸ¥å…¨éƒ¨é€šè¿‡                           â•‘"
  @echo "â•‘          å‡†å¤‡å‘å¸ƒåˆ°ç”Ÿäº§çŽ¯å¢ƒ                             â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“š æ–‡æ¡£å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æž„å»º Rust æ–‡æ¡£ (ä¸åŒ…å«ä¾èµ–) ðŸ“š
doc:
  @echo "â–¶ ç”Ÿæˆ Rust æ–‡æ¡£..."
  cargo doc --no-deps
  @echo "âœ“ æ–‡æ¡£ç”Ÿæˆå®Œæˆ"

# æž„å»ºå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ–‡æ¡£ ðŸŒ
doc-open:
  @echo "â–¶ ç”Ÿæˆå¹¶æ‰“å¼€ Rust æ–‡æ¡£..."
  cargo doc --no-deps --open

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ§¹ æ¸…ç†ä¸Žç»´æŠ¤å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ¸…ç† Rust æž„å»ºäº§ç‰© ðŸ§¹
clean:
  @echo "â–¶ æ¸…ç† Rust æž„å»ºäº§ç‰©..."
  cargo clean
  @echo "âœ“ Rust æž„å»ºæ¸…ç†å®Œæˆ"

# æ¸…ç†å‰ç«¯æž„å»ºäº§ç‰© ðŸ§¹
ui-clean:
  @echo "â–¶ æ¸…ç†å‰ç«¯æž„å»ºäº§ç‰©..."
  rm -rf {{UI_DIR}}/dist
  rm -rf {{UI_DIR}}/node_modules
  rm -f {{UI_DIR}}/package-lock.json
  @echo "âœ“ å‰ç«¯æž„å»ºæ¸…ç†å®Œæˆ"

# æ·±åº¦æ¸…ç† (Rust + å‰ç«¯) ðŸ’£
deep-clean: clean ui-clean
  @echo "â–¶ æ·±åº¦æ¸…ç†å®Œæˆ"
  @echo "  æç¤º: è¿è¡Œ 'just setup' é‡æ–°å®‰è£…ä¾èµ–"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ”§ å®žç”¨å·¥å…·å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ ðŸ·ï¸
version:
  @echo "â–¶ ç‰ˆæœ¬ä¿¡æ¯"
  @echo "  Cargo.toml:"
  @grep '^version' Cargo.toml | head -1
  @echo "  package.json:"
  @grep '"version"' {{UI_DIR}}/package.json | head -1
  @echo "  tauri.conf.json:"
  @grep '"version"' tauri.conf.json | head -1

# æ£€æŸ¥çŽ¯å¢ƒä¾èµ– ðŸ”
check-env:
  @echo "â–¶ æ£€æŸ¥å¼€å‘çŽ¯å¢ƒ..."
  @echo "  Rust:"
  @rustc --version
  @cargo --version
  @echo "  Node.js:"
  @node --version
  @npm --version
  @echo "  Tauri CLI:"
  @if command -v cargo-tauri &> /dev/null; then \
    cargo tauri --version; \
  else \
    echo "  âš  æœªå®‰è£… - è¿è¡Œ 'just install-tauri-cli' å®‰è£…"; \
  fi
  @echo "âœ“ çŽ¯å¢ƒæ£€æŸ¥å®Œæˆ"

# å®‰è£… Tauri CLI ðŸ”§
install-tauri-cli:
  @echo "â–¶ å®‰è£… Tauri CLI..."
  @echo "  ç‰ˆæœ¬: 2.x (æœ€æ–°ç¨³å®šç‰ˆ)"
  cargo install tauri-cli --version "^2.0.0"
  @echo "âœ“ Tauri CLI å®‰è£…å®Œæˆ"
  @cargo tauri --version

# æŸ¥çœ‹æž„å»ºäº§ç‰© ðŸ“¦
list-bundles:
  @echo "â–¶ æž„å»ºäº§ç‰©åˆ—è¡¨"
  @if [ -d "target/release/bundle" ]; then \
    find target/release/bundle -type f \( -name "*.dmg" -o -name "*.app" -o -name "*.AppImage" -o -name "*.deb" -o -name "*.msi" \) -exec ls -lh {} \; | awk '{print "  " $$9 " (" $$5 ")"}'; \
  else \
    echo "  æœªæ‰¾åˆ°æž„å»ºäº§ç‰©ï¼Œè¯·å…ˆè¿è¡Œ 'just release'"; \
  fi

# ç»Ÿè®¡ä»£ç è¡Œæ•° ðŸ“Š
loc:
  @echo "â–¶ ä»£ç ç»Ÿè®¡"
  @echo "  Rust åŽç«¯:"
  @find src -name "*.rs" | xargs wc -l | tail -1 | awk '{print "    " $$1 " è¡Œ"}'
  @echo "  Vue å‰ç«¯:"
  @find {{UI_DIR}}/src -name "*.vue" -o -name "*.ts" | xargs wc -l 2>/dev/null | tail -1 | awk '{print "    " $$1 " è¡Œ"}' || echo "    0 è¡Œ"
  @echo "  æ€»è®¡:"
  @(find src -name "*.rs"; find {{UI_DIR}}/src -name "*.vue" -o -name "*.ts" 2>/dev/null) | xargs wc -l 2>/dev/null | tail -1 | awk '{print "    " $$1 " è¡Œ"}' || echo "    ç»Ÿè®¡ä¸­..."
