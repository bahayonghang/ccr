# ccr-tauri é¡¹ç›® Justfile (Tauri æ¡Œé¢åº”ç”¨æž„å»ºè„šæœ¬) ðŸš€ðŸ–¥ï¸

# ä½¿ç”¨æŒ‡å— ðŸ“–
# - åœ¨ ccr-tauri ç›®å½•æ‰§è¡Œï¼š`just --list` æŸ¥çœ‹æ‰€æœ‰ä»»åŠ¡
# - æ¡Œé¢å¼€å‘ï¼š`just dev` å¯åŠ¨ Tauri å¼€å‘æ¨¡å¼ (çƒ­é‡è½½)
# - WSL ä¼˜åŒ–ï¼š`just dev-wsl` WSL çŽ¯å¢ƒä¼˜åŒ–å¯åŠ¨
# - Web è°ƒè¯•ï¼š`just dev-web` å‰ç«¯+åŽç«¯,æ— æ¡Œé¢çª—å£ ðŸŒ
# - æž„å»ºæ¡Œé¢åº”ç”¨ï¼š`just build` æˆ– `just release`
# - å‰ç«¯å¼€å‘ï¼š`just ui-dev` ä»…å¯åŠ¨å‰ç«¯æœåŠ¡å™¨
# - å®Œæ•´æ£€æŸ¥ï¼š`just ci` è¿è¡Œ CI æµç¨‹
# - å®‰è£…ä¾èµ–ï¼š`just setup` ä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ–
# - å‰ç½®è¦æ±‚ï¼šRust å·¥å…·é“¾ + Node.js 18+ ðŸ¦€ðŸ“¦

# äºŒè¿›åˆ¶åç§°
BIN := "ccr-tauri"
# å‰ç«¯ç›®å½•
UI_DIR := "src-ui"

# è·¨å¹³å° shell é…ç½® ðŸ§­
# Windows: ä½¿ç”¨ PowerShell, Linux/macOS: ä½¿ç”¨ç³»ç»Ÿ bash
set windows-shell := ["powershell.exe", "-NoLogo", "-Command"]
set shell := ["bash", "-cu"]

# é»˜è®¤ä»»åŠ¡ï¼šæ˜¾ç¤ºå¸®åŠ©èœå• â„¹ï¸
default: help

# æ˜¾ç¤ºæ‰€æœ‰å¯ç”¨ä»»åŠ¡ ðŸ“œ
help:
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘        CCR Tauri Justfile - å¯ç”¨å‘½ä»¤åˆ—è¡¨                 â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  @just --list

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸš€ å¿«é€Ÿå¼€å§‹å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ä¸€é”®å®‰è£…æ‰€æœ‰ä¾èµ– ðŸ“¦
setup:
  @echo "â–¶ è®¾ç½®å¼€å‘çŽ¯å¢ƒ..."
  @echo "  æ­¥éª¤ 1/3: å®‰è£… Tauri CLI"
  just _install-tauri-cli
  @echo "  æ­¥éª¤ 2/3: æ£€æŸ¥ Rust ä¾èµ–"
  cargo check
  @echo "  æ­¥éª¤ 3/3: å®‰è£…å‰ç«¯ä¾èµ–"
  npm install --prefix {{UI_DIR}}
  @echo "âœ“ çŽ¯å¢ƒè®¾ç½®å®Œæˆï¼çŽ°åœ¨å¯ä»¥è¿è¡Œ 'just dev' å¯åŠ¨å¼€å‘æ¨¡å¼"

# å†…éƒ¨ä»»åŠ¡ï¼šå®‰è£… Tauri CLIï¼ˆè·¨å¹³å°ï¼‰
_install-tauri-cli:
  cargo install tauri-cli --version "^2.0.0"

# å¼€å‘æ¨¡å¼ (Tauri Dev) - çƒ­é‡è½½æ”¯æŒ ðŸ”¥
dev:
  @echo "â–¶ å¯åŠ¨ Tauri å¼€å‘æ¨¡å¼..."
  @echo "  ç‰¹æ€§: Rust åŽç«¯ + Vue å‰ç«¯çƒ­é‡è½½"
  @echo "  å‰ç«¯åœ°å€: http://localhost:5173"
  just _check-node-modules
  cargo tauri dev

# WSL ä¼˜åŒ–å¼€å‘æ¨¡å¼ (æŠ‘åˆ¶å›¾å½¢è­¦å‘Š) ðŸªŸðŸ§
dev-wsl:
  @echo "â–¶ å¯åŠ¨ Tauri å¼€å‘æ¨¡å¼ (WSL ä¼˜åŒ–)..."
  @echo "  ç‰¹æ€§: Rust åŽç«¯ + Vue å‰ç«¯çƒ­é‡è½½"
  @echo "  å‰ç«¯åœ°å€: http://localhost:5173"
  @echo "  ðŸ”§ å·²æŠ‘åˆ¶ libEGL/Mesa è­¦å‘Š"
  just _check-node-modules
  ./dev-wsl.sh

# Web è°ƒè¯•æ¨¡å¼ (å‰ç«¯+åŽç«¯,æ— æ¡Œé¢çª—å£) ðŸŒðŸ”§
dev-web:
  @echo "â–¶ å¯åŠ¨ Web è°ƒè¯•æ¨¡å¼..."
  @echo "  ç‰¹æ€§: å‰ç«¯ + åŽç«¯ API æœåŠ¡ï¼Œæ— æ¡Œé¢çª—å£"
  @echo "  å‰ç«¯åœ°å€: http://localhost:5173"
  @echo "  åŽç«¯ API: http://localhost:3030"
  @echo "  ðŸŒ é€‚ç”¨äºŽ WSL/è¿œç¨‹æœåŠ¡å™¨è°ƒè¯•"
  @echo ""
  just _check-node-modules
  just _start-web-servers

# Web è°ƒè¯•æ¨¡å¼ (ä»…å‰ç«¯,ä¸´æ—¶æ–¹æ¡ˆ) ðŸŒðŸš§
dev-web-frontend-only:
  @echo "â–¶ å¯åŠ¨ Web è°ƒè¯•æ¨¡å¼ (ä»…å‰ç«¯)..."
  @echo "  ç‰¹æ€§: å‰ç«¯ç•Œé¢é¢„è§ˆï¼ŒAPI è°ƒç”¨ä¼šå¤±è´¥"
  @echo "  å‰ç«¯åœ°å€: http://localhost:5173"
  @echo "  ðŸš§ ä¸´æ—¶æ–¹æ¡ˆï¼šåŽç«¯ API æš‚æ—¶ä¸å¯ç”¨"
  @echo ""
  just _check-node-modules
  @echo "ðŸŽ¨ å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨..."
  @npm run dev --prefix {{UI_DIR}} &
  @sleep 3
  @echo ""
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘  ðŸŒ Web å‰ç«¯è°ƒè¯•æ¨¡å¼å·²å¯åŠ¨                               â•‘"
  @echo "â•‘                                                           â•‘"
  @echo "â•‘  ðŸŽ¨ å‰ç«¯ç•Œé¢: http://localhost:5173                       â•‘"
  @echo "â•‘  âš ï¸  æ³¨æ„: API åŠŸèƒ½ä¸å¯ç”¨ï¼Œä»…ç”¨äºŽ UI æµ‹è¯•                  â•‘"
  @echo "â•‘                                                           â•‘"
  @echo "â•‘  ðŸ’¡ ç”¨é€”:                                                  â•‘"
  @echo "â•‘    - æµ‹è¯•ç•Œé¢å¸ƒå±€å’Œæ ·å¼                                   â•‘"
  @echo "â•‘    - éªŒè¯æ»šè½®ä¿®å¤æ•ˆæžœ                                     â•‘"
  @echo "â•‘    - å“åº”å¼è®¾è®¡æµ‹è¯•                                       â•‘"
  @echo "â•‘                                                           â•‘"
  @echo "â•‘  ðŸ”§ å®Œæ•´åŠŸèƒ½è¯·ä½¿ç”¨ 'just dev-wsl'                         â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  @echo ""

# å†…éƒ¨ä»»åŠ¡ï¼šå¯åŠ¨å‰åŽç«¯ Web æœåŠ¡å™¨ï¼ˆå¹¶å‘æ¨¡å¼ï¼‰
_start-web-servers:
  #!/usr/bin/env bash
  set -e
  
  # æ¸…ç†æ—§çš„ PID æ–‡ä»¶
  rm -f /tmp/ccr-web.pid /tmp/vite-dev.pid /tmp/ccr-web.log /tmp/vite-dev.log
  
  echo "ðŸ“¡ å¯åŠ¨åŽç«¯ API æœåŠ¡å™¨ (ç«¯å£ 3030)..."
  cd .. && nohup ccr web -p 3030 > /tmp/ccr-web.log 2>&1 & echo $! > /tmp/ccr-web.pid
  sleep 1
  
  echo "ðŸŽ¨ å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ (ç«¯å£ 5173)..."
  nohup npm run dev --prefix {{UI_DIR}} > /tmp/vite-dev.log 2>&1 & echo $! > /tmp/vite-dev.pid
  sleep 3
  
  echo ""
  echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  echo "â•‘  ðŸŒ Web è°ƒè¯•æ¨¡å¼å·²å¯åŠ¨                                   â•‘"
  echo "â•‘                                                           â•‘"
  echo "â•‘  ðŸŽ¨ å‰ç«¯ç•Œé¢: http://localhost:5173                       â•‘"
  echo "â•‘  ðŸ“¡ åŽç«¯ API: http://localhost:3030                       â•‘"
  echo "â•‘                                                           â•‘"
  echo "â•‘  ðŸ’¡ ä½¿ç”¨æ–¹æ³•:                                              â•‘"
  echo "â•‘    1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ http://localhost:5173                â•‘"
  echo "â•‘    2. F12 æ‰“å¼€ DevTools æŸ¥çœ‹ Network è¯·æ±‚                 â•‘"
  echo "â•‘    3. å‰ç«¯è°ƒç”¨åŽç«¯ API è¿›è¡Œé…ç½®æ“ä½œ                       â•‘"
  echo "â•‘                                                           â•‘"
  echo "â•‘  ðŸ“‹ å®žæ—¶æ—¥å¿—:                                              â•‘"
  echo "â•‘    tail -f /tmp/ccr-web.log    (åŽç«¯ API æ—¥å¿—)            â•‘"
  echo "â•‘    tail -f /tmp/vite-dev.log   (å‰ç«¯æž„å»ºæ—¥å¿—)             â•‘"
  echo "â•‘                                                           â•‘"
  echo "â•‘  ðŸ“Š è¿›ç¨‹çŠ¶æ€:                                              â•‘"
  echo "â•‘    ps aux | grep -E '(ccr web|vite)'                      â•‘"
  echo "â•‘                                                           â•‘"
  echo "â•‘  â¹ï¸  åœæ­¢æœåŠ¡: just stop-web                              â•‘"
  echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  echo ""
  
  # æ˜¾ç¤ºå¯åŠ¨çŠ¶æ€
  if kill -0 $(cat /tmp/ccr-web.pid) 2>/dev/null; then
    echo "âœ… åŽç«¯æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ (PID: $(cat /tmp/ccr-web.pid))"
  else
    echo "âŒ åŽç«¯æœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—: cat /tmp/ccr-web.log"
  fi
  
  if kill -0 $(cat /tmp/vite-dev.pid) 2>/dev/null; then
    echo "âœ… å‰ç«¯æœåŠ¡å™¨å¯åŠ¨æˆåŠŸ (PID: $(cat /tmp/vite-dev.pid))"
  else
    echo "âŒ å‰ç«¯æœåŠ¡å™¨å¯åŠ¨å¤±è´¥ï¼ŒæŸ¥çœ‹æ—¥å¿—: cat /tmp/vite-dev.log"
  fi
  
  echo ""
  echo "ðŸŒ åœ¨æµè§ˆå™¨ä¸­è®¿é—®: http://localhost:5173"
  echo "ðŸ’¡ åœæ­¢æœåŠ¡ä½¿ç”¨: just stop-web"

# åœæ­¢ Web è°ƒè¯•æ¨¡å¼çš„æ‰€æœ‰æœåŠ¡ â¹ï¸
stop-web:
  @echo "â–¶ åœæ­¢ Web è°ƒè¯•æœåŠ¡..."
  @if [ -f "/tmp/ccr-web.pid" ]; then \
    kill $(cat /tmp/ccr-web.pid) 2>/dev/null || true; \
    rm -f /tmp/ccr-web.pid; \
    echo "  âœ“ CCR Web æœåŠ¡å™¨å·²åœæ­¢"; \
  fi
  @if [ -f "/tmp/vite-dev.pid" ]; then \
    kill $(cat /tmp/vite-dev.pid) 2>/dev/null || true; \
    rm -f /tmp/vite-dev.pid; \
    echo "  âœ“ Vite å¼€å‘æœåŠ¡å™¨å·²åœæ­¢"; \
  fi
  @rm -f /tmp/ccr-web.log /tmp/vite-dev.log
  @pkill -f "ccr web" 2>/dev/null || true
  @pkill -f "vite.*5173" 2>/dev/null || true
  @echo "âœ“ æ‰€æœ‰ Web è°ƒè¯•æœåŠ¡å·²åœæ­¢"

# æŸ¥çœ‹ Web è°ƒè¯•æ¨¡å¼æœåŠ¡çŠ¶æ€ ðŸ“Š
web-status:
  @echo "â–¶ Web è°ƒè¯•æœåŠ¡çŠ¶æ€..."
  @echo ""
  @if [ -f "/tmp/ccr-web.pid" ] && kill -0 $(cat /tmp/ccr-web.pid) 2>/dev/null; then \
    echo "âœ… åŽç«¯ API æœåŠ¡å™¨ (PID: $(cat /tmp/ccr-web.pid))"; \
    echo "   ðŸ“¡ http://localhost:3030"; \
  else \
    echo "âŒ åŽç«¯ API æœåŠ¡å™¨æœªè¿è¡Œ"; \
  fi
  @if [ -f "/tmp/vite-dev.pid" ] && kill -0 $(cat /tmp/vite-dev.pid) 2>/dev/null; then \
    echo "âœ… å‰ç«¯å¼€å‘æœåŠ¡å™¨ (PID: $(cat /tmp/vite-dev.pid))"; \
    echo "   ðŸŽ¨ http://localhost:5173"; \
  else \
    echo "âŒ å‰ç«¯å¼€å‘æœåŠ¡å™¨æœªè¿è¡Œ"; \
  fi
  @echo ""
  @echo "ðŸ“Š ç«¯å£ç›‘å¬çŠ¶æ€:"
  @ss -tuln | grep -E "(3030|5173)" | awk '{print "   " $5 " â†’ " $1}' || echo "   æ— ç›¸å…³ç«¯å£ç›‘å¬"

# æŸ¥çœ‹ Web è°ƒè¯•æ—¥å¿— ðŸ“‹
web-logs:
  @echo "â–¶ Web è°ƒè¯•æ—¥å¿—..."
  @echo ""
  @if [ -f "/tmp/ccr-web.log" ]; then \
    echo "ðŸ“¡ åŽç«¯ API æ—¥å¿— (æœ€è¿‘ 20 è¡Œ):"; \
    echo "   æ–‡ä»¶: /tmp/ccr-web.log"; \
    tail -20 /tmp/ccr-web.log | sed 's/^/   /'; \
    echo ""; \
  fi
  @if [ -f "/tmp/vite-dev.log" ]; then \
    echo "ðŸŽ¨ å‰ç«¯å¼€å‘æ—¥å¿— (æœ€è¿‘ 20 è¡Œ):"; \
    echo "   æ–‡ä»¶: /tmp/vite-dev.log"; \
    tail -20 /tmp/vite-dev.log | sed 's/^/   /'; \
  fi

# å®žæ—¶è·Ÿè¸ª Web è°ƒè¯•æ—¥å¿— ðŸ“Š
web-logs-follow:
  @echo "â–¶ å®žæ—¶è·Ÿè¸ª Web è°ƒè¯•æ—¥å¿— (Ctrl+C é€€å‡º)..."
  @echo ""
  @if [ -f "/tmp/ccr-web.log" ] && [ -f "/tmp/vite-dev.log" ]; then \
    echo "åŒæ—¶è·Ÿè¸ªå‰ç«¯å’ŒåŽç«¯æ—¥å¿—:"; \
    tail -f /tmp/ccr-web.log /tmp/vite-dev.log; \
  elif [ -f "/tmp/ccr-web.log" ]; then \
    echo "è·Ÿè¸ªåŽç«¯æ—¥å¿—:"; \
    tail -f /tmp/ccr-web.log; \
  elif [ -f "/tmp/vite-dev.log" ]; then \
    echo "è·Ÿè¸ªå‰ç«¯æ—¥å¿—:"; \
    tail -f /tmp/vite-dev.log; \
  else \
    echo "âŒ æœªæ‰¾åˆ°æ—¥å¿—æ–‡ä»¶ï¼Œè¯·å…ˆè¿è¡Œ 'just dev-web'"; \
  fi

# å†…éƒ¨ä»»åŠ¡ï¼šæ£€æŸ¥å¹¶å®‰è£…å‰ç«¯ä¾èµ–ï¼ˆè·¨å¹³å°ï¼‰
_check-node-modules:
  npm install --prefix {{UI_DIR}}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ—ï¸  æž„å»ºå‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è°ƒè¯•æž„å»º (Debug æ¨¡å¼) ðŸ—ï¸
build:
  @echo "â–¶ å¼€å§‹è°ƒè¯•æž„å»º..."
  @echo "  åŽç«¯: Rust Debug æ¨¡å¼"
  @echo "  å‰ç«¯: Vue ç”Ÿäº§æž„å»º"
  cargo build
  @echo "âœ“ è°ƒè¯•æž„å»ºå®Œæˆ â†’ target/debug/{{BIN}}"

# å‘å¸ƒæž„å»º (Release ä¼˜åŒ–) - ç”Ÿæˆå®‰è£…åŒ… âš¡
release:
  @echo "â–¶ å¼€å§‹å‘å¸ƒæž„å»º..."
  @echo "  æ¨¡å¼: Release ä¼˜åŒ– (LTO + ç¬¦å·å‰¥ç¦»)"
  @echo "  è¾“å‡º: è·¨å¹³å°å®‰è£…åŒ…"
  cargo tauri build
  @echo "âœ“ å‘å¸ƒæž„å»ºå®Œæˆ"
  @echo "  å®‰è£…åŒ…ä½ç½®: target/release/bundle/"
  @ls -lh target/release/{{BIN}} 2>/dev/null | awk '{print "  äºŒè¿›åˆ¶å¤§å°: " $$5}' || true

# å¿«é€Ÿç±»åž‹æ£€æŸ¥ (ä¸ç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶) ðŸ©º
check:
  @echo "â–¶ è¿è¡Œ Rust ç±»åž‹æ£€æŸ¥..."
  cargo check
  @echo "âœ“ Rust ç±»åž‹æ£€æŸ¥é€šè¿‡"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸŽ¨ å‰ç«¯å¼€å‘å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# å®‰è£…å‰ç«¯ä¾èµ– ðŸ“¦
ui-install:
  @echo "â–¶ å®‰è£…å‰ç«¯ä¾èµ–..."
  npm install --prefix {{UI_DIR}}
  @echo "âœ“ å‰ç«¯ä¾èµ–å®‰è£…å®Œæˆ"

# ä»…å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨ (æ—  Tauri) ðŸŽ¨
ui-dev:
  @echo "â–¶ å¯åŠ¨å‰ç«¯å¼€å‘æœåŠ¡å™¨..."
  @echo "  åœ°å€: http://localhost:5173"
  @echo "  æ³¨æ„: è¿™åªæ˜¯å‰ç«¯é¢„è§ˆï¼ŒTauri Commands ä¸å¯ç”¨"
  npm run dev --prefix {{UI_DIR}}

# å‰ç«¯ç”Ÿäº§æž„å»º ðŸ“¦
ui-build:
  @echo "â–¶ æž„å»ºå‰ç«¯ç”Ÿäº§ç‰ˆæœ¬..."
  npm run build --prefix {{UI_DIR}}
  @echo "âœ“ å‰ç«¯æž„å»ºå®Œæˆ â†’ {{UI_DIR}}/dist"

# å‰ç«¯ TypeScript ç±»åž‹æ£€æŸ¥ âœ…
ui-check:
  @echo "â–¶ æ£€æŸ¥å‰ç«¯ TypeScript ç±»åž‹..."
  npx --prefix {{UI_DIR}} vue-tsc --noEmit
  @echo "âœ“ TypeScript ç±»åž‹æ£€æŸ¥é€šè¿‡"

# å‰ç«¯é¢„è§ˆç”Ÿäº§æž„å»º ðŸ‘€
ui-preview:
  @echo "â–¶ é¢„è§ˆå‰ç«¯ç”Ÿäº§æž„å»º..."
  @if [ ! -d "{{UI_DIR}}/dist" ]; then \
    echo "  âš  æœªæ‰¾åˆ°æž„å»ºäº§ç‰©ï¼Œæ­£åœ¨æž„å»º..."; \
    just ui-build; \
  fi
  npm run preview --prefix {{UI_DIR}}

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœ… æµ‹è¯•å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# è¿è¡Œ Rust æµ‹è¯• âœ…
test:
  @echo "â–¶ è¿è¡Œ Rust æµ‹è¯•å¥—ä»¶..."
  cargo test
  @echo "âœ“ æ‰€æœ‰æµ‹è¯•é€šè¿‡"

# è¿è¡Œæ‰€æœ‰æµ‹è¯• (åŒ…æ‹¬å¿½ç•¥çš„æµ‹è¯•) ðŸ§ª
test-all:
  @echo "â–¶ è¿è¡Œå®Œæ•´æµ‹è¯•å¥—ä»¶..."
  cargo test -- --include-ignored
  @echo "âœ“ å®Œæ•´æµ‹è¯•é€šè¿‡"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# âœ¨ ä»£ç è´¨é‡å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# Rust ä»£ç æ ¼å¼åŒ– âœ¨
fmt:
  @echo "â–¶ æ ¼å¼åŒ– Rust ä»£ç ..."
  cargo fmt
  @echo "âœ“ Rust ä»£ç æ ¼å¼åŒ–å®Œæˆ"

# æ£€æŸ¥ Rust ä»£ç æ ¼å¼ (ä¸ä¿®æ”¹æ–‡ä»¶) ðŸ”
fmt-check:
  @echo "â–¶ æ£€æŸ¥ Rust ä»£ç æ ¼å¼..."
  cargo fmt -- --check
  @echo "âœ“ Rust ä»£ç æ ¼å¼ç¬¦åˆè§„èŒƒ"

# Rust é™æ€æ£€æŸ¥ (Clippy) â—
clippy:
  @echo "â–¶ è¿è¡Œ Clippy é™æ€æ£€æŸ¥..."
  @echo "  æ¨¡å¼: æ‰€æœ‰è­¦å‘Šè§†ä¸ºé”™è¯¯"
  cargo clippy --all-targets --all-features -- -D warnings
  @echo "âœ“ Clippy æ£€æŸ¥é€šè¿‡"

# å®Œæ•´ä»£ç æ£€æŸ¥ (Rust + å‰ç«¯) ðŸ”§
lint: fmt clippy ui-check
  @echo "âœ“ ä»£ç è´¨é‡æ£€æŸ¥å…¨éƒ¨é€šè¿‡"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸš€ å¼€å‘å·¥ä½œæµå‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# å¿«é€Ÿå¼€å‘å¾ªçŽ¯ (æ£€æŸ¥ â†’ æµ‹è¯•) âš¡
quick: check test
  @echo "âœ“ å¼€å‘éªŒè¯å®Œæˆ"

# å®Œæ•´ CI æµç¨‹ (æ ¼å¼æ£€æŸ¥ + Clippy + æµ‹è¯• + å‰ç«¯æ£€æŸ¥) ðŸŽ¯
ci: fmt-check clippy test ui-check
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘            âœ“ CI æµç¨‹å…¨éƒ¨é€šè¿‡                             â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# å‘å¸ƒå‰æ£€æŸ¥ (CI + æž„å»ºæµ‹è¯•) ðŸš¢
pre-release: ci
  @echo "â–¶ æ‰§è¡Œå‘å¸ƒå‰æ£€æŸ¥..."
  @echo "  æ­¥éª¤: æµ‹è¯•å‘å¸ƒæž„å»º"
  just release
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘          âœ“ å‘å¸ƒå‰æ£€æŸ¥å…¨éƒ¨é€šè¿‡                           â•‘"
  @echo "â•‘          å‡†å¤‡å‘å¸ƒåˆ°ç”Ÿäº§çŽ¯å¢ƒ                             â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“š æ–‡æ¡£å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æž„å»º Rust æ–‡æ¡£ (ä¸åŒ…å«ä¾èµ–) ðŸ“š
doc:
  @echo "â–¶ ç”Ÿæˆ Rust æ–‡æ¡£..."
  cargo doc --no-deps
  @echo "âœ“ æ–‡æ¡£ç”Ÿæˆå®Œæˆ"

# æž„å»ºå¹¶åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€æ–‡æ¡£ ðŸŒ
doc-open:
  @echo "â–¶ ç”Ÿæˆå¹¶æ‰“å¼€ Rust æ–‡æ¡£..."
  cargo doc --no-deps --open

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ§¹ æ¸…ç†ä¸Žç»´æŠ¤å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ¸…ç† Rust æž„å»ºäº§ç‰© ðŸ§¹
clean:
  @echo "â–¶ æ¸…ç† Rust æž„å»ºäº§ç‰©..."
  cargo clean
  @echo "âœ“ Rust æž„å»ºæ¸…ç†å®Œæˆ"

# æ¸…ç†å‰ç«¯æž„å»ºäº§ç‰© ðŸ§¹
ui-clean:
  @echo "â–¶ æ¸…ç†å‰ç«¯æž„å»ºäº§ç‰©..."
  rm -rf {{UI_DIR}}/dist
  rm -rf {{UI_DIR}}/node_modules
  rm -f {{UI_DIR}}/package-lock.json
  @echo "âœ“ å‰ç«¯æž„å»ºæ¸…ç†å®Œæˆ"

# æ·±åº¦æ¸…ç† (Rust + å‰ç«¯) ðŸ’£
deep-clean: clean ui-clean
  @echo "â–¶ æ·±åº¦æ¸…ç†å®Œæˆ"
  @echo "  æç¤º: è¿è¡Œ 'just setup' é‡æ–°å®‰è£…ä¾èµ–"

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ”§ å®žç”¨å·¥å…·å‘½ä»¤
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ ðŸ·ï¸
version:
  @echo "â–¶ ç‰ˆæœ¬ä¿¡æ¯"
  @echo "  Cargo.toml:"
  @grep '^version' Cargo.toml | head -1
  @echo "  package.json:"
  @grep '"version"' {{UI_DIR}}/package.json | head -1
  @echo "  tauri.conf.json:"
  @grep '"version"' tauri.conf.json | head -1

# æ£€æŸ¥çŽ¯å¢ƒä¾èµ– ðŸ”
check-env:
  @echo "â–¶ æ£€æŸ¥å¼€å‘çŽ¯å¢ƒ..."
  @echo "  Rust:"
  @rustc --version
  @cargo --version
  @echo "  Node.js:"
  @node --version
  @npm --version
  @echo "  Tauri CLI:"
  @if command -v cargo-tauri &> /dev/null; then \
    cargo tauri --version; \
  else \
    echo "  âš  æœªå®‰è£… - è¿è¡Œ 'just install-tauri-cli' å®‰è£…"; \
  fi
  @echo "âœ“ çŽ¯å¢ƒæ£€æŸ¥å®Œæˆ"

# å®‰è£… Tauri CLI ðŸ”§
install-tauri-cli:
  @echo "â–¶ å®‰è£… Tauri CLI..."
  @echo "  ç‰ˆæœ¬: 2.x (æœ€æ–°ç¨³å®šç‰ˆ)"
  cargo install tauri-cli --version "^2.0.0"
  @echo "âœ“ Tauri CLI å®‰è£…å®Œæˆ"
  @cargo tauri --version

# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
# ðŸ“¦ æ™ºèƒ½æ‰“åŒ…å‘½ä»¤ï¼ˆè·¨å¹³å°æ”¯æŒï¼‰
# â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

# ðŸš€ æ™ºèƒ½æ‰“åŒ… - æ ¹æ®å½“å‰ç³»ç»Ÿè‡ªåŠ¨é€‰æ‹©æ‰“åŒ…ç›®æ ‡
package:
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘           ðŸ“¦ CCR Desktop æ™ºèƒ½æ‰“åŒ…ç³»ç»Ÿ                    â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  @echo ""
  just _detect-and-package

# å†…éƒ¨ä»»åŠ¡ï¼šæ£€æµ‹ç³»ç»Ÿå¹¶æ‰§è¡Œå¯¹åº”çš„æ‰“åŒ…
_detect-and-package:
  #!/usr/bin/env bash
  set -e
  
  OS_TYPE=$(uname -s)
  
  echo "ðŸ” æ£€æµ‹å½“å‰ç³»ç»Ÿ: $OS_TYPE"
  echo ""
  
  case "$OS_TYPE" in
    Linux*)
      echo "ðŸ§ æ£€æµ‹åˆ° Linux ç³»ç»Ÿ"
      just package-linux
      ;;
    Darwin*)
      echo "ðŸŽ æ£€æµ‹åˆ° macOS ç³»ç»Ÿ"
      just package-macos
      ;;
    MINGW*|MSYS*|CYGWIN*)
      echo "ðŸªŸ æ£€æµ‹åˆ° Windows ç³»ç»Ÿ"
      just package-windows
      ;;
    *)
      echo "âŒ æœªè¯†åˆ«çš„ç³»ç»Ÿ: $OS_TYPE"
      echo "ðŸ’¡ è¯·æ‰‹åŠ¨ä½¿ç”¨ 'just package-linux'ã€'just package-macos' æˆ– 'just package-windows'"
      exit 1
      ;;
  esac

# ðŸ§ Linux æ‰“åŒ… - ç”Ÿæˆ .deb + .AppImage
package-linux:
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘              ðŸ§ Linux å¹³å°æ‰“åŒ…                            â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  @echo ""
  @echo "ðŸ“¦ ç”Ÿæˆæ ¼å¼: .deb (Debian/Ubuntu) + .rpm (Fedora/RedHat)"
  @echo "ðŸ”§ ä¼˜åŒ–: LTO + ç¬¦å·å‰¥ç¦»"
  @echo ""
  just _check-node-modules
  @echo "ðŸŽ¨ æž„å»ºå‰ç«¯..."
  npm run build --prefix {{UI_DIR}}
  @echo ""
  @echo "ðŸ¦€ æž„å»º Tauri åº”ç”¨..."
  cargo tauri build --bundles deb,rpm
  @echo ""
  @echo "âœ… Linux æ‰“åŒ…å®Œæˆï¼"
  @echo ""
  just _show-linux-bundles

# ðŸŽ macOS æ‰“åŒ… - ç”Ÿæˆ .app + .dmg
package-macos:
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘              ðŸŽ macOS å¹³å°æ‰“åŒ…                            â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  @echo ""
  @echo "ðŸ“¦ ç”Ÿæˆæ ¼å¼: .app (åº”ç”¨åŒ…) + .dmg (å®‰è£…é•œåƒ)"
  @echo "ðŸ”§ ä¼˜åŒ–: LTO + ç¬¦å·å‰¥ç¦»"
  @echo ""
  just _check-node-modules
  @echo "ðŸŽ¨ æž„å»ºå‰ç«¯..."
  npm run build --prefix {{UI_DIR}}
  @echo ""
  @echo "ðŸ¦€ æž„å»º Tauri åº”ç”¨..."
  cargo tauri build --bundles app,dmg
  @echo ""
  @echo "âœ… macOS æ‰“åŒ…å®Œæˆï¼"
  @echo ""
  just _show-macos-bundles

# ðŸªŸ Windows æ‰“åŒ… - ç”Ÿæˆ .msi + .exe
package-windows:
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘             ðŸªŸ Windows å¹³å°æ‰“åŒ…                           â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  @echo ""
  @echo "ðŸ“¦ ç”Ÿæˆæ ¼å¼: .msi (å®‰è£…åŒ…) + .nsis (NSIS å®‰è£…ç¨‹åº)"
  @echo "ðŸ”§ ä¼˜åŒ–: LTO + ç¬¦å·å‰¥ç¦»"
  @echo ""
  just _check-node-modules
  @echo "ðŸŽ¨ æž„å»ºå‰ç«¯..."
  npm run build --prefix {{UI_DIR}}
  @echo ""
  @echo "ðŸ¦€ æž„å»º Tauri åº”ç”¨..."
  cargo tauri build --bundles msi,nsis
  @echo ""
  @echo "âœ… Windows æ‰“åŒ…å®Œæˆï¼"
  @echo ""
  just _show-windows-bundles

# ðŸŒ å…¨å¹³å°æ‰“åŒ… (éœ€è¦äº¤å‰ç¼–è¯‘å·¥å…·é“¾)
package-all:
  @echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
  @echo "â•‘           ðŸŒ å…¨å¹³å°æ‰“åŒ…ï¼ˆå®žéªŒæ€§ï¼‰                        â•‘"
  @echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
  @echo ""
  @echo "âš ï¸  æ³¨æ„: è·¨å¹³å°æ‰“åŒ…éœ€è¦é…ç½®å¯¹åº”çš„å·¥å…·é“¾"
  @echo ""
  @echo "ðŸ”§ æŽ¨èæ–¹æ¡ˆ:"
  @echo "  1. åœ¨ Linux ä¸Šæž„å»º Linux åŒ…"
  @echo "  2. åœ¨ macOS ä¸Šæž„å»º macOS åŒ…"
  @echo "  3. åœ¨ Windows ä¸Šæž„å»º Windows åŒ…"
  @echo ""
  @echo "ðŸ“‹ æˆ–ä½¿ç”¨ GitHub Actions CI/CD è‡ªåŠ¨åŒ–æž„å»º"
  @echo ""
  just package

# å†…éƒ¨ä»»åŠ¡ï¼šæ˜¾ç¤º Linux æž„å»ºäº§ç‰©
_show-linux-bundles:
  #!/usr/bin/env bash
  echo "ðŸ“¦ æž„å»ºäº§ç‰©ä½ç½®:"
  echo ""
  
  BUNDLE_DIR="target/release/bundle"
  
  if [ -d "$BUNDLE_DIR/deb" ]; then
    echo "  ðŸ“„ Debian åŒ… (.deb):"
    find "$BUNDLE_DIR/deb" -name "*.deb" -exec ls -lh {} \; | awk '{print "    â†’ " $$9 " [" $$5 "]"}'
  fi
  
  if [ -d "$BUNDLE_DIR/appimage" ]; then
    echo "  ðŸ“¦ AppImage åŒ…:"
    find "$BUNDLE_DIR/appimage" -name "*.AppImage" -exec ls -lh {} \; | awk '{print "    â†’ " $$9 " [" $$5 "]"}'
  fi
  
  if [ -d "$BUNDLE_DIR/rpm" ]; then
    echo "  ðŸ“¦ RPM åŒ… (.rpm):"
    find "$BUNDLE_DIR/rpm" -name "*.rpm" -exec ls -lh {} \; | awk '{print "    â†’ " $$9 " [" $$5 "]"}'
  fi
  
  echo ""
  echo "ðŸ’¡ å®‰è£…æ–¹æ³•:"
  echo "  Debian/Ubuntu: sudo dpkg -i ccr-desktop_*.deb"
  echo "  é€šç”¨ Linux:    chmod +x ccr-desktop_*.AppImage && ./ccr-desktop_*.AppImage"

# å†…éƒ¨ä»»åŠ¡ï¼šæ˜¾ç¤º macOS æž„å»ºäº§ç‰©
_show-macos-bundles:
  #!/usr/bin/env bash
  echo "ðŸ“¦ æž„å»ºäº§ç‰©ä½ç½®:"
  echo ""
  
  BUNDLE_DIR="target/release/bundle"
  
  if [ -d "$BUNDLE_DIR/macos" ]; then
    echo "  ðŸŽ macOS åº”ç”¨åŒ… (.app):"
    find "$BUNDLE_DIR/macos" -name "*.app" -type d -exec ls -ldh {} \; | awk '{print "    â†’ " $$9}'
  fi
  
  if [ -d "$BUNDLE_DIR/dmg" ]; then
    echo "  ðŸ’¿ DMG å®‰è£…é•œåƒ:"
    find "$BUNDLE_DIR/dmg" -name "*.dmg" -exec ls -lh {} \; | awk '{print "    â†’ " $$9 " [" $$5 "]"}'
  fi
  
  echo ""
  echo "ðŸ’¡ å®‰è£…æ–¹æ³•:"
  echo "  1. åŒå‡»æ‰“å¼€ .dmg æ–‡ä»¶"
  echo "  2. æ‹–åŠ¨åº”ç”¨åˆ° Applications æ–‡ä»¶å¤¹"
  echo "  3. é¦–æ¬¡è¿è¡Œéœ€å³é”®ç‚¹å‡»ã€Œæ‰“å¼€ã€(å¦‚æœªç­¾å)"

# å†…éƒ¨ä»»åŠ¡ï¼šæ˜¾ç¤º Windows æž„å»ºäº§ç‰©
_show-windows-bundles:
  #!/usr/bin/env bash
  echo "ðŸ“¦ æž„å»ºäº§ç‰©ä½ç½®:"
  echo ""
  
  BUNDLE_DIR="target/release/bundle"
  
  if [ -d "$BUNDLE_DIR/msi" ]; then
    echo "  ðŸ’¾ MSI å®‰è£…åŒ…:"
    find "$BUNDLE_DIR/msi" -name "*.msi" -exec ls -lh {} \; | awk '{print "    â†’ " $$9 " [" $$5 "]"}'
  fi
  
  if [ -d "$BUNDLE_DIR/nsis" ]; then
    echo "  ðŸ“¦ NSIS å®‰è£…åŒ…:"
    find "$BUNDLE_DIR/nsis" -name "*.exe" -exec ls -lh {} \; | awk '{print "    â†’ " $$9 " [" $$5 "]"}'
  fi
  
  echo ""
  echo "ðŸ’¡ å®‰è£…æ–¹æ³•:"
  echo "  åŒå‡» .msi æ–‡ä»¶è¿è¡Œå®‰è£…ç¨‹åº"

# æŸ¥çœ‹æž„å»ºäº§ç‰© ðŸ“¦
list-bundles:
  @echo "â–¶ æž„å»ºäº§ç‰©åˆ—è¡¨"
  @if [ -d "target/release/bundle" ]; then \
    find target/release/bundle -type f \( -name "*.dmg" -o -name "*.app" -o -name "*.AppImage" -o -name "*.deb" -o -name "*.msi" -o -name "*.rpm" \) -exec ls -lh {} \; | awk '{print "  " $$9 " (" $$5 ")"}'; \
  else \
    echo "  æœªæ‰¾åˆ°æž„å»ºäº§ç‰©ï¼Œè¯·å…ˆè¿è¡Œ 'just package'"; \
  fi

# ç»Ÿè®¡ä»£ç è¡Œæ•° ðŸ“Š
loc:
  @echo "â–¶ ä»£ç ç»Ÿè®¡"
  @echo "  Rust åŽç«¯:"
  @find src -name "*.rs" | xargs wc -l | tail -1 | awk '{print "    " $$1 " è¡Œ"}'
  @echo "  Vue å‰ç«¯:"
  @find {{UI_DIR}}/src -name "*.vue" -o -name "*.ts" | xargs wc -l 2>/dev/null | tail -1 | awk '{print "    " $$1 " è¡Œ"}' || echo "    0 è¡Œ"
  @echo "  æ€»è®¡:"
  @(find src -name "*.rs"; find {{UI_DIR}}/src -name "*.vue" -o -name "*.ts" 2>/dev/null) | xargs wc -l 2>/dev/null | tail -1 | awk '{print "    " $$1 " è¡Œ"}' || echo "    ç»Ÿè®¡ä¸­..."
