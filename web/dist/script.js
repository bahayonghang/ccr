(function(){const n=document.createElement("link").relList;if(n&&n.supports&&n.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))o(a);new MutationObserver(a=>{for(const r of a)if(r.type==="childList")for(const i of r.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function e(a){const r={};return a.integrity&&(r.integrity=a.integrity),a.referrerPolicy&&(r.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?r.credentials="include":a.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function o(a){if(a.ep)return;a.ep=!0;const r=e(a);fetch(a.href,r)}})();const s={currentEditingConfig:null,allConfigs:[],notificationTimeout:null,currentFilter:"all",currentSort:"name",providerRange:"month",providerSortMode:"count_desc",providerStatsCache:null,lastOperation:null,platformInfo:{mode:"legacy",currentPlatform:null,availablePlatforms:[]}};function l(t,n="success",e={}){const o=document.getElementById("notification");s.notificationTimeout&&clearTimeout(s.notificationTimeout);const a={success:"âœ“",error:"âœ—",warning:"âš ",info:"â„¹"};let i=`
        <div class="notification-content">
            <span class="notification-icon">${e.icon||a[n]||"â„¹"}</span>
            <div class="notification-text">${t}</div>
        </div>
    `;e.actions&&e.actions.length>0&&(i+='<div class="notification-actions">',e.actions.forEach(c=>{i+=`<button class="notification-btn notification-btn-${c.type||"secondary"}" data-action="${c.onclick}">${c.label}</button>`}),i+="</div>"),o.innerHTML=i,o.className=`notification ${n} show`,o.querySelectorAll(".notification-btn").forEach(c=>{c.onclick=()=>{const u=c.getAttribute("data-action");u==="closeNotification()"?ne():u.startsWith("retryLastOperation")&&window.retryLastOperation&&window.retryLastOperation()}}),e.autoHide!==!1&&(s.notificationTimeout=setTimeout(()=>{o.classList.remove("show")},e.duration||4e3))}function ne(){document.getElementById("notification").classList.remove("show")}function f(t,n=""){console.error(`API Error in ${n}:`,t);let e="",o=null;t.message&&t.message.includes("Failed to fetch")?(e=`ç½‘ç»œè¿æ¥å¤±è´¥ ${n?`(${n})`:""}
è¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–æœåŠ¡å™¨çŠ¶æ€`,o=n):t.message?e=`æ“ä½œå¤±è´¥: ${t.message}`:e=`æœªçŸ¥é”™è¯¯ ${n?`(${n})`:""}`;const a={autoHide:!1,actions:[{label:"å…³é—­",type:"secondary",onclick:"closeNotification()"}]};o&&a.actions.unshift({label:"é‡è¯•",type:"primary",onclick:`retryLastOperation('${o}')`}),l(e,"error",a)}function oe(t){const n=Math.floor(t/86400),e=Math.floor(t%86400/3600),o=Math.floor(t%3600/60);return n>0?`${n}å¤© ${e}æ—¶`:e>0?`${e}æ—¶ ${o}åˆ†`:`${o}åˆ†é’Ÿ`}function ae(t){const n=document.createElement("div");return n.textContent=t,n.innerHTML}function m(t,n=!0){t&&(n?(t.disabled=!0,t.classList.add("loading"),t.dataset.originalText=t.innerHTML):(t.disabled=!1,t.classList.remove("loading"),t.dataset.originalText&&(t.innerHTML=t.dataset.originalText)))}function E(t,n=!0){document.querySelectorAll(t).forEach(e=>{e.disabled=n,n?e.classList.add("disabled"):e.classList.remove("disabled")})}function se(){return s.platformInfo.mode==="unified"&&s.platformInfo.currentPlatform==="codex"}function $(){const t=document.getElementById("configsList");if(s.allConfigs.length===0){t.innerHTML='<div style="text-align: center; color: var(--text-muted); padding: 40px;">æš‚æ— é…ç½®</div>';return}let n=s.allConfigs;if(s.currentFilter==="official_relay"?n=s.allConfigs.filter(e=>e.provider_type==="OfficialRelay"||e.provider_type==="official_relay"):s.currentFilter==="third_party_model"?n=s.allConfigs.filter(e=>e.provider_type==="ThirdPartyModel"||e.provider_type==="third_party_model"):s.currentFilter==="uncategorized"&&(n=s.allConfigs.filter(e=>!e.provider_type)),n.length===0){t.innerHTML='<div style="text-align: center; color: var(--text-muted); padding: 40px;">å½“å‰åˆ†ç±»ä¸‹æš‚æ— é…ç½®</div>';return}s.currentSort==="usage_count"?n=n.slice().sort((e,o)=>(o.usage_count||0)-(e.usage_count||0)):s.currentSort==="recent"?n=n.slice().sort((e,o)=>e.is_current?-1:o.is_current?1:(o.usage_count||0)-(e.usage_count||0)):n=n.slice().sort((e,o)=>e.name.localeCompare(o.name)),t.innerHTML=n.map((e,o)=>{let a="";if(e.provider_type){const c={OfficialRelay:{text:"ğŸ”„ å®˜æ–¹ä¸­è½¬",class:"official-relay"},official_relay:{text:"ğŸ”„ å®˜æ–¹ä¸­è½¬",class:"official-relay"},ThirdPartyModel:{text:"ğŸ¤– ç¬¬ä¸‰æ–¹æ¨¡å‹",class:"third-party-model"},third_party_model:{text:"ğŸ¤– ç¬¬ä¸‰æ–¹æ¨¡å‹",class:"third-party-model"}}[e.provider_type];c&&(a=`<span class="config-type-badge ${c.class}">${c.text}</span>`)}let r="";e.tags&&e.tags.length>0&&(r=`
                <div class="config-tags">
                    ${e.tags.map(d=>`<span class="config-tag">${d}</span>`).join("")}
                </div>
            `);const i=e.enabled===!1?'<span class="badge badge-disabled" style="background: var(--accent-danger); color: white;">å·²ç¦ç”¨</span>':"";return`
            <div id="config-${e.name}" class="config-card ${e.is_current?"active":""} ${e.enabled===!1?"disabled-config":""} fade-in" style="animation-delay: ${o*.05}s; ${e.enabled===!1?"opacity: 0.6;":""}">
                <div class="config-header">
                    <div class="config-info">
                        <h3 class="config-title">
                            ${a}
                            <span class="config-name">${e.name}</span>
                            ${e.is_current?'<span class="badge badge-active">å½“å‰</span>':""}
                            ${e.is_default?'<span class="badge badge-default">é»˜è®¤</span>':""}
                            ${i}
                        </h3>
                        <div class="config-description">
                            <span class="desc-icon">ğŸ“</span>
                            <span class="desc-text">${e.description||"æ— æè¿°"}</span>
                        </div>
                        ${e.provider?`
                        <div class="config-meta">
                            <div class="meta-item">
                                <span class="meta-icon">ğŸ¢</span>
                                <span class="meta-label">æä¾›å•†:</span>
                                <span class="meta-value provider-name">${e.provider}</span>
                            </div>
                            ${e.account?`
                            <div class="meta-item">
                                <span class="meta-icon">ğŸ‘¤</span>
                                <span class="meta-label">è´¦å·:</span>
                                <span class="meta-value account-name">${e.account}</span>
                            </div>
                            `:""}
                            <div class="meta-item">
                                <span class="meta-icon">ğŸ“Š</span>
                                <span class="meta-label">ä½¿ç”¨æ¬¡æ•°:</span>
                                <span class="meta-value usage-count" style="font-weight: 500; color: var(--accent-primary);">${e.usage_count||0}</span>
                            </div>
                        </div>
                        `:`
                        <div class="config-meta">
                            <div class="meta-item">
                                <span class="meta-icon">ğŸ“Š</span>
                                <span class="meta-label">ä½¿ç”¨æ¬¡æ•°:</span>
                                <span class="meta-value usage-count" style="font-weight: 500; color: var(--accent-primary);">${e.usage_count||0}</span>
                            </div>
                        </div>
                        `}
                        ${r}
                    </div>
                    <div class="config-actions-top">
                        ${e.is_current?"":`
                        <button class="btn btn-primary btn-action-top" onclick="window.switchConfig('${e.name}')" title="åˆ‡æ¢åˆ°æ­¤é…ç½®" ${e.enabled===!1?"disabled":""}>
                            <span class="btn-icon">âš¡</span>
                            <span class="btn-text">åˆ‡æ¢</span>
                        </button>
                        `}
                        <button class="btn btn-secondary btn-action-top" onclick="window.editConfig('${e.name}')" title="ç¼–è¾‘é…ç½®">
                            <span class="btn-icon">âœï¸</span>
                            <span class="btn-text">ç¼–è¾‘</span>
                        </button>
                        ${e.enabled===!1?`
                        <button class="btn btn-success btn-action-top" onclick="window.enableConfig('${e.name}')" title="å¯ç”¨é…ç½®" style="background: var(--accent-success);">
                            <span class="btn-icon">âœ“</span>
                            <span class="btn-text">å¯ç”¨</span>
                        </button>
                        `:`
                        <button class="btn btn-warning btn-action-top" onclick="window.disableConfig('${e.name}')" title="ç¦ç”¨é…ç½®" style="background: var(--accent-warning);">
                            <span class="btn-icon">â—¯</span>
                            <span class="btn-text">ç¦ç”¨</span>
                        </button>
                        `}
                        ${!e.is_current&&!e.is_default?`
                        <button class="btn btn-danger btn-action-top" onclick="window.deleteConfig('${e.name}')" title="åˆ é™¤é…ç½®">
                            <span class="btn-icon">ğŸ—‘ï¸</span>
                            <span class="btn-text">åˆ é™¤</span>
                        </button>
                        `:""}
                    </div>
                </div>
                <div class="config-details">
                    <div class="config-field">
                        <div class="field-label">Base URL</div>
                        <div class="field-value">${e.base_url||"-"}</div>
                    </div>
                    <div class="config-field">
                        <div class="field-label">Auth Token</div>
                        <div class="field-value">${e.auth_token||"-"}</div>
                    </div>
                    ${e.model?`
                    <div class="config-field">
                        <div class="field-label">Model</div>
                        <div class="field-value">${e.model}</div>
                    </div>
                    `:""}
                    ${e.small_fast_model?`
                    <div class="config-field">
                        <div class="field-label">Small Fast Model</div>
                        <div class="field-value">${e.small_fast_model}</div>
                    </div>
                    `:""}
                    ${se()?ie(e):""}
                </div>
            </div>
        `}).join("")}function ie(t){const n=[];return t.api_mode&&n.push({label:"API æ¨¡å¼",value:t.api_mode==="github"?"GitHub å®˜æ–¹":"è‡ªå®šä¹‰ API"}),t.wire_api&&n.push({label:"Wire API",value:t.wire_api}),t.env_key&&n.push({label:"Env Key",value:t.env_key}),typeof t.requires_openai_auth=="boolean"&&n.push({label:"éœ€è¦ç™»å½•",value:t.requires_openai_auth?"æ˜¯":"å¦"}),t.organization&&n.push({label:"ç»„ç»‡",value:t.organization}),t.approval_policy&&n.push({label:"å®¡æ‰¹ç­–ç•¥",value:t.approval_policy}),t.sandbox_mode&&n.push({label:"æ²™ç›’æ¨¡å¼",value:t.sandbox_mode}),t.model_reasoning_effort&&n.push({label:"æ¨ç†å¼ºåº¦",value:t.model_reasoning_effort}),n.length===0?"":`
        <div class="codex-meta-grid">
            ${n.map(e=>`
                <div class="codex-meta-item">
                    <div class="field-label">${e.label}</div>
                    <div class="field-value">${e.value}</div>
                </div>
            `).join("")}
        </div>
    `}function S(){const t=document.getElementById("configNav");if(s.allConfigs.length===0){t.innerHTML='<li class="config-nav-item"><span style="font-size: 12px; color: var(--text-muted);">æš‚æ— é…ç½®</span></li>';return}let n=s.allConfigs;if(s.currentFilter==="official_relay"?n=s.allConfigs.filter(e=>e.provider_type==="OfficialRelay"||e.provider_type==="official_relay"):s.currentFilter==="third_party_model"?n=s.allConfigs.filter(e=>e.provider_type==="ThirdPartyModel"||e.provider_type==="third_party_model"):s.currentFilter==="uncategorized"&&(n=s.allConfigs.filter(e=>!e.provider_type)),n.length===0){t.innerHTML='<li class="config-nav-item"><span style="font-size: 12px; color: var(--text-muted);">å½“å‰åˆ†ç±»ä¸‹æš‚æ— é…ç½®</span></li>';return}t.innerHTML=n.map(e=>`
        <li class="config-nav-item">
            <a href="#config-${e.name}" class="config-nav-link" onclick="window.scrollToConfig('${e.name}', event)">
                <span class="config-nav-badge ${e.is_current?"current":e.is_default?"default":""}"></span>
                ${e.name}
            </a>
        </li>
    `).join("")}function re(t){const n=document.getElementById("historyList");if(t.length===0){n.innerHTML='<div style="text-align: center; color: var(--text-muted); padding: 40px;">æš‚æ— å†å²è®°å½•</div>';return}n.innerHTML=t.map(e=>`
        <div class="history-item">
            <div class="history-header">
                <span class="history-op">${e.operation}</span>
                <span class="history-time">${new Date(e.timestamp).toLocaleString()}</span>
            </div>
            <div class="history-details">
                æ“ä½œè€…: ${e.actor}<br>
                ${e.from_config&&e.to_config?`ä» ${e.from_config} åˆ‡æ¢åˆ° ${e.to_config}`:""}
            </div>
        </div>
    `).join("")}function _(){if(s.platformInfo.mode!=="unified")return;const t=s.platformInfo.availablePlatforms.filter(e=>!["qwen","iflow"].includes(e.name));t.forEach(e=>{const o=document.getElementById(`badge-${e.name}`);if(o){const r=e.current_profile?1:0;o.textContent=r.toString(),e.is_current&&s.allConfigs.length>0&&(o.textContent=s.allConfigs.length.toString())}const a=document.querySelector(`.platform-tab[data-platform="${e.name}"]`);a&&(e.is_current?a.classList.add("active"):a.classList.remove("active"))});const n=document.getElementById("activatePlatformBtn");if(n){const e=document.querySelector(".platform-tab.active");if(e){const o=e.getAttribute("data-platform"),a=t.find(r=>r.is_current);a&&a.name!==o?n.style.display="inline-block":n.style.display="none"}}}function M(){if(s.platformInfo.mode!=="unified")return;const t=document.getElementById("platformStatusList");if(!t)return;const n=s.platformInfo.availablePlatforms.filter(o=>!["qwen","iflow"].includes(o.name));if(n.length===0){t.innerHTML='<div style="text-align: center; color: var(--text-muted); padding: 20px; font-size: 12px;">æš‚æ— å¹³å°</div>';return}const e={claude:"ğŸ¤–",codex:"ğŸ’»",gemini:"âœ¨"};t.innerHTML=n.map(o=>{const a=e[o.name]||"ğŸ“¦",r=o.enabled?"":"inactive",i=o.enabled?"å·²å¯ç”¨":"å·²ç¦ç”¨";return`
            <div class="platform-status-item ${o.is_current?"active":""}"
                 onclick="window.switchPlatform('${o.name}')">
                <div class="platform-status-name">
                    <span class="platform-status-icon">${a}</span>
                    <span>${o.name}</span>
                </div>
                <span class="platform-status-badge ${r}">${i}</span>
            </div>
        `}).join("")}function ce(t){const n=document.getElementById("providerStatsBody");if(!n)return;let e=Object.entries(t);if(s.providerSortMode==="count_asc"?e.sort((c,u)=>c[1]-u[1]):s.providerSortMode==="name_asc"?e.sort((c,u)=>c[0].localeCompare(u[0])):e.sort((c,u)=>u[1]-c[1]),e.length===0){n.innerHTML=`
            <div class="empty-state">
                <div style="font-size: 32px; margin-bottom: 12px;">ğŸ“Š</div>
                <div>æš‚æ— æä¾›å•†ä½¿ç”¨æ•°æ®</div>
                <div style="margin-top: 8px; font-size: 12px; color: var(--text-muted);">
                    å¼€å§‹ä½¿ç”¨ AI API åï¼Œè¿™é‡Œå°†æ˜¾ç¤ºæä¾›å•†ç»Ÿè®¡
                </div>
            </div>
        `;return}const o=Math.max(...e.map(([,c])=>c)),a=e.reduce((c,[,u])=>c+u,0),r=[0,25,50,75,100],i=r.map(c=>Math.round(o*c/100));let d="ä½¿ç”¨æ¬¡æ•°ï¼ˆä»é«˜åˆ°ä½ï¼‰";s.providerSortMode==="count_asc"?d="ä½¿ç”¨æ¬¡æ•°ï¼ˆä»ä½åˆ°é«˜ï¼‰":s.providerSortMode==="name_asc"&&(d="ä¾›åº”å•†åç§°ï¼ˆA â†’ Zï¼‰"),n.innerHTML=`
        <div class="provider-chart-container">
            <div class="provider-chart-summary">
                å…± ${e.length} ä¸ªæä¾›å•† Â· æ€»è°ƒç”¨ ${a} æ¬¡
                <div class="provider-chart-desc">
                    Y è½´ï¼šä½¿ç”¨æ¬¡æ•°ï¼ˆå•ä½ï¼šæ¬¡ï¼‰ Â· X è½´ï¼šæä¾›å•† Â· å½“å‰æ’åºï¼š${d}
                </div>
            </div>
            <div class="provider-chart">
                <div class="provider-chart-y-grid">
                    ${r.map((c,u)=>`
                        <div class="y-grid-line" style="bottom:${c}%;">
                            <span class="y-grid-label">${i[u]}</span>
                        </div>
                    `).join("")}
                </div>
                <div class="provider-chart-y-axis-line"></div>
                <div class="provider-chart-x-axis-line"></div>
                <div class="provider-chart-bars">
                    ${e.map(([c,u],y)=>{const h=o>0?u/o:0,Q=h>0?Math.max(h*100,8):0,x=ae(c||"unknown"),ee=o>0?(h*100).toFixed(1):0,te=`bar-color-${y%5}`;return`
                            <div class="provider-bar-column" style="animation: configFadeIn 0.4s ease ${y*.05}s backwards;">
                                <div class="provider-bar-vertical-bg">
                                    <div class="provider-bar-vertical-fill ${te}" style="height:${Q}%;" title="${x}: ${u} æ¬¡ï¼Œå æœ€é«˜å€¼çš„ ${ee}%"></div>
                                </div>
                                <div class="provider-bar-value">${u} æ¬¡</div>
                                <div class="provider-bar-label" title="${x}">${x}</div>
                            </div>
                        `}).join("")}
                </div>
            </div>
            <div class="provider-chart-x-axis-label">X è½´ï¼šæä¾›å•†</div>
        </div>
    `}function le(){const t=localStorage.getItem("ccr-theme")||"light";k(t)}function de(){const n=document.documentElement.getAttribute("data-theme")==="dark"?"light":"dark";k(n),localStorage.setItem("ccr-theme",n)}function k(t){document.documentElement.setAttribute("data-theme",t);const n=document.getElementById("themeIcon");n&&(n.textContent=t==="dark"?"ğŸŒ™":"â˜€ï¸")}function ue(t,n){if(document.querySelectorAll(".tab-btn").forEach(o=>o.classList.remove("active")),document.querySelectorAll(".tab-content").forEach(o=>o.classList.remove("active")),n&&n.target)n.target.classList.add("active");else{const a=Array.from(document.querySelectorAll(".tab-btn")).find(r=>{const i=r.textContent.trim();return t==="configs"?i.includes("é…ç½®")||i.includes("é…ç½®åˆ—è¡¨"):t==="history"?i.includes("å†å²"):t==="sync"?i.includes("åŒæ­¥")||i.includes("äº‘åŒæ­¥"):!1});a&&a.classList.add("active")}const e=document.getElementById(t+"-tab");e&&e.classList.add("active"),t==="sync"&&g()}function me(t){const n=document.getElementById(t);n&&n.classList.add("show")}function L(){document.getElementById("configModal").classList.remove("show")}function fe(){s.currentEditingConfig=null,document.getElementById("modalTitle").textContent="â• æ·»åŠ é…ç½®",document.getElementById("configForm").reset(),b()?(w(!0),pe()):w(!1),document.getElementById("configModal").classList.add("show")}function w(t){const n=document.getElementById("codexFieldsSection");n&&(n.style.display=t?"block":"none")}function pe(){const t=document.getElementById("codexApiMode");t&&(t.value="custom",document.getElementById("codexWireApi").value="responses",document.getElementById("codexEnvKey").value="",document.getElementById("codexRequiresAuth").checked=!0,document.getElementById("codexOrganization").value="",document.getElementById("codexApprovalPolicy").value="",document.getElementById("codexSandboxMode").value="",document.getElementById("codexModelReasoning").value="")}function ye(t){w(!0),document.getElementById("codexApiMode").value=t.api_mode||"custom",document.getElementById("codexWireApi").value=t.wire_api||"responses",document.getElementById("codexEnvKey").value=t.env_key||"",document.getElementById("codexRequiresAuth").checked=t.requires_openai_auth!==!1,document.getElementById("codexOrganization").value=t.organization||"",document.getElementById("codexApprovalPolicy").value=t.approval_policy||"",document.getElementById("codexSandboxMode").value=t.sandbox_mode||"",document.getElementById("codexModelReasoning").value=t.model_reasoning_effort||""}function ge(){document.getElementById("cleanModal").style.display="flex",document.getElementById("cleanPreview").style.display="none",document.getElementById("cleanDays").value=7,document.getElementById("cleanDryRun").checked=!0,H()}function A(){document.getElementById("cleanModal").style.display="none",document.getElementById("cleanPreview").style.display="none"}function H(){const t=document.getElementById("cleanDays").value;document.getElementById("cleanDaysDisplay").textContent=t}function ve(){document.getElementById("exportModal").classList.add("show"),document.getElementById("exportIncludeSecrets").checked=!0}function O(){document.getElementById("exportModal").classList.remove("show")}function he(){document.getElementById("importModal").classList.add("show"),document.getElementById("importFile").value="",document.getElementById("importMode").value="merge",document.getElementById("importBackup").checked=!0,document.getElementById("importPreview").style.display="none"}function j(){document.getElementById("importModal").classList.remove("show")}function we(){var n;const t=document.getElementById("providerModal");if(t){t.classList.add("show"),t.style.animation="fadeIn 0.3s ease";const e=((n=document.getElementById("providerRange"))==null?void 0:n.value)||"month",o=document.getElementById("providerSort");o&&(o.value=s.providerSortMode),Z(e)}}function be(){const t=document.getElementById("providerModal");t&&(t.style.animation="fadeOut 0.2s ease",setTimeout(()=>{t.classList.remove("show")},200))}function P(){const t=document.getElementById("modeIndicator"),n=document.getElementById("platformNavBar"),e=document.getElementById("platformStatusSection"),o=document.getElementById("currentPlatformIndicator");s.platformInfo.mode==="unified"?(t.textContent="Unified æ¨¡å¼",t.style.color="var(--accent-success)",n&&(n.style.display="flex"),e&&(e.style.display="block"),o&&s.platformInfo.currentPlatform&&(o.style.display="flex",document.getElementById("activePlatformName").textContent=s.platformInfo.currentPlatform)):(t.textContent="Legacy æ¨¡å¼",t.style.color="var(--text-secondary)",n&&(n.style.display="none"),e&&(e.style.display="none"),o&&(o.style.display="none")),w(b())}function Ee(t){const n=document.getElementById("syncPushBtn"),e=document.getElementById("syncPullBtn"),o=document.getElementById("syncForcePush"),a=document.getElementById("syncForcePull"),r=!!t.configured,i=!!t.enabled,d=!(r&&i);n&&(n.disabled=d,n.title=d?"è¯·å…ˆå¯ç”¨å¹¶ä¿å­˜åŒæ­¥é…ç½®":"ä¸Šä¼ æœ¬åœ°é…ç½®åˆ°äº‘ç«¯"),e&&(e.disabled=d,e.title=d?"è¯·å…ˆå¯ç”¨å¹¶ä¿å­˜åŒæ­¥é…ç½®":"ä»äº‘ç«¯ä¸‹è½½é…ç½®åˆ°æœ¬åœ°"),o&&(o.disabled=d),a&&(a.disabled=d)}function p(t,n){s.lastOperation={context:t,func:n}}async function T(){try{const t=await fetch("/api/system");if(!t.ok)throw new Error(`HTTP ${t.status}`);const n=await t.json();if(n.success&&n.data){const e=n.data;document.getElementById("sysHostname").textContent=e.hostname,document.getElementById("sysOS").textContent=`${e.os} ${e.os_version}`,document.getElementById("sysCPU").textContent=`${e.cpu_cores} æ ¸å¿ƒ`;const o=Math.round(e.cpu_usage);document.getElementById("sysCPUUsage").textContent=`${o}%`,document.getElementById("sysCPUBar").style.width=`${o}%`;const a=e.used_memory_gb.toFixed(1),r=e.total_memory_gb.toFixed(1),i=Math.round(e.memory_usage_percent);document.getElementById("sysMemory").textContent=`${a} GB / ${r} GB (${i}%)`,document.getElementById("sysMemBar").style.width=`${i}%`,document.getElementById("sysUptime").textContent=oe(e.uptime_seconds)}}catch(t){console.error("åŠ è½½ç³»ç»Ÿä¿¡æ¯å¤±è´¥:",t)}}async function B(){p("åŠ è½½é…ç½®",B);try{let t="/api/configs";s.platformInfo.mode==="unified"&&s.platformInfo.currentPlatform&&(t={codex:"/api/codex/profiles"}[s.platformInfo.currentPlatform]||"/api/configs",console.log(`åŠ è½½å¹³å°é…ç½®: ${s.platformInfo.currentPlatform} -> ${t}`));let n=await fetch(t);if(!n.ok&&t!=="/api/configs"&&(console.warn(`å¹³å°ç«¯ç‚¹ ${t} è¿”å› ${n.status}ï¼Œå›é€€åˆ° /api/configs`),n=await fetch("/api/configs")),!n.ok)throw new Error(`HTTP ${n.status}: ${n.statusText}`);const e=await n.json();if(e.success){s.platformInfo.mode==="unified"&&s.platformInfo.currentPlatform!=="claude"?s.allConfigs=Ie(e.data,s.platformInfo.currentPlatform):s.allConfigs=e.data.configs||e.data||[];const o=e.data.current_config||e.data.current_profile||e.data.active_profile||"-";s.platformInfo.mode==="unified"&&s.platformInfo.currentPlatform&&s.allConfigs.length===0&&(["qwen","iflow"].includes(s.platformInfo.currentPlatform)?l(`å¹³å° "${s.platformInfo.currentPlatform}" å°šæœªå®ç°
è¯·åˆ‡æ¢åˆ°å·²å®ç°çš„å¹³å° (Claude, Codex, Gemini)`,"warning",{icon:"ğŸš§",duration:5e3}):o==="-"&&l(`å¹³å° "${s.platformInfo.currentPlatform}" æš‚æ— é…ç½®
è¯·å…ˆæ·»åŠ é…ç½®æ–‡ä»¶`,"info",{icon:"â„¹ï¸",duration:6e3})),document.getElementById("currentConfigName").textContent=o,document.getElementById("totalConfigs").textContent=s.allConfigs.length,$(),S(),_()}else l(e.message||"åŠ è½½å¤±è´¥","error")}catch(t){f(t,"åŠ è½½é…ç½®")}}function Ie(t,n){return Array.isArray(t)?t:t.configs&&Array.isArray(t.configs)?t.configs:t.profiles&&Array.isArray(t.profiles)?t.profiles.map(e=>({name:e.name,description:e.description,base_url:e.base_url||e.api_url,auth_token:e.auth_token||e.api_key,model:e.model,small_fast_model:e.small_fast_model,is_current:e.is_active||e.is_current||!1,is_default:e.is_default||!1,provider:e.provider,provider_type:e.provider_type,tags:e.tags,api_mode:e.api_mode,wire_api:e.wire_api,env_key:e.env_key,requires_openai_auth:e.requires_openai_auth,approval_policy:e.approval_policy,sandbox_mode:e.sandbox_mode,model_reasoning_effort:e.model_reasoning_effort,organization:e.organization})):t.api_key||t.auth_token?[{name:n,description:`${n} Configuration`,base_url:t.base_url||t.api_url,auth_token:t.auth_token||t.api_key,model:t.model,small_fast_model:t.small_fast_model,is_current:!0,is_default:!0}]:[]}async function N(t){if(confirm(`ç¡®å®šåˆ‡æ¢åˆ°é…ç½® "${t}" å—ï¼Ÿ`)){E(".btn-primary",!0),p("åˆ‡æ¢é…ç½®",()=>N(t));try{const n=await fetch("/api/switch",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({config_name:t})});if(!n.ok)throw new Error(`HTTP ${n.status}`);const e=await n.json();e.success?(l(`âœ“ æˆåŠŸåˆ‡æ¢åˆ°é…ç½® "${t}"`,"success"),await v()):l(e.message||"åˆ‡æ¢å¤±è´¥","error",{autoHide:!1,actions:[{label:"å…³é—­",type:"secondary",onclick:"closeNotification()"}]})}catch(n){f(n,"åˆ‡æ¢é…ç½®")}finally{E(".btn-primary",!1)}}}async function R(t){t.preventDefault();const n=t.target.querySelector('button[type="submit"]');m(n,!0);const e=document.getElementById("configProviderType").value,o=document.getElementById("configProvider").value,a=document.getElementById("configAccount").value,r=document.getElementById("configTags").value;let i=null;r&&r.trim()&&(i=r.split(",").map(c=>c.trim()).filter(c=>c.length>0));let d={name:document.getElementById("configName").value,description:document.getElementById("configDesc").value||null,base_url:document.getElementById("configBaseUrl").value,auth_token:document.getElementById("configAuthToken").value,model:document.getElementById("configModel").value||null,small_fast_model:document.getElementById("configSmallModel").value||null,provider_type:e||null,provider:o||null,account:a||null,tags:i};b()&&(d=_e(d)),p("ä¿å­˜é…ç½®",()=>R(t));try{const c=s.currentEditingConfig?I(s.currentEditingConfig):I(),u=s.currentEditingConfig?"PUT":"POST",y=await fetch(c,{method:u,headers:{"Content-Type":"application/json"},body:JSON.stringify(d)});if(!y.ok)throw new Error(`HTTP ${y.status}`);const h=await y.json();h.success?(l(s.currentEditingConfig?"âœ“ é…ç½®æ›´æ–°æˆåŠŸ":"âœ“ é…ç½®æ·»åŠ æˆåŠŸ","success"),L(),await v()):l(h.message||"ä¿å­˜å¤±è´¥","error",{autoHide:!1,actions:[{label:"å…³é—­",type:"secondary",onclick:"closeNotification()"}]})}catch(c){f(c,"ä¿å­˜é…ç½®")}finally{m(n,!1)}}function I(t=null){return b()?t?`/api/codex/profiles/${encodeURIComponent(t)}`:"/api/codex/profiles":t?`/api/config/${encodeURIComponent(t)}`:"/api/config"}function _e(t){return t.api_mode=document.getElementById("codexApiMode").value||"custom",t.wire_api=document.getElementById("codexWireApi").value||null,t.env_key=document.getElementById("codexEnvKey").value.trim()||null,t.requires_openai_auth=document.getElementById("codexRequiresAuth").checked,t.approval_policy=document.getElementById("codexApprovalPolicy").value.trim()||null,t.sandbox_mode=document.getElementById("codexSandboxMode").value.trim()||null,t.model_reasoning_effort=document.getElementById("codexModelReasoning").value.trim()||null,t.organization=document.getElementById("codexOrganization").value.trim()||null,t}async function F(t){if(confirm(`ç¡®å®šåˆ é™¤é…ç½® "${t}" å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)){E(".btn-danger",!0),p("åˆ é™¤é…ç½®",()=>F(t));try{const n=await fetch(I(t),{method:"DELETE"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const e=await n.json();e.success?(l(`âœ“ é…ç½® "${t}" åˆ é™¤æˆåŠŸ`,"success"),await v()):l(e.message||"åˆ é™¤å¤±è´¥","error",{autoHide:!1,actions:[{label:"å…³é—­",type:"secondary",onclick:"closeNotification()"}]})}catch(n){f(n,"åˆ é™¤é…ç½®")}finally{E(".btn-danger",!1)}}}async function U(t){p("å¯ç”¨é…ç½®",()=>U(t));try{const n=await fetch(`/api/config/${encodeURIComponent(t)}/enable`,{method:"PATCH"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const e=await n.json();e.success||e.message?(l(e.message||`âœ“ é…ç½® "${t}" å·²å¯ç”¨`,"success"),await v()):l("å¯ç”¨å¤±è´¥","error")}catch(n){f(n,"å¯ç”¨é…ç½®")}}async function q(t){p("ç¦ç”¨é…ç½®",()=>q(t));try{const n=await fetch(`/api/config/${encodeURIComponent(t)}/disable`,{method:"PATCH"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const e=await n.json();e.success||e.message?(l(e.message||`âœ“ é…ç½® "${t}" å·²ç¦ç”¨`,"success"),await v()):l("ç¦ç”¨å¤±è´¥","error")}catch(n){f(n,"ç¦ç”¨é…ç½®")}}async function Be(){try{const n=await(await fetch("/api/history")).json();n.success&&(document.getElementById("historyCount").textContent=n.data.total,re(n.data.entries))}catch(t){console.error("åŠ è½½å†å²è®°å½•å¤±è´¥:",t)}}async function D(){const t=event.target;m(t,!0),p("éªŒè¯é…ç½®",D);try{const n=await fetch("/api/validate",{method:"POST"});if(!n.ok)throw new Error(`HTTP ${n.status}`);const e=await n.json();e.success?l("âœ“ é…ç½®éªŒè¯é€šè¿‡","success",{icon:"âœ…"}):l(e.message||"éªŒè¯å¤±è´¥","error")}catch(n){f(n,"éªŒè¯é…ç½®")}finally{m(t,!1)}}async function z(t=!1){try{const n=await fetch("/api/platforms");if(!n.ok)throw new Error(`HTTP ${n.status}`);const e=await n.json();if(e.success&&e.data){const o=e.data.available_platforms||[];let a=e.data.current_platform;if(!a&&o.length>0){const r=o.find(i=>i.is_current);r&&(a=r.name)}s.platformInfo={mode:e.data.mode||"legacy",currentPlatform:a||null,availablePlatforms:o},P(),s.platformInfo.mode==="unified"&&(_(),M())}return!0}catch(n){return console.error("åŠ è½½å¹³å°ä¿¡æ¯å¤±è´¥:",n),t&&(s.platformInfo={mode:"legacy",currentPlatform:null,availablePlatforms:[]},P()),!1}}async function xe(t){const n=s.allConfigs.find(e=>e.name===t);if(n){s.currentEditingConfig=t,document.getElementById("modalTitle").textContent="âœï¸ ç¼–è¾‘é…ç½®",document.getElementById("configName").value=n.name,document.getElementById("configDesc").value=n.description||"",document.getElementById("configBaseUrl").value=n.base_url||"",document.getElementById("configAuthToken").value=n.auth_token||"",document.getElementById("configModel").value=n.model||"",document.getElementById("configSmallModel").value=n.small_fast_model||"",document.getElementById("configProviderType").value=n.provider_type||"",document.getElementById("configProvider").value=n.provider||"",document.getElementById("configAccount").value=n.account||"",document.getElementById("configTags").value=n.tags?n.tags.join(", "):"",b()?ye(n):w(!1),document.getElementById("configModal").classList.add("show");try{const e=I(t),o=await fetch(e);if(o.ok){const a=await o.json(),r=a.data||a;r.auth_token&&(document.getElementById("configAuthToken").value=r.auth_token)}}catch(e){console.warn("è·å–å®Œæ•´é…ç½®å¤±è´¥ï¼Œä½¿ç”¨ç¼“å­˜æ•°æ®:",e)}}}async function g(t=!1){p("åŠ è½½åŒæ­¥çŠ¶æ€",g);const n=document.getElementById("syncRefreshBtn");n&&m(n,!0);try{const e=await fetch("/api/sync/status");if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.json();if(!o.success)throw new Error(o.message||"è·å–åŒæ­¥çŠ¶æ€å¤±è´¥");const a=o.data||{},r={syncConfiguredValue:a.configured?"æ˜¯":"å¦",syncEnabledValue:a.enabled?"æ˜¯":"å¦",syncWebdavUrlValue:a.webdav_url||"-",syncUsernameValue:a.username||"-",syncRemotePathValue:a.remote_path||"-",syncAutoSyncValue:a.auto_sync===!0?"æ˜¯":a.auto_sync===!1?"å¦":"-",syncLocalPathValue:a.local_path||"-",syncTypeValue:a.sync_type||"-",syncRemoteExistsValue:a.remote_exists===!0?"æ˜¯":a.remote_exists===!1?"å¦":"-"};for(const[i,d]of Object.entries(r)){const c=document.getElementById(i);c&&(c.textContent=d)}if(a.configured){const i=document.getElementById("syncEnabled");i&&(i.checked=!!a.enabled);const d=document.getElementById("syncWebdavUrl");d&&a.webdav_url&&!d.value&&(d.value=a.webdav_url);const c=document.getElementById("syncUsername");c&&a.username&&!c.value&&(c.value=a.username);const u=document.getElementById("syncRemotePath");u&&a.remote_path&&!u.value&&(u.value=a.remote_path);const y=document.getElementById("syncAutoSync");y&&typeof a.auto_sync=="boolean"&&(y.checked=a.auto_sync)}Ee(a),t||l("åŒæ­¥çŠ¶æ€å·²æ›´æ–°","success",{icon:"ğŸ”„"})}catch(e){t||f(e,"åŠ è½½åŒæ­¥çŠ¶æ€")}finally{n&&m(n,!1)}}async function V(t){t&&t.preventDefault(),p("ä¿å­˜åŒæ­¥é…ç½®",V);const n=document.getElementById("syncSaveBtn");m(n,!0);try{const e={webdav_url:document.getElementById("syncWebdavUrl").value.trim(),username:document.getElementById("syncUsername").value.trim(),password:document.getElementById("syncPassword").value,remote_path:document.getElementById("syncRemotePath").value.trim()||void 0,enabled:document.getElementById("syncEnabled").checked,auto_sync:document.getElementById("syncAutoSync").checked};if(!e.webdav_url||!e.username||!e.password)throw new Error("è¯·å¡«å†™ WebDAV URLã€ç”¨æˆ·åã€å¯†ç ");const o=await fetch("/api/sync/config",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)}),a=await o.json();if(!o.ok||!a.success)throw new Error(a.message||`HTTP ${o.status}`);l(a.data&&a.data.message||"åŒæ­¥é…ç½®å·²ä¿å­˜","success",{icon:"âœ…"}),await g(!0)}catch(e){f(e,"ä¿å­˜åŒæ­¥é…ç½®")}finally{m(n,!1)}}async function J(){p("æ‰§è¡ŒåŒæ­¥ Push",J);const t=document.getElementById("syncPushBtn");m(t,!0);try{const n=document.getElementById("syncForcePush").checked,e=await fetch("/api/sync/push",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({force:n})}),o=await e.json();if(!e.ok||!o.success)throw new Error(o.message||`HTTP ${e.status}`);l(o.data&&o.data.message||"å·²æˆåŠŸä¸Šä¼ åˆ°äº‘ç«¯","success",{icon:"ğŸ“¤"}),await g(!0)}catch(n){f(n,"æ‰§è¡ŒåŒæ­¥ Push")}finally{m(t,!1)}}async function W(){p("æ‰§è¡ŒåŒæ­¥ Pull",W);const t=document.getElementById("syncPullBtn");m(t,!0);try{const n=document.getElementById("syncForcePull").checked,e=await fetch("/api/sync/pull",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({force:n})}),o=await e.json();if(!e.ok||!o.success)throw new Error(o.message||`HTTP ${e.status}`);l(o.data&&o.data.message||"å·²æˆåŠŸä»äº‘ç«¯ä¸‹è½½","success",{icon:"ğŸ“¥"}),await g(!0)}catch(n){f(n,"æ‰§è¡ŒåŒæ­¥ Pull")}finally{m(t,!1)}}async function K(){const t=parseInt(document.getElementById("cleanDays").value),n=event.target;m(n,!0),p("é¢„è§ˆæ¸…ç†",K);try{const e=await fetch("/api/clean",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({days:t,dry_run:!0})});if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.json();if(o.success){const a=o.data,r=document.getElementById("cleanPreview"),i=document.getElementById("cleanPreviewContent");i.innerHTML=a.deleted_count===0?'<div style="color: var(--accent-success);">âœ“ æ²¡æœ‰éœ€è¦æ¸…ç†çš„æ–‡ä»¶</div>':`<div style="margin-bottom: 8px;"><span>å°†åˆ é™¤ ${a.deleted_count} ä¸ªæ–‡ä»¶</span></div>`,r.style.display="block"}else l(o.message||"é¢„è§ˆå¤±è´¥","error")}catch(e){f(e,"é¢„è§ˆæ¸…ç†")}finally{m(n,!1)}}async function G(){const t=parseInt(document.getElementById("cleanDays").value),n=document.getElementById("cleanDryRun").checked,e=document.getElementById("cleanExecuteBtn");if(n){l('è¯·å–æ¶ˆå‹¾é€‰"æ¨¡æ‹Ÿè¿è¡Œ"ä»¥æ‰§è¡Œå®é™…æ¸…ç†',"warning",{icon:"âš "});return}if(confirm(`ç¡®å®šæ¸…ç† ${t} å¤©å‰çš„å¤‡ä»½æ–‡ä»¶å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ï¼`)){m(e,!0),p("æ‰§è¡Œæ¸…ç†",G);try{const o=await fetch("/api/clean",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({days:t,dry_run:!1})});if(!o.ok)throw new Error(`HTTP ${o.status}`);const a=await o.json();a.success?(l(`âœ“ å·²åˆ é™¤ ${a.data.deleted_count} ä¸ªæ–‡ä»¶`,"success",{icon:"ğŸ—‘ï¸"}),A()):l(a.message||"æ¸…ç†å¤±è´¥","error")}catch(o){f(o,"æ‰§è¡Œæ¸…ç†")}finally{m(e,!1)}}}async function X(){const t=document.getElementById("exportIncludeSecrets").checked,n=event.target;m(n,!0),p("å¯¼å‡ºé…ç½®",X);try{const e=await fetch("/api/export",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({include_secrets:t})});if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.json();if(o.success){const a=new Blob([o.data.content],{type:"text/plain;charset=utf-8"}),r=window.URL.createObjectURL(a),i=document.createElement("a");i.href=r,i.download=o.data.filename,document.body.appendChild(i),i.click(),document.body.removeChild(i),window.URL.revokeObjectURL(r),l("âœ“ é…ç½®å¯¼å‡ºæˆåŠŸ","success",{icon:"ğŸ“¥"}),O()}else l(o.message||"å¯¼å‡ºå¤±è´¥","error")}catch(e){f(e,"å¯¼å‡ºé…ç½®")}finally{m(n,!1)}}let C=null;function $e(t){C=t}async function Y(){if(!C){l("è¯·å…ˆé€‰æ‹©é…ç½®æ–‡ä»¶","error",{icon:"âš "});return}const t=document.getElementById("importMode").value,n=document.getElementById("importBackup").checked,e=document.getElementById("importExecuteBtn");if(m(e,!0),t==="replace"&&!confirm("æ›¿æ¢æ¨¡å¼å°†å®Œå…¨è¦†ç›–ç°æœ‰é…ç½®ï¼Œç¡®å®šç»§ç»­å—ï¼Ÿ")){m(e,!1);return}p("å¯¼å…¥é…ç½®",Y);try{const o=await fetch("/api/import",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({content:C,mode:t,backup:n})});if(!o.ok)throw new Error(`HTTP ${o.status}`);const a=await o.json();if(a.success){const r=a.data;l(`âœ“ é…ç½®å¯¼å…¥æˆåŠŸ (æ–°å¢: ${r.added}, æ›´æ–°: ${r.updated})`,"success",{icon:"ğŸ“¤"}),j(),await v()}else l(a.message||"å¯¼å…¥å¤±è´¥","error")}catch(o){f(o,"å¯¼å…¥é…ç½®")}finally{m(e,!1)}}async function v(){await B(),await Be();try{await g(!0)}catch{}}async function Z(t="month"){s.providerRange=t;const n=document.getElementById("providerStatsBody");n&&(n.innerHTML='<div class="loading-state"><div class="spinner"></div><div class="loading-text">æ­£åœ¨åŠ è½½æä¾›å•†ç»Ÿè®¡...</div></div>');try{const e=await fetch("/api/stats/provider-usage");if(!e.ok)throw new Error(`HTTP ${e.status}`);const o=await e.json();s.providerStatsCache=o||{},await new Promise(a=>setTimeout(a,300)),ce(s.providerStatsCache||{})}catch(e){console.error("åŠ è½½æä¾›å•†ç»Ÿè®¡å¤±è´¥:",e),n&&(n.innerHTML='<div class="empty-state"><div>åŠ è½½å¤±è´¥</div></div>')}}window.switchConfig=N;window.editConfig=xe;window.deleteConfig=F;window.enableConfig=U;window.disableConfig=q;window.saveConfig=R;window.validateConfigs=D;window.toggleTheme=de;window.switchTab=ue;window.openModal=me;window.closeModal=L;window.openAddModal=fe;window.loadSyncStatus=g;window.saveSyncConfig=V;window.executeSyncPush=J;window.executeSyncPull=W;window.openCleanModal=ge;window.closeCleanModal=A;window.previewClean=K;window.executeClean=G;window.updateCleanDaysDisplay=H;window.openExportModal=ve;window.closeExportModal=O;window.executeExport=X;window.openImportModal=he;window.closeImportModal=j;window.executeImport=Y;window.openProviderStatsModal=we;window.closeProviderModal=be;window.loadProviderStats=Z;window.retryLastOperation=function(t){s.lastOperation&&s.lastOperation.func?(console.log(`Retrying ${s.lastOperation.context}...`),s.lastOperation.func()):console.warn("No operation to retry")};window.scrollToConfig=function(t,n){n&&n.preventDefault();const e=document.getElementById(`config-${t}`);e&&(e.scrollIntoView({behavior:"smooth",block:"start"}),e.classList.add("active"),setTimeout(()=>e.classList.remove("active"),2e3),history.pushState(null,null,`#config-${t}`),document.querySelectorAll(".config-nav-link").forEach(o=>o.classList.remove("active")),n&&n.target&&n.target.closest(".config-nav-link").classList.add("active"))};window.switchPlatform=async function(t){if(t===s.platformInfo.currentPlatform)return;if(["qwen","iflow"].includes(t)){l(`å¹³å° "${t}" å°šæœªå®ç°`,"warning",{icon:"ğŸš§"});return}const n=document.querySelector(`.platform-tab[data-platform="${t}"]`);n&&(n.classList.add("switching"),setTimeout(()=>n.classList.remove("switching"),600)),s.platformInfo.currentPlatform=t,_(),M(),document.getElementById("configsList").innerHTML='<div class="loading-state"><div class="spinner"></div><div class="loading-text">æ­£åœ¨åˆ‡æ¢å¹³å°...</div></div>',document.getElementById("currentConfigName").textContent="-",await B(),w(b())};window.activateCurrentPlatform=async function(){const t=document.getElementById("activatePlatformBtn");if(!t)return;const n=document.querySelector(".platform-tab.active");if(!n)return;const e=n.getAttribute("data-platform");if(e){t.disabled=!0,t.innerHTML='<span class="loading-indicator"></span> æ¿€æ´»ä¸­...';try{const o=await fetch("/api/platform/activate",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({platform:e})});if(!o.ok)throw new Error(`HTTP ${o.status}`);const a=await o.json();a.success?(l(`âœ“ å·²æ¿€æ´»å¹³å°: ${e}`,"success"),await z(),await B()):l(a.message||"æ¿€æ´»å¤±è´¥","error")}catch(o){console.error("Activate platform error:",o),l("æ¿€æ´»å¹³å°å¤±è´¥","error")}finally{t.disabled=!1,t.innerHTML="æ¿€æ´»æ­¤å¹³å°",_()}}};function b(){return s.platformInfo.mode==="unified"&&s.platformInfo.currentPlatform==="codex"}document.addEventListener("DOMContentLoaded",async()=>{le();const t=document.getElementById("importFile");t&&t.addEventListener("change",i=>{const d=i.target.files[0];if(!d)return;const c=new FileReader;c.onload=u=>{$e(u.target.result),document.getElementById("importPreview").style.display="block",document.getElementById("importPreviewContent").textContent=u.target.result},c.readAsText(d)});const n=document.getElementById("codexApiMode");n&&n.addEventListener("change",i=>{i.target.value});const e=document.querySelectorAll(".type-filter-btn");e.forEach(i=>{i.addEventListener("click",()=>{e.forEach(d=>d.classList.remove("active")),i.classList.add("active"),s.currentFilter=i.dataset.filter,$(),S()})});const o=document.getElementById("sortSelect");o&&o.addEventListener("change",i=>{s.currentSort=i.target.value,$()});const a=document.getElementById("providerSort");a&&a.addEventListener("change",i=>{s.providerSortMode=i.target.value,s.providerStatsCache&&renderProviderStats(s.providerStatsCache)}),await T(),await z(!0)&&await v(),setInterval(T,5e3)});
