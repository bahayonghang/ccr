# CCR UI Backend æ¨¡å—æŒ‡å¯¼æ–‡ä»¶

[æ ¹ç›®å½•](../../CLAUDE.md) > [ccr-ui](../CLAUDE.md) > **backend**

## Change Log
- **2025-01-19**: æ·»åŠ  SQLite ç»Ÿä¸€å­˜å‚¨å±‚ (v3.19.0) - UIçŠ¶æ€/ç­¾åˆ°/æ—¥å¿—/ä½¿ç”¨é‡ç»Ÿä¸€è¿ç§»è‡³ SQLite
- **2025-12-25**: æ·»åŠ å…¨å±€ç¼“å­˜å±‚ (v3.15.0) - 30s TTL, 80% I/O å‡å°‘, 50-100x æ€§èƒ½æå‡
- **2025-12-17**: æ¿€è¿›ç²¾ç®€åˆ° 300 è¡Œä»¥å†…ï¼Œåªä¿ç•™æ ¸å¿ƒæ¶æ„å’ŒæŠ€æœ¯æ ˆ
- **2025-12-16**: æŒ‰æ ‡å‡†æ¨¡æ¿é‡æ–°ç»„ç»‡æ–‡æ¡£ç»“æ„
- **2025-11-14**: é‡æ„ä¸ºåˆ†å±‚æ¶æ„ (API â†’ Services â†’ Managers â†’ Models â†’ Core â†’ Utils)
- **2025-10-22 10:39:28 CST**: åˆå§‹åç«¯æ¨¡å—æ–‡æ¡£åˆ›å»º

---

## é¡¹ç›®æ¶æ„

### æ¨¡å—èŒè´£

CCR UI Backend æ˜¯åŸºäº Axum æ„å»ºçš„ REST API æœåŠ¡å™¨ï¼Œä¸ºå¤šä¸ª AI CLI å·¥å…·æä¾›å…¨é¢çš„ç®¡ç†æ¥å£ã€‚

**æ ¸å¿ƒèŒè´£**:
1. **å¤šå¹³å°é…ç½®ç®¡ç†** - Claude Code, Codex, Gemini CLI, Qwen, iFlow
2. **MCP æœåŠ¡å™¨ç®¡ç†** - åˆ—è¡¨ã€æ·»åŠ ã€æ›´æ–°ã€åˆ é™¤ã€å¯ç”¨/ç¦ç”¨ MCP æœåŠ¡å™¨
3. **Agent ç®¡ç†** - ç®¡ç†å„å¹³å°çš„ AI Agents
4. **æ–œæ å‘½ä»¤ç®¡ç†** - è‡ªå®šä¹‰æ–œæ å‘½ä»¤é…ç½®
5. **æ’ä»¶ç®¡ç†** - æ’ä»¶å®‰è£…ä¸é…ç½®
6. **å¤šæ–‡ä»¶å¤¹ WebDAV åŒæ­¥** - ç‹¬ç«‹æ–‡ä»¶å¤¹ç®¡ç†ä¸æ‰¹é‡æ“ä½œ
7. **é…ç½®è½¬æ¢** - å¹³å°é—´é…ç½®æ ¼å¼è½¬æ¢
8. **å‘½ä»¤æ‰§è¡Œ** - é€šè¿‡ API æ‰§è¡Œ CCR CLI å‘½ä»¤
9. **ç³»ç»Ÿä¿¡æ¯** - æä¾›ç³»ç»ŸæŒ‡æ ‡ä¸çŠ¶æ€
10. **ç­¾åˆ°è´¦å·ç®¡ç†** - å¤šæä¾›å•†ç­¾åˆ°è´¦å·ä¸ä½™é¢è¿½è¸ª (SQLite)
11. **ä½¿ç”¨é‡ç»Ÿè®¡** - Claude/Codex/Gemini ä½¿ç”¨é‡å¯¼å…¥ä¸åˆ†æ (SQLite)

**è¿è¡Œç¯å¢ƒ**:
- ç‹¬ç«‹ Axum æœåŠ¡å™¨ï¼Œé»˜è®¤ç«¯å£ **8081**
- é€šè¿‡ RESTful JSON APIs ä¸å‰ç«¯é€šä¿¡
- é€šè¿‡å­è¿›ç¨‹æ‰§è¡Œ CCR CLI å‘½ä»¤(ä¸é‡å¤å®ç°é€»è¾‘)

### æ¶æ„å±‚æ¬¡

**åˆ†å±‚æ¶æ„** (2025-11-14 é‡æ„):

```
backend/
â”œâ”€â”€ API Layer (API å±‚)           - HTTP è¯·æ±‚å¤„ç†ã€è·¯ç”±å®šä¹‰ã€JSON è§£æ
â”‚   â””â”€â”€ handlers/                - 16+ å¤„ç†å™¨æ–‡ä»¶
â”‚
â”œâ”€â”€ Services Layer (æœåŠ¡å±‚)      - ä¸šåŠ¡é€»è¾‘ã€ç¼–æ’ã€äº‹åŠ¡ç®¡ç†
â”‚   â”œâ”€â”€ commands.rs              - å‘½ä»¤æœåŠ¡
â”‚   â”œâ”€â”€ checkin_service.rs       - ç­¾åˆ°æ‰§è¡ŒæœåŠ¡
â”‚   â”œâ”€â”€ usage_import_service.rs  - ä½¿ç”¨é‡å¯¼å…¥æœåŠ¡
â”‚   â””â”€â”€ converter_service.rs     - è½¬æ¢æœåŠ¡
â”‚
â”œâ”€â”€ Managers Layer (ç®¡ç†å±‚)      - æ•°æ®è®¿é—®ã€æ–‡ä»¶ I/Oã€æŒä¹…åŒ–æ“ä½œ
â”‚   â”œâ”€â”€ settings_manager.rs      - è®¾ç½®æŒä¹…åŒ– (å·²åºŸå¼ƒï¼Œä½¿ç”¨ç¼“å­˜å±‚)
â”‚   â”œâ”€â”€ markdown_manager.rs      - Markdown æ–‡ä»¶å¤„ç†
â”‚   â”œâ”€â”€ plugins_manager.rs       - æ’ä»¶ç®¡ç†
â”‚   â”œâ”€â”€ checkin/                 - ç­¾åˆ°ç®¡ç†å™¨ (SQLite-backed)
â”‚   â”‚   â”œâ”€â”€ account_manager.rs   - è´¦å·ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ provider_manager.rs  - æä¾›å•†ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ record_manager.rs    - ç­¾åˆ°è®°å½•ç®¡ç†
â”‚   â”‚   â””â”€â”€ balance_manager.rs   - ä½™é¢å¿«ç…§ç®¡ç†
â”‚   â””â”€â”€ config/                  - é…ç½®æ–‡ä»¶ç®¡ç†å™¨
â”‚       â”œâ”€â”€ claude_manager.rs
â”‚       â”œâ”€â”€ codex_manager.rs
â”‚       â”œâ”€â”€ gemini_manager.rs
â”‚       â”œâ”€â”€ qwen_manager.rs
â”‚       â””â”€â”€ platform_manager.rs
â”‚
â”œâ”€â”€ Database Layer (æ•°æ®åº“å±‚)    - SQLite ç»Ÿä¸€å­˜å‚¨ (v3.19.0+)
â”‚   â”œâ”€â”€ mod.rs                   - æ•°æ®åº“åˆå§‹åŒ–ä¸è¿æ¥ç®¡ç†
â”‚   â”œâ”€â”€ schema.rs                - è¡¨ç»“æ„å®šä¹‰ (11 tables)
â”‚   â”œâ”€â”€ migrations.rs            - Schema è¿ç§»ä¸ JSON æ•°æ®å¯¼å…¥
â”‚   â””â”€â”€ repositories/            - æ•°æ®è®¿é—®å¯¹è±¡ (DAO)
â”‚       â”œâ”€â”€ checkin_repo.rs      - ç­¾åˆ°æ•°æ®ä»“åº“
â”‚       â”œâ”€â”€ ui_state_repo.rs     - UI çŠ¶æ€ä»“åº“
â”‚       â”œâ”€â”€ log_repo.rs          - æ—¥å¿—ä»“åº“
â”‚       â””â”€â”€ usage_repo.rs        - ä½¿ç”¨é‡ä»“åº“
â”‚
â”œâ”€â”€ Cache Layer (ç¼“å­˜å±‚)         - å…¨å±€ç¼“å­˜ã€æ€§èƒ½ä¼˜åŒ– (v3.15.0+)
â”‚   â””â”€â”€ mod.rs                   - å…¨å±€è®¾ç½®ç¼“å­˜ (30s TTL, 80% I/O å‡å°‘)
â”‚
â”œâ”€â”€ Models Layer (æ¨¡å‹å±‚)        - æ•°æ®ç»“æ„ã€åºåˆ—åŒ–ã€éªŒè¯
â”‚   â”œâ”€â”€ api.rs                   - API æ¨¡å‹ (MCP, Agent, etc.)
â”‚   â”œâ”€â”€ converter.rs             - è½¬æ¢æ¨¡å‹
â”‚   â””â”€â”€ platforms/               - å¹³å°ç‰¹å®šæ¨¡å‹
â”‚
â”œâ”€â”€ Core Layer (æ ¸å¿ƒå±‚)          - åŸºç¡€è®¾æ–½ (é”™è¯¯ã€å‘½ä»¤æ‰§è¡Œ)
â”‚   â”œâ”€â”€ error.rs                 - é”™è¯¯ç±»å‹ä¸å¤„ç†
â”‚   â””â”€â”€ executor.rs              - CCR å‘½ä»¤æ‰§è¡Œå™¨
â”‚
â””â”€â”€ Utils Layer (å·¥å…·å±‚)         - é€šç”¨å·¥å…·ä¸è¾…åŠ©å‡½æ•°
    â””â”€â”€ config_reader.rs         - é€šç”¨é…ç½®å·¥å…·
```

**å…³é”®åŸåˆ™**:
- **ä¸¥æ ¼å•å‘ä¾èµ–**: API â†’ Services â†’ Managers â†’ Database â†’ Models/Core/Utils
- **æ— å¾ªç¯ä¾èµ–**: ä¾èµ–åªèƒ½å‘ä¸‹æµåŠ¨
- **å…³æ³¨ç‚¹åˆ†ç¦»**: æ¯å±‚èŒè´£æ˜ç¡®
- **åŸå­æ–‡ä»¶æ“ä½œ**: Managers å±‚ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ + åŸå­é‡å‘½å
- **å¹³å°éš”ç¦»**: å¹³å°ç‰¹å®šä»£ç åœ¨å­æ¨¡å—ä¸­éš”ç¦»
- **ç»Ÿä¸€å­˜å‚¨**: åº”ç”¨æ•°æ®ä½¿ç”¨ SQLiteï¼Œå¤–éƒ¨å¹³å°é…ç½®ä½¿ç”¨åŸç”Ÿæ ¼å¼

---

## é¡¹ç›®æŠ€æœ¯æ ˆ

### æ ¸å¿ƒæ¡†æ¶

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Rust** | 2024 Edition | ç¼–ç¨‹è¯­è¨€ |
| **Axum** | 0.7+ | Web æ¡†æ¶ |
| **Tokio** | 1.42+ | å¼‚æ­¥è¿è¡Œæ—¶ |
| **Tower** | 0.5+ | æœåŠ¡æŠ½è±¡å±‚ |
| **Tower-HTTP** | 0.6+ | HTTP ä¸­é—´ä»¶ (CORS, å‹ç¼©, è¿½è¸ª) |

### åºåˆ—åŒ–ä¸è§£æ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **Serde** | 1.0+ | åºåˆ—åŒ–æ¡†æ¶ |
| **serde_json** | 1.0+ | JSON æ”¯æŒ |
| **toml** | 0.9+ | TOML è§£æ |
| **serde_yaml** | 0.9+ | YAML è§£æ |
| **chrono** | 0.4+ | æ—¥æœŸæ—¶é—´å¤„ç† |

### æ•°æ®åº“

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **rusqlite** | 0.38+ | SQLite ç»‘å®š |
| **uuid** | 1.0+ | UUID ç”Ÿæˆ |

### é”™è¯¯å¤„ç†ä¸æ—¥å¿—

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **anyhow** | 1.0+ | çµæ´»é”™è¯¯å¤„ç† |
| **thiserror** | 2.0+ | è‡ªå®šä¹‰é”™è¯¯å® |
| **tracing** | 0.1+ | ç»“æ„åŒ–æ—¥å¿— |
| **tracing-subscriber** | 0.3+ | æ—¥å¿—è®¢é˜…å™¨ |
| **tracing-appender** | 0.2+ | æ—¥å¿—æ–‡ä»¶è½®æ¢ |

### CLI ä¸ç³»ç»Ÿ

| æŠ€æœ¯ | ç‰ˆæœ¬ | ç”¨é€” |
|------|------|------|
| **clap** | 4.5+ | å‘½ä»¤è¡Œå‚æ•°è§£æ |
| **whoami** | 1.5+ | ç”¨æˆ·è¯†åˆ« |
| **num_cpus** | 1.16+ | CPU æ ¸å¿ƒæ•° |
| **sysinfo** | 0.32+ | ç³»ç»Ÿä¿¡æ¯ |

---

## é¡¹ç›®æ¨¡å—åˆ’åˆ†

### æ–‡ä»¶ä¸æ–‡ä»¶å¤¹å¸ƒå±€

```
ccr-ui/backend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ main.rs                              # å…¥å£ç‚¹ä¸è·¯ç”±é…ç½®
â”‚   â”‚
â”‚   â”œâ”€â”€ api/                                 # API å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â””â”€â”€ handlers/
â”‚   â”‚       â”œâ”€â”€ mod.rs                       # Handler å¯¼å‡º
â”‚   â”‚       â”œâ”€â”€ config.rs                    # CCR é…ç½®ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ command.rs                   # å‘½ä»¤æ‰§è¡Œç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ system.rs                    # ç³»ç»Ÿä¿¡æ¯ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ version.rs                   # ç‰ˆæœ¬ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ sync.rs                      # WebDAV åŒæ­¥ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ mcp.rs                       # Claude MCP ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ agents.rs                    # Claude Agents ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ slash_commands.rs            # Claude æ–œæ å‘½ä»¤
â”‚   â”‚       â”œâ”€â”€ plugins.rs                   # Claude æ’ä»¶ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ converter.rs                 # é…ç½®è½¬æ¢ç«¯ç‚¹
â”‚   â”‚       â”œâ”€â”€ platform.rs                  # å¹³å°ç®¡ç†ç«¯ç‚¹
â”‚   â”‚       â””â”€â”€ platforms/                   # å¹³å°ç‰¹å®šå¤„ç†å™¨
â”‚   â”‚           â”œâ”€â”€ mod.rs
â”‚   â”‚           â”œâ”€â”€ codex.rs                 # Codex ç«¯ç‚¹
â”‚   â”‚           â”œâ”€â”€ gemini.rs                # Gemini CLI ç«¯ç‚¹
â”‚   â”‚           â”œâ”€â”€ qwen.rs                  # Qwen ç«¯ç‚¹
â”‚   â”‚           â””â”€â”€ iflow.rs                 # iFlow ç«¯ç‚¹ (stub)
â”‚   â”‚
â”‚   â”œâ”€â”€ services/                            # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ commands.rs                      # å‘½ä»¤æœåŠ¡
â”‚   â”‚   â””â”€â”€ converter_service.rs             # è½¬æ¢æœåŠ¡
â”‚   â”‚
â”‚   â”œâ”€â”€ managers/                            # ç®¡ç†å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ settings_manager.rs              # è®¾ç½®æŒä¹…åŒ– (å·²åºŸå¼ƒ)
â”‚   â”‚   â”œâ”€â”€ markdown_manager.rs              # Markdown æ–‡ä»¶å¤„ç†
â”‚   â”‚   â”œâ”€â”€ plugins_manager.rs               # æ’ä»¶ç®¡ç†
â”‚   â”‚   â””â”€â”€ config/                          # é…ç½®æ–‡ä»¶ç®¡ç†å™¨
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â”œâ”€â”€ claude_manager.rs            # Claude é…ç½®è¯»å†™
â”‚   â”‚       â”œâ”€â”€ codex_manager.rs             # Codex é…ç½®è¯»å†™
â”‚   â”‚       â”œâ”€â”€ gemini_manager.rs            # Gemini é…ç½®è¯»å†™
â”‚   â”‚       â”œâ”€â”€ qwen_manager.rs              # Qwen é…ç½®è¯»å†™
â”‚   â”‚       â””â”€â”€ platform_manager.rs          # å¹³å°é…ç½®ç®¡ç†
â”‚   â”‚
â”‚   â”œâ”€â”€ cache/                               # ç¼“å­˜å±‚ (v3.15.0+)
â”‚   â”‚   â””â”€â”€ mod.rs                           # å…¨å±€è®¾ç½®ç¼“å­˜
â”‚   â”‚
â”‚   â”œâ”€â”€ database/                            # æ•°æ®åº“å±‚ (v3.19.0+)
â”‚   â”‚   â”œâ”€â”€ mod.rs                           # æ•°æ®åº“åˆå§‹åŒ–
â”‚   â”‚   â”œâ”€â”€ schema.rs                        # è¡¨ç»“æ„å®šä¹‰
â”‚   â”‚   â”œâ”€â”€ migrations.rs                    # è¿ç§»é€»è¾‘
â”‚   â”‚   â””â”€â”€ repositories/                    # æ•°æ®ä»“åº“
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â”œâ”€â”€ checkin_repo.rs              # ç­¾åˆ°æ•°æ®
â”‚   â”‚       â”œâ”€â”€ ui_state_repo.rs             # UI çŠ¶æ€
â”‚   â”‚       â”œâ”€â”€ log_repo.rs                  # æ—¥å¿—
â”‚   â”‚       â””â”€â”€ usage_repo.rs                # ä½¿ç”¨é‡
â”‚   â”‚
â”‚   â”œâ”€â”€ models/                              # æ¨¡å‹å±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ api.rs                           # API æ¨¡å‹
â”‚   â”‚   â”œâ”€â”€ converter.rs                     # è½¬æ¢æ¨¡å‹
â”‚   â”‚   â””â”€â”€ platforms/                       # å¹³å°ç‰¹å®šæ¨¡å‹
â”‚   â”‚       â”œâ”€â”€ mod.rs
â”‚   â”‚       â”œâ”€â”€ codex.rs                     # Codex æ•°æ®æ¨¡å‹
â”‚   â”‚       â”œâ”€â”€ gemini.rs                    # Gemini æ•°æ®æ¨¡å‹
â”‚   â”‚       â””â”€â”€ qwen.rs                      # Qwen æ•°æ®æ¨¡å‹
â”‚   â”‚
â”‚   â”œâ”€â”€ core/                                # æ ¸å¿ƒå±‚
â”‚   â”‚   â”œâ”€â”€ mod.rs
â”‚   â”‚   â”œâ”€â”€ error.rs                         # é”™è¯¯ç±»å‹ä¸å¤„ç†
â”‚   â”‚   â””â”€â”€ executor.rs                      # CCR å‘½ä»¤æ‰§è¡Œå™¨
â”‚   â”‚
â”‚   â””â”€â”€ utils/                               # å·¥å…·å±‚
â”‚       â”œâ”€â”€ mod.rs
â”‚       â””â”€â”€ config_reader.rs                 # é€šç”¨é…ç½®å·¥å…·
â”‚
â”œâ”€â”€ Cargo.toml                               # Rust ä¾èµ–
â”œâ”€â”€ logs/                                    # æ—¥å¿—æ–‡ä»¶(è‡ªåŠ¨åˆ›å»º)
â””â”€â”€ .gitignore                               # Git å¿½ç•¥è§„åˆ™
```

---

## é¡¹ç›®ä»£ç é£æ ¼ä¸è§„èŒƒ

### å‘½åçº¦å®š

#### Rust å‘½åè§„èŒƒ
- **æ¨¡å—å**: `snake_case` (å¦‚ `config_manager`, `slash_commands`)
- **ç±»å‹å**: `PascalCase` (å¦‚ `McpServer`, `SystemInfo`)
- **å‡½æ•°å**: `snake_case` (å¦‚ `list_mcp_servers`, `execute_command`)
- **å¸¸é‡**: `SCREAMING_SNAKE_CASE` (å¦‚ `DEFAULT_PORT`, `MAX_RETRIES`)

### ä»£ç é£æ ¼

- **æ ¼å¼åŒ–**: ä½¿ç”¨ `cargo fmt`
- **æ£€æŸ¥**: é€šè¿‡ `cargo clippy --workspace --all-targets --all-features -- -D warnings -W clippy::unwrap_used`
- **é”™è¯¯å¤„ç†**: ä½¿ç”¨ `Result` ä¸è‡ªå®šä¹‰é”™è¯¯ç±»å‹
- **æ—¥å¿—**: ä½¿ç”¨ `tracing` ç»“æ„åŒ–æ—¥å¿—
- **æ–‡æ¡£**: `///` æ³¨é‡Šå…¬å¼€ API
- **åŸå­æ“ä½œ**: æ–‡ä»¶å†™å…¥ä½¿ç”¨ä¸´æ—¶æ–‡ä»¶ + åŸå­é‡å‘½å
- **å¹¶å‘å®‰å…¨**: ä½¿ç”¨ Tokio çš„å¼‚æ­¥ I/O
- **æµ‹è¯•ä»£ç è§„èŒƒ**: æµ‹è¯•æ¨¡å—ä½¿ç”¨ `#[allow(clippy::unwrap_used)]` å±æ€§å…è®¸ `unwrap()`ï¼ˆæ ‡å‡†åšæ³•ï¼‰

---

## æµ‹è¯•ä¸è´¨é‡

### ä»£ç è´¨é‡æ£€æŸ¥

```bash
# ç¼–è¯‘æ£€æŸ¥
cargo check

# Clippy æ£€æŸ¥ (æ ‡å‡†)
cargo clippy --workspace --all-targets --all-features -- -D warnings

# Clippy æ£€æŸ¥ (ä¸¥æ ¼ï¼Œå¯¹é½ CI)
cargo clippy --workspace --all-targets --all-features -- -D warnings -W clippy::unwrap_used

# æ ¼å¼åŒ–æ£€æŸ¥
cargo fmt --check

# æ„å»º
cargo build

# å‘å¸ƒæ„å»º
cargo build --release
```

### è´¨é‡ç›®æ ‡

- âœ… **é›¶ç¼–è¯‘é”™è¯¯**: æ‰€æœ‰ä»£ç é€šè¿‡ `cargo check`
- âœ… **é›¶ Clippy è­¦å‘Š**: ä»£ç ç¬¦åˆ Clippy è§„åˆ™ï¼ˆä½¿ç”¨ `-D warnings -W clippy::unwrap_used`ï¼‰
- âœ… **ä»£ç æ ¼å¼åŒ–**: ä½¿ç”¨ `cargo fmt`
- âœ… **æµ‹è¯•ä»£ç è§„èŒƒ**: æµ‹è¯•æ¨¡å—å…è®¸ `unwrap()` ä½¿ç”¨ `#[allow(clippy::unwrap_used)]`
- ğŸš§ **å•å…ƒæµ‹è¯•è¦†ç›–ç‡**: (å¾…é…ç½®) ç›®æ ‡ 80%+

---

## é¡¹ç›®æ„å»ºã€æµ‹è¯•ä¸è¿è¡Œ

### ç¯å¢ƒè¦æ±‚

- **Rust**: 1.88+ (Edition 2024)
- **Cargo**: æœ€æ–°ç¨³å®šç‰ˆ

### å¼€å‘å‘½ä»¤

```bash
# å®‰è£…ä¾èµ–(è‡ªåŠ¨)
cargo build

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
cargo run

# è‡ªå®šä¹‰ç«¯å£
cargo run -- --port 8082

# å¯ç”¨è°ƒè¯•æ—¥å¿—
RUST_LOG=debug cargo run

# æ ¼å¼åŒ–ä»£ç 
cargo fmt

# ä»£ç æ£€æŸ¥
cargo clippy

# å‘å¸ƒæ„å»º
cargo build --release

# è¿è¡Œæµ‹è¯•
cargo test
```

### ç¯å¢ƒå˜é‡

```bash
# æ—¥å¿—çº§åˆ«
RUST_LOG=debug              # trace | debug | info | warn | error

# æœåŠ¡å™¨é…ç½®
HOST=127.0.0.1              # ç»‘å®šåœ°å€
PORT=8081                   # ç›‘å¬ç«¯å£
```

### ç”Ÿäº§æ„å»º

```bash
cargo build --release

# äºŒè¿›åˆ¶æ–‡ä»¶:
# target/release/ccr-ui-backend

# è¿è¡Œ:
./target/release/ccr-ui-backend --port 8081
```

---

## Git å·¥ä½œæµç¨‹

### åˆ†æ”¯ç­–ç•¥

- **main**: ä¸»åˆ†æ”¯,ç”Ÿäº§ç¯å¢ƒä»£ç 
- **dev**: å¼€å‘åˆ†æ”¯,æµ‹è¯•ç¯å¢ƒä»£ç 
- **feature/***: åŠŸèƒ½åˆ†æ”¯
- **bugfix/***: Bug ä¿®å¤åˆ†æ”¯

### æäº¤è§„èŒƒ

éµå¾ª Conventional Commits è§„èŒƒ:

```bash
# åŠŸèƒ½å¼€å‘
git commit -m "feat(åç«¯): æ·»åŠ é¢„ç®—ç®¡ç† API"

# Bug ä¿®å¤
git commit -m "fix(åç«¯): ä¿®å¤é…ç½®æ–‡ä»¶è§£æé”™è¯¯"

# é‡æ„
git commit -m "refactor(åç«¯): é‡æ„ä¸ºåˆ†å±‚æ¶æ„"

# æ€§èƒ½ä¼˜åŒ–
git commit -m "perf(åç«¯): ä¼˜åŒ–é…ç½®æ–‡ä»¶è¯»å–æ€§èƒ½"

# æ–‡æ¡£æ›´æ–°
git commit -m "docs(åç«¯): æ›´æ–° API æ–‡æ¡£"

# æµ‹è¯•
git commit -m "test(åç«¯): æ·»åŠ  MCP ç«¯ç‚¹é›†æˆæµ‹è¯•"
```

---

## æ–‡æ¡£ç›®å½•

### æ–‡æ¡£å­˜å‚¨è§„èŒƒ

- **æ¨¡å—æ–‡æ¡£**: `/ccr-ui/backend/CLAUDE.md` (æœ¬æ–‡ä»¶)
- **ä¸Šçº§æ–‡æ¡£**: `/ccr-ui/CLAUDE.md` (CCR UI æ€»è§ˆ)
- **æ ¹æ–‡æ¡£**: `/CLAUDE.md` (é¡¹ç›®æ€»è§ˆ)
- **å‰ç«¯æ–‡æ¡£**: `/ccr-ui/frontend/CLAUDE.md` (å‰ç«¯æ¨¡å—)

---

## å¸¸è§é—®é¢˜

### Q: åç«¯å¦‚ä½•ä¸ CCR CLI é€šä¿¡?

A: åç«¯ä½¿ç”¨ `executor` æ¨¡å—å°† CCR ä½œä¸ºå­è¿›ç¨‹ç”Ÿæˆå¹¶æ•è·å…¶è¾“å‡ºã€‚è¿™ç¡®ä¿åç«¯ä¸é‡å¤ CCR çš„é€»è¾‘,å§‹ç»ˆä½¿ç”¨è§„èŒƒå®ç°ã€‚

### Q: å¦‚ä½•å®‰å…¨åœ°ä¿®æ”¹é…ç½®æ–‡ä»¶?

A: æ‰€æœ‰é…ç½®ç®¡ç†å™¨ä½¿ç”¨åŸå­æ–‡ä»¶æ“ä½œ:
1. è¯»å–ç°æœ‰é…ç½®
2. åœ¨å†…å­˜ä¸­è§£æå’Œä¿®æ”¹
3. å†™å…¥ä¸´æ—¶æ–‡ä»¶
4. åŸå­é‡å‘½ååˆ°ç›®æ ‡æ–‡ä»¶

å³ä½¿è¿›ç¨‹å´©æºƒ,è¿™ä¹Ÿèƒ½é˜²æ­¢æŸåã€‚

### Q: å¦‚ä½•å¯ç”¨ CORS?

A: é»˜è®¤æƒ…å†µä¸‹,CORS å…è®¸æ‰€æœ‰æ¥æºã€‚å¯¹äºç”Ÿäº§ç¯å¢ƒ,ä¿®æ”¹ `main.rs` ä¸­çš„ CORS å±‚ã€‚

### Q: æ—¥å¿—å¦‚ä½•ç®¡ç†?

A: æ—¥å¿—å†™å…¥ `logs/` ç›®å½•,æ¯æ—¥è½®æ¢ã€‚`tracing-appender` crate è‡ªåŠ¨å¤„ç†è½®æ¢ã€‚é»˜è®¤ä¿ç•™ 7 å¤©çš„æ—§æ—¥å¿—ã€‚

### Q: æ•°æ®å¦‚ä½•å­˜å‚¨? (v3.19.0+)

A: åç«¯ä½¿ç”¨**åŒè½¨å­˜å‚¨ç­–ç•¥**:

1. **SQLite ç»Ÿä¸€å­˜å‚¨** (`~/.ccr/ccr.db`) - åº”ç”¨è‡ªèº«æ•°æ®:
   - UI æ”¶è—å¤¹å’Œå‘½ä»¤å†å²
   - ç­¾åˆ°æä¾›å•†ã€è´¦å·ã€è®°å½•ã€ä½™é¢å¿«ç…§
   - WAF Cookie ç¼“å­˜
   - ç»“æ„åŒ–æ—¥å¿—æ¡ç›®
   - Claude/Codex/Gemini ä½¿ç”¨é‡è®°å½•

2. **åŸç”Ÿæ ¼å¼è¯»å–** - å¤–éƒ¨å¹³å°é…ç½® (åªè¯»æˆ–æŒ‰éœ€å†™å…¥):
   - `~/.claude.json` - Claude MCP é…ç½®
   - `~/.codex/config.json` - Codex é…ç½®
   - `~/.gemini/settings.json` - Gemini é…ç½®
   - å¹³å° projects ç›®å½•ä¸‹çš„ `.jsonl` ä½¿ç”¨æ—¥å¿—

**è¿ç§»**: é¦–æ¬¡å¯åŠ¨æ—¶è‡ªåŠ¨ä»æ—§ JSON æ–‡ä»¶ (`~/.ccr/*.json`) è¿ç§»æ•°æ®åˆ° SQLiteã€‚

### Q: å¦‚ä½•è®¿é—®æ•°æ®åº“?

A: ä½¿ç”¨ `database::with_connection()` è·å–çº¿ç¨‹å®‰å…¨è¿æ¥:

```rust
use crate::database;

database::with_connection(|conn| {
    // conn: &rusqlite::Connection
    checkin_repo::get_all_accounts(conn)
})?
```

---

**æœ¬å°å§ç²¾å¿ƒæ•´ç†çš„åç«¯æ¨¡å—æ–‡æ¡£å®Œæˆå•¦ï¼åˆ†å±‚æ¶æ„æ¸…æ™°æ˜äº†ï¼Œè¿™æ‰æ˜¯ä¸“ä¸šçš„åšæ³•å‘¢ï½(ï¿£â–½ï¿£)ï¼**
