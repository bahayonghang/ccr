# CCR UI Documentation Justfile
# å¿«é€Ÿæ„å»ºå’Œç®¡ç† CCR UI é¡¹ç›®æ–‡æ¡£çš„å‘½ä»¤é›†åˆ

# é»˜è®¤å‘½ä»¤ - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
default:
    @just --list

# æ£€æŸ¥ä¾èµ–æ˜¯å¦å·²å®‰è£…
_check-deps:
    #!/usr/bin/env bash
    if [ ! -d "node_modules" ]; then
        echo "âŒ ä¾èµ–æœªå®‰è£…ï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£…..."
        npm install
        echo "âœ… ä¾èµ–å®‰è£…å®Œæˆï¼"
    fi

# å®‰è£…ä¾èµ–
install:
    @echo "ğŸ“¦ å®‰è£… CCR UI æ–‡æ¡£ä¾èµ–..."
    npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
dev: _check-deps
    @echo "ğŸš€ å¯åŠ¨ CCR UI æ–‡æ¡£å¼€å‘æœåŠ¡å™¨..."
    @echo "ğŸ“ è®¿é—® http://localhost:5173"
    npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
build: _check-deps
    @echo "ğŸ—ï¸  æ„å»º CCR UI æ–‡æ¡£ç”Ÿäº§ç‰ˆæœ¬..."
    npm run build
    @echo "âœ… æ„å»ºå®Œæˆï¼è¾“å‡ºç›®å½•: .vitepress/dist"

# é¢„è§ˆç”Ÿäº§æ„å»º
preview: build
    @echo "ğŸ‘€ é¢„è§ˆ CCR UI æ–‡æ¡£ç”Ÿäº§ç‰ˆæœ¬..."
    @echo "ğŸ“ è®¿é—® http://localhost:4173"
    npm run preview

# æœåŠ¡ç”Ÿäº§æ„å»º
serve: build
    @echo "ğŸŒ æœåŠ¡ CCR UI æ–‡æ¡£ç”Ÿäº§ç‰ˆæœ¬..."
    @echo "ğŸ“ è®¿é—® http://localhost:4173"
    npm run serve

# æ¸…ç†æ„å»ºæ–‡ä»¶å’Œç¼“å­˜
clean:
    @echo "ğŸ§¹ æ¸…ç† CCR UI æ–‡æ¡£æ„å»ºæ–‡ä»¶..."
    rm -rf .vitepress/dist
    rm -rf .vitepress/cache
    rm -rf node_modules/.cache
    @echo "âœ… æ¸…ç†å®Œæˆï¼"

# å®Œå…¨æ¸…ç†(åŒ…æ‹¬ node_modules)
clean-all: clean
    @echo "ğŸ§¹ å®Œå…¨æ¸…ç† CCR UI æ–‡æ¡£..."
    rm -rf node_modules
    @echo "âœ… å®Œå…¨æ¸…ç†å®Œæˆï¼"

# é‡æ–°å®‰è£…ä¾èµ–
reinstall: clean-all install
    @echo "âœ… CCR UI æ–‡æ¡£é‡æ–°å®‰è£…å®Œæˆï¼"

# æ£€æŸ¥å®‰å…¨æ¼æ´
audit:
    @echo "ğŸ” æ£€æŸ¥ CCR UI æ–‡æ¡£å®‰å…¨æ¼æ´..."
    npm audit

# ä¿®å¤å®‰å…¨æ¼æ´(éç ´åæ€§)
audit-fix:
    @echo "ğŸ”§ ä¿®å¤ CCR UI æ–‡æ¡£å®‰å…¨æ¼æ´..."
    npm audit fix

# æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬
update:
    @echo "â¬†ï¸  æ›´æ–° CCR UI æ–‡æ¡£ä¾èµ–..."
    npm update
    @echo "âœ… æ›´æ–°å®Œæˆï¼"

# æ£€æŸ¥è¿‡æœŸçš„ä¾èµ–
outdated:
    @echo "ğŸ“Š æ£€æŸ¥ CCR UI æ–‡æ¡£è¿‡æœŸä¾èµ–..."
    npm outdated

# å¿«é€Ÿé‡å»º(æ¸…ç†åé‡æ–°æ„å»º)
rebuild: clean build
    @echo "âœ… CCR UI æ–‡æ¡£é‡å»ºå®Œæˆï¼"

# éªŒè¯æ„å»º(æ„å»ºå¹¶æ£€æŸ¥è¾“å‡º)
verify: build
    @echo "âœ… éªŒè¯ CCR UI æ–‡æ¡£æ„å»ºç»“æœ..."
    @ls -lh .vitepress/dist
    @echo ""
    @echo "ğŸ“Š æ–‡ä»¶æ•°é‡ç»Ÿè®¡:"
    @find .vitepress/dist -type f | wc -l
    @echo ""
    @echo "ğŸ’¾ æ€»å¤§å°:"
    @du -sh .vitepress/dist

# å¼€å‘ç¯å¢ƒå®Œæ•´è®¾ç½®
setup: install
    @echo "ğŸ‰ CCR UI æ–‡æ¡£å¼€å‘ç¯å¢ƒè®¾ç½®å®Œæˆï¼"
    @echo ""
    @echo "å¯ç”¨å‘½ä»¤:"
    @echo "  just dev      - å¯åŠ¨å¼€å‘æœåŠ¡å™¨"
    @echo "  just build    - æ„å»ºç”Ÿäº§ç‰ˆæœ¬"
    @echo "  just preview  - é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬"
    @echo "  just serve    - æœåŠ¡ç”Ÿäº§ç‰ˆæœ¬"
    @echo ""

# ç”Ÿäº§éƒ¨ç½²å‡†å¤‡
deploy: clean build verify
    @echo "ğŸš€ CCR UI æ–‡æ¡£ç”Ÿäº§éƒ¨ç½²å‡†å¤‡å®Œæˆï¼"
    @echo "ğŸ“¦ éƒ¨ç½²ç›®å½•: .vitepress/dist"

# æ ¼å¼åŒ– justfile
fmt:
    @echo "âœ¨ æ ¼å¼åŒ– CCR UI æ–‡æ¡£ justfile..."
    just --fmt --unstable

# å¿«é€Ÿå¼€å‘ - æ£€æŸ¥ä¾èµ–å¹¶å¯åŠ¨å¼€å‘æœåŠ¡å™¨
quick-dev: dev

# å¿«é€Ÿéƒ¨ç½² - å®Œæ•´çš„éƒ¨ç½²æµç¨‹
quick-deploy: clean install build verify
    @echo "ğŸš€ CCR UI æ–‡æ¡£å¿«é€Ÿéƒ¨ç½²å®Œæˆï¼"

# å¥åº·æ£€æŸ¥ - æ£€æŸ¥é¡¹ç›®çŠ¶æ€
health:
    #!/usr/bin/env bash
    echo "ğŸ¥ CCR UI æ–‡æ¡£é¡¹ç›®å¥åº·æ£€æŸ¥..."
    echo ""
    echo "ğŸ“¦ Node.js ç‰ˆæœ¬:"
    if command -v node &> /dev/null; then
        node --version
    else
        echo "âŒ Node.js æœªå®‰è£…"
    fi
    echo ""
    echo "ğŸ“¦ npm ç‰ˆæœ¬:"
    if command -v npm &> /dev/null; then
        npm --version
    else
        echo "âŒ npm æœªå®‰è£…"
    fi
    echo ""
    echo "ğŸ“ é¡¹ç›®ç›®å½•:"
    pwd
    echo ""
    echo "ğŸ“Š ä¾èµ–çŠ¶æ€:"
    if [ -d "node_modules" ]; then
        echo "âœ… ä¾èµ–å·²å®‰è£…"
        if [ -f "node_modules/.bin/vitepress" ]; then
            echo "âœ… VitePress å·²å®‰è£…"
        else
            echo "âš ï¸  VitePress æœªæ‰¾åˆ°ï¼Œå°è¯•é‡æ–°å®‰è£…"
        fi
    else
        echo "âŒ ä¾èµ–æœªå®‰è£… - è¿è¡Œ 'just install' æˆ– 'just dev'"
    fi
    echo ""
    echo "ğŸ—ï¸  æ„å»ºçŠ¶æ€:"
    if [ -d ".vitepress/dist" ]; then
        echo "âœ… å·²æ„å»º"
        echo "   æ–‡ä»¶æ•°: $(find .vitepress/dist -type f | wc -l)"
    else
        echo "âŒ æœªæ„å»º - è¿è¡Œ 'just build'"
    fi

# æ˜¾ç¤ºé¡¹ç›®ä¿¡æ¯
info:
    #!/usr/bin/env bash
    echo "ğŸ“‹ CCR UI æ–‡æ¡£é¡¹ç›®ä¿¡æ¯"
    echo "========================"
    echo "é¡¹ç›®åç§°: CCR UI Documentation"
    echo "æ–‡æ¡£å¼•æ“: VitePress"
    echo "å¼€å‘ç«¯å£: 5173"
    echo "é¢„è§ˆç«¯å£: 4173"
    echo "æ„å»ºç›®å½•: .vitepress/dist"
    echo ""
    echo "ğŸ“š æ–‡æ¡£ç»“æ„:"
    echo "  - backend/     åç«¯æ–‡æ¡£"
    echo "  - frontend/    å‰ç«¯æ–‡æ¡£"
    echo "  - guide/       ç”¨æˆ·æŒ‡å—"
    echo ""
    if [ -f "package.json" ]; then
        echo "ğŸ“¦ ä¸»è¦ä¾èµ–ç‰ˆæœ¬:"
        if [ -d "node_modules" ]; then
            if command -v jq &> /dev/null; then
                jq -r '.dependencies | to_entries | .[] | "  - \(.key): \(.value)"' package.json 2>/dev/null || \
                echo "  è¿è¡Œ 'npm list --depth=0' æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"
            else
                echo "  è¿è¡Œ 'npm list --depth=0' æŸ¥çœ‹è¯¦ç»†ä¿¡æ¯"
            fi
        else
            echo "  âš ï¸  ä¾èµ–æœªå®‰è£…"
        fi
        echo ""
    fi