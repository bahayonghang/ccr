# Statistics & Cost Analysis

CCR UI provides complete API usage statistics and cost tracking features to help you gain deep insights into AI API usage and associated costs.

## Feature Overview

Statistics features include:

- ‚úÖ **Real-time Cost Tracking** - Precisely record the cost of each API call
- ‚úÖ **Multi-dimensional Statistics** - Analyze by time, model, and project groupings
- ‚úÖ **Visual Dashboard** - Intuitive data presentation
- ‚úÖ **Trend Analysis** - View daily cost trends
- ‚úÖ **Data Export** - Support JSON format export
- ‚úÖ **Responsive Design** - Support desktop and mobile devices
- ‚úÖ **Dark Mode** - Complete dark mode support

## Accessing Statistics Page

### Via Navigation Menu

1. Start CCR UI
2. Click "Statistics" or "ÁªüËÆ°ÂàÜÊûê" in the left navigation bar
3. Visit `http://localhost:5173/stats`

### Via Dashboard

1. Find the "üìä Statistics Analysis" card on the Dashboard homepage
2. Click the "View Details" button

## Interface Introduction

### Overview Cards

Four key metric cards displayed at the top of the page:

#### üí∞ Total Cost
- Display total cost for the selected time range (USD)
- Precise to 4 decimal places

#### üìä API Call Count
- Display total number of API calls
- Reflects usage frequency

#### üì• Input Tokens
- Display the number of tokens sent to the AI
- Uses K/M simplified display (e.g., 1.5M)

#### üì§ Output Tokens
- Display the number of tokens generated by the AI
- Uses K/M simplified display

### Detailed Token Statistics

Shows more detailed token usage information:

- **Cache Tokens** - Number of tokens using Prompt Caching
- **Cache Efficiency** - Cache read tokens / Total cache tokens √ó 100%
- **Total Tokens** - Sum of all tokens

### Group by Model

Shows cost distribution for different Claude models:

```
ü§ñ Group by Model
‚Ä¢ 3-5-sonnet-20241022 ......... $85.2000
‚Ä¢ 3-5-haiku-20241022 ........... $32.1000
‚Ä¢ 3-opus-20240229 .............. $10.1500
```

### Group by Project

Shows cost distribution for different projects (Top 10):

```
üìÅ Group by Project (Top 10)
‚Ä¢ project-a .................... $45.0000
‚Ä¢ project-b .................... $35.2000
‚Ä¢ project-c .................... $28.0000
```

### Cost Trend

Shows cost trends for the last 7 days:

```
üìà Cost Trend
2025-10-27 - $12.3456 (156 calls)
2025-10-26 - $8.9012 (123 calls)
2025-10-25 - $15.6789 (189 calls)
```

## Feature Usage

### Time Range Selection

Use the dropdown menu in the upper right corner of the page to select time range:

- **Today** - View today's statistics
- **This Week** - View this week's statistics
- **This Month** - View this month's statistics

Data will automatically refresh after selection.

### Refresh Data

Click the "üîÑ Refresh" button to get the latest data:

- Button shows a rotation animation during data loading
- Refresh retrieves the latest data from the server
- Useful for updating data after keeping the page open for a long time

### Empty State

If there's no statistics data yet, the page will display:

```
üìä No Statistics Data
Statistics will appear here after you start using the AI API
```

### Error Handling

If data loading fails, an error message will be displayed:

```
‚ùå Loading Failed
[Error message]
```

## Data Format Specification

### Cost Calculation

CCR uses Anthropic's official pricing to calculate costs:

| Model | Input ($/M) | Output ($/M) | Cache Read ($/M) | Cache Write ($/M) |
|-------|------------|--------------|------------------|-------------------|
| Claude 3.5 Sonnet | $3.00 | $15.00 | $0.30 | $3.75 |
| Claude 3.5 Haiku | $1.00 | $5.00 | $0.10 | $1.25 |
| Claude 3 Opus | $15.00 | $75.00 | $1.50 | $18.75 |
| Claude 4.5 Sonnet | $3.00 | $15.00 | $0.30 | $3.75 |
| Claude 4.1 Opus | $15.00 | $75.00 | $1.50 | $18.75 |

### Token Statistics

- **Input Tokens**: Text sent by users to the AI
- **Output Tokens**: Response text generated by the AI
- **Cache Tokens**: Content cached using Prompt Caching feature
- **Cache Efficiency**: Reflects cache hit rate

### Cost Trend

- **Date**: YYYY-MM-DD format
- **Cost**: Total daily cost (USD)
- **Count**: Number of API calls for the day

## API Endpoints

Statistics features use the following API endpoints:

### GET /api/stats/cost

Get cost overview (supports range parameter)

**Parameters**:
- `range`: `today` | `week` | `month` (default: `today`)

**Response**:
```json
{
  "total_cost": 127.45,
  "record_count": 1234,
  "token_stats": {
    "total_input_tokens": 15200000,
    "total_output_tokens": 8300000,
    "total_cache_tokens": 3100000,
    "cache_efficiency": 72.45
  },
  "by_model": {
    "claude-3-5-sonnet-20241022": 85.20
  },
  "by_project": {
    "/path/to/project": 45.00
  },
  "trend": [
    {"date": "2025-10-27", "cost": 12.3456, "count": 156}
  ]
}
```

### GET /api/stats/cost/today

Get today's cost (shortcut)

### GET /api/stats/cost/week

Get this week's cost (shortcut)

### GET /api/stats/cost/month

Get this month's cost (shortcut)

### GET /api/stats/cost/trend

Get cost trend (supports range parameter)

### GET /api/stats/cost/by-model

Get cost grouped by model (supports range parameter)

### GET /api/stats/cost/by-project

Get cost grouped by project (supports range parameter)

### GET /api/stats/cost/top-sessions

Get sessions with highest cost (supports limit parameter)

### GET /api/stats/summary

Get quick summary (today/this week/this month cost)

## Technical Implementation

### Frontend

- **Framework**: Vue.js 3 Composition API
- **State Management**: Ref + Computed
- **Styling**: Tailwind CSS
- **Icons**: Inline SVG icons
- **Requests**: Axios

### Backend

- **Framework**: Axum (Rust)
- **Data Storage**: CSV files (monthly files)
- **Data Processing**: Serde + CSV
- **Cost Calculation**: Custom ModelPricing module

### Data Flow

```
Vue Component ‚Üí API Client ‚Üí Axum Handler ‚Üí CostTracker ‚Üí CSV Files
                    ‚Üì
               TypeScript Types
```

## Performance Optimization

### Frontend Optimization

- Use `computed` to cache sorting results
- Optimized data formatting functions (K/M simplification)
- Conditional rendering to reduce DOM operations

### Backend Optimization

- Incremental CSV reading
- Time range indexing
- Memory-efficient data structures

## Common Issues

### Why can't I see statistics data?

**Possible causes**:
1. No API calls have been made yet
2. Statistics feature was just enabled
3. CSV files don't exist

**Solutions**:
- Data will be automatically recorded after using the AI API
- Check the `~/.claude/stats/` directory

### Is the cost calculation accurate?

Yes! Cost calculations are based on:
- Anthropic official pricing (as of 2025-10-27)
- Actual token counts from API responses
- Precise to 6 decimal places

### Can data be exported?

The frontend doesn't currently support export, but you can:
1. Use CLI command to export: `ccr stats cost --export report.json`
2. Access CSV files directly: `~/.claude/stats/costs_YYYYMM.csv`

### How to reset statistics data?

Delete the statistics directory:
```bash
rm -rf ~/.claude/stats/
```

## Related Resources

- [API documentation](../backend/api.md#statistics-endpoints)
- [Anthropic pricing page](https://www.anthropic.com/pricing)

## Future Plans

### Advanced Charts (Planned)

- üìà Cost trend line chart (Chart.js)
- ü•ß Model distribution pie chart
- üìä Project cost bar chart
- üåä Token usage area chart

### More Dimensions (Planned)

- Group by user
- Group by session
- Custom time ranges
- Cost budget alerts

### Data Export (Planned)

- Direct frontend export to JSON/CSV
- Export to Excel format
- Periodic automatic export

---

**Tip**: Statistics features will be continuously optimized and improved. Feedback and suggestions are welcome!

