# stats å‘½ä»¤

æŸ¥çœ‹ API ä½¿ç”¨ç»Ÿè®¡å’Œæˆæœ¬åˆ†æã€‚

## æ¦‚è¿°

`stats` å‘½ä»¤æä¾›è¯¦ç»†çš„æˆæœ¬è¿½è¸ªå’Œä½¿ç”¨ç»Ÿè®¡åŠŸèƒ½ï¼Œå¸®åŠ©æ‚¨äº†è§£ AI API çš„ä½¿ç”¨æƒ…å†µå’Œç›¸å…³æˆæœ¬ã€‚

## è¯­æ³•

```bash
ccr stats cost [é€‰é¡¹]
```

## å­å‘½ä»¤

### cost

æŸ¥çœ‹æˆæœ¬ç»Ÿè®¡ä¿¡æ¯ã€‚

```bash
ccr stats cost [é€‰é¡¹]
```

## é€‰é¡¹

### --range \<èŒƒå›´\>

æŒ‡å®šæ—¶é—´èŒƒå›´ã€‚

- **å¯é€‰å€¼**: `today`, `week`, `month`
- **é»˜è®¤å€¼**: `today`

```bash
# æŸ¥çœ‹ä»Šæ—¥æˆæœ¬
ccr stats cost --range today

# æŸ¥çœ‹æœ¬å‘¨æˆæœ¬
ccr stats cost --range week

# æŸ¥çœ‹æœ¬æœˆæˆæœ¬
ccr stats cost --range month
```

### --by-model

æŒ‰æ¨¡å‹åˆ†ç»„æ˜¾ç¤ºæˆæœ¬ã€‚

```bash
ccr stats cost --range month --by-model
```

ç¤ºä¾‹è¾“å‡ºï¼š
```
ğŸ¤– æŒ‰æ¨¡å‹åˆ†ç»„:
  â€¢ 3-5-sonnet-20241022: $85.2000
  â€¢ 3-5-haiku-20241022: $32.1000
  â€¢ 3-opus-20240229: $10.1500
```

### --by-project

æŒ‰é¡¹ç›®åˆ†ç»„æ˜¾ç¤ºæˆæœ¬ã€‚

```bash
ccr stats cost --range month --by-project
```

ç¤ºä¾‹è¾“å‡ºï¼š
```
ğŸ“ æŒ‰é¡¹ç›®åˆ†ç»„:
  â€¢ project-a: $45.0000
  â€¢ project-b: $35.2000
  â€¢ project-c: $28.0000
```

### --top \<æ•°é‡\>

æ˜¾ç¤ºæˆæœ¬æœ€é«˜çš„ N ä¸ªä¼šè¯ã€‚

```bash
# æŸ¥çœ‹æˆæœ¬æœ€é«˜çš„ 10 ä¸ªä¼šè¯
ccr stats cost --top 10

# æŸ¥çœ‹æˆæœ¬æœ€é«˜çš„ 20 ä¸ªä¼šè¯
ccr stats cost --top 20
```

### --details

æ˜¾ç¤ºè¯¦ç»†ç»Ÿè®¡ä¿¡æ¯ï¼ŒåŒ…æ‹¬æ¯æ—¥è¶‹åŠ¿ã€‚

```bash
ccr stats cost --range month --details
```

### --export \<æ–‡ä»¶è·¯å¾„\>

å°†ç»Ÿè®¡æ•°æ®å¯¼å‡ºåˆ° JSON æ–‡ä»¶ã€‚

```bash
# å¯¼å‡ºæœˆåº¦æŠ¥å‘Š
ccr stats cost --range month --export monthly_report.json

# å¯¼å‡ºè¯¦ç»†ç»Ÿè®¡
ccr stats cost --range month --details --export detailed_stats.json
```

## ä½¿ç”¨ç¤ºä¾‹

### åŸºç¡€ä½¿ç”¨

æŸ¥çœ‹ä»Šæ—¥æˆæœ¬ï¼š

```bash
ccr stats cost
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š æˆæœ¬ç»Ÿè®¡ - today
â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â„¹ ğŸ’° æ€»æˆæœ¬: $12.3456
â„¹ ğŸ“Š è®°å½•æ•°: 156

âœ“ ğŸ« Token ä½¿ç”¨:
  ğŸ“¥ è¾“å…¥: 1.5M tokens
  ğŸ“¤ è¾“å‡º: 800K tokens
  ğŸ’¾ Cache: 300K tokens
  ğŸ“Š Cache æ•ˆç‡: 65.23%
```

### æŸ¥çœ‹æœ¬æœˆè¯¦ç»†ç»Ÿè®¡

```bash
ccr stats cost --range month --details --by-model --by-project
```

è¾“å‡ºç¤ºä¾‹ï¼š
```
ğŸ“Š æˆæœ¬ç»Ÿè®¡ - month
â•â•â•â•â•â•â•â•â•â•â•â•â•â•

â„¹ ğŸ’° æ€»æˆæœ¬: $127.4500
â„¹ ğŸ“Š è®°å½•æ•°: 1,234

âœ“ ğŸ« Token ä½¿ç”¨:
  ğŸ“¥ è¾“å…¥: 15.2M tokens
  ğŸ“¤ è¾“å‡º: 8.3M tokens
  ğŸ’¾ Cache: 3.1M tokens
  ğŸ“Š Cache æ•ˆç‡: 72.45%

ğŸ¤– æŒ‰æ¨¡å‹åˆ†ç»„:
  â€¢ 3-5-sonnet-20241022: $85.2000
  â€¢ 3-5-haiku-20241022: $32.1000
  â€¢ 3-opus-20240229: $10.1500

ğŸ“ æŒ‰é¡¹ç›®åˆ†ç»„:
  â€¢ project-a: $45.0000
  â€¢ project-b: $35.2000
  â€¢ project-c: $28.0000
  â€¢ project-d: $12.5000
  â€¢ project-e: $6.7500

ğŸ“ˆ æ¯æ—¥è¶‹åŠ¿:
  2025-10-27 - $12.3456 (156 æ¬¡)
  2025-10-26 - $8.9012 (123 æ¬¡)
  2025-10-25 - $15.6789 (189 æ¬¡)
  2025-10-24 - $10.2345 (145 æ¬¡)
  2025-10-23 - $9.8765 (134 æ¬¡)
  2025-10-22 - $11.4567 (167 æ¬¡)
  2025-10-21 - $13.2109 (178 æ¬¡)
```

### å¯¼å‡ºæŠ¥å‘Š

```bash
ccr stats cost --range month --export report.json
```

JSON æ ¼å¼ç¤ºä¾‹ï¼š
```json
{
  "total_cost": 127.45,
  "record_count": 1234,
  "token_stats": {
    "total_input_tokens": 15200000,
    "total_output_tokens": 8300000,
    "total_cache_tokens": 3100000,
    "cache_efficiency": 72.45
  },
  "by_model": {
    "claude-3-5-sonnet-20241022": 85.20,
    "claude-3-5-haiku-20241022": 32.10,
    "claude-3-opus-20240229": 10.15
  },
  "by_project": {
    "/path/to/project-a": 45.00,
    "/path/to/project-b": 35.20,
    "/path/to/project-c": 28.00
  },
  "trend": [
    {"date": "2025-10-27", "cost": 12.3456, "count": 156},
    {"date": "2025-10-26", "cost": 8.9012, "count": 123}
  ]
}
```

## æ•°æ®å­˜å‚¨

### å­˜å‚¨ä½ç½®

æˆæœ¬æ•°æ®å­˜å‚¨åœ¨ `~/.claude/stats/` ç›®å½•ï¼š

```
~/.claude/stats/
â”œâ”€â”€ costs_202510.csv    # 2025å¹´10æœˆçš„æˆæœ¬æ•°æ®
â”œâ”€â”€ costs_202509.csv    # 2025å¹´9æœˆçš„æˆæœ¬æ•°æ®
â””â”€â”€ ...
```

### CSV æ ¼å¼

æ¯æœˆä¸€ä¸ª CSV æ–‡ä»¶ï¼Œæ ¼å¼å¦‚ä¸‹ï¼š

```csv
timestamp,id,session_id,project,platform,model,input_tokens,output_tokens,cache_read_tokens,cache_write_tokens,input_cost,output_cost,cache_cost,total_cost,duration_ms,description
2025-10-27T10:00:00Z,uuid-123,sess_abc,/path/to/proj,claude,claude-3-5-sonnet-20241022,1500,800,200,100,0.004500,0.012000,0.000750,0.017250,3500,Implement auth
```

## æ¨¡å‹å®šä»·

CCR æ”¯æŒä»¥ä¸‹ Claude æ¨¡å‹çš„å‡†ç¡®å®šä»·ï¼ˆæˆªè‡³ 2025-10-27ï¼‰ï¼š

| æ¨¡å‹ | è¾“å…¥ ($/M tokens) | è¾“å‡º ($/M tokens) | Cache è¯» ($/M) | Cache å†™ ($/M) |
|------|------------------|------------------|---------------|---------------|
| Claude 3.5 Sonnet | $3.00 | $15.00 | $0.30 | $3.75 |
| Claude 3.5 Haiku | $1.00 | $5.00 | $0.10 | $1.25 |
| Claude 3 Opus | $15.00 | $75.00 | $1.50 | $18.75 |
| Claude 4.5 Sonnet | $3.00 | $15.00 | $0.30 | $3.75 |
| Claude 4.1 Opus | $15.00 | $75.00 | $1.50 | $18.75 |

## ç»Ÿè®¡æŒ‡æ ‡è¯´æ˜

### æˆæœ¬æŒ‡æ ‡

- **æ€»æˆæœ¬**: æ‰€æœ‰ API è°ƒç”¨çš„æ€»æˆæœ¬ï¼ˆç¾å…ƒï¼‰
- **è®°å½•æ•°**: API è°ƒç”¨çš„æ€»æ¬¡æ•°
- **è¾“å…¥æˆæœ¬**: è¾“å…¥ Token çš„æˆæœ¬
- **è¾“å‡ºæˆæœ¬**: è¾“å‡º Token çš„æˆæœ¬
- **Cache æˆæœ¬**: Cache Token çš„æˆæœ¬ï¼ˆåŒ…æ‹¬è¯»å–å’Œå†™å…¥ï¼‰

### Token æŒ‡æ ‡

- **è¾“å…¥ Token**: å‘é€ç»™ AI çš„ Token æ•°é‡
- **è¾“å‡º Token**: AI ç”Ÿæˆçš„ Token æ•°é‡
- **Cache Token**: ä½¿ç”¨ Prompt Caching çš„ Token æ•°é‡
- **Cache æ•ˆç‡**: Cache è¯»å– Token / æ€» Cache Token Ã— 100%

### æ€§èƒ½æŒ‡æ ‡

- **API è°ƒç”¨æ¬¡æ•°**: æ€»çš„ API è¯·æ±‚æ•°
- **å¹³å‡å•æ¬¡æˆæœ¬**: æ€»æˆæœ¬ / è°ƒç”¨æ¬¡æ•°
- **æ¯æ—¥è¶‹åŠ¿**: æ¯å¤©çš„æˆæœ¬å’Œè°ƒç”¨æ¬¡æ•°

## Web UI

é™¤äº† CLI å‘½ä»¤ï¼Œæ‚¨è¿˜å¯ä»¥é€šè¿‡ Web UI æŸ¥çœ‹ç»Ÿè®¡æ•°æ®ï¼š

1. å¯åŠ¨ CCR UI:
```bash
ccr ui
```

2. è®¿é—®ç»Ÿè®¡é¡µé¢:
```
http://localhost:3000/stats
```

Web UI æä¾›ï¼š
- ğŸ“Š å¯è§†åŒ–ä»ªè¡¨æ¿
- ğŸ“ˆ äº¤äº’å¼å›¾è¡¨
- ğŸ”„ å®æ—¶åˆ·æ–°
- ğŸ“± å“åº”å¼è®¾è®¡
- ğŸŒ™ æ·±è‰²æ¨¡å¼æ”¯æŒ

## æ³¨æ„äº‹é¡¹

### æ•°æ®æ”¶é›†

âš ï¸ **é‡è¦**: æˆæœ¬ç»Ÿè®¡éœ€è¦åœ¨å®é™… API è°ƒç”¨æ—¶è®°å½•æ•°æ®ã€‚å¦‚æœæ‚¨æ˜¯é¦–æ¬¡ä½¿ç”¨ï¼Œå¯èƒ½éœ€è¦ä¸€äº›æ—¶é—´æ‰èƒ½çœ‹åˆ°ç»Ÿè®¡æ•°æ®ã€‚

### æ•°æ®ä¿ç•™

- CSV æ–‡ä»¶æŒ‰æœˆå­˜å‚¨
- å»ºè®®å®šæœŸå¤‡ä»½ç»Ÿè®¡æ•°æ®
- å¯ä»¥å®‰å…¨åˆ é™¤æ—§æœˆä»½çš„ CSV æ–‡ä»¶

### ç²¾ç¡®åº¦

- æˆæœ¬è®¡ç®—åŸºäº Anthropic å®˜æ–¹å®šä»·
- Token è®¡æ•°æ¥è‡ª API å“åº”
- æˆæœ¬ç²¾ç¡®åˆ°å°æ•°ç‚¹å 6 ä½

## å¸¸è§é—®é¢˜

### ä¸ºä»€ä¹ˆçœ‹ä¸åˆ°ç»Ÿè®¡æ•°æ®ï¼Ÿ

å¦‚æœç»Ÿè®¡æ˜¾ç¤ºä¸ºç©ºï¼Œå¯èƒ½çš„åŸå› ï¼š
1. å°šæœªè¿›è¡Œä»»ä½• API è°ƒç”¨
2. ç»Ÿè®¡åŠŸèƒ½åˆšåˆšå¯ç”¨ï¼Œè¿˜æ²¡æœ‰å†å²æ•°æ®
3. CSV æ–‡ä»¶ä¸å­˜åœ¨æˆ–ä¸ºç©º

### å¦‚ä½•é‡ç½®ç»Ÿè®¡æ•°æ®ï¼Ÿ

åˆ é™¤ç»Ÿè®¡ç›®å½•ï¼š
```bash
rm -rf ~/.claude/stats/
```

### ç»Ÿè®¡æ•°æ®èƒ½å¯¼å…¥å…¶ä»–å·¥å…·å—ï¼Ÿ

å¯ä»¥ï¼å¯¼å‡ºçš„ JSON å’Œ CSV æ ¼å¼éƒ½æ˜¯æ ‡å‡†æ ¼å¼ï¼Œå¯ä»¥å¯¼å…¥åˆ°ï¼š
- Excel/Google Sheets
- æ•°æ®åˆ†æå·¥å…·ï¼ˆpandas, Rï¼‰
- BI å·¥å…·ï¼ˆTableau, PowerBIï¼‰

## ç›¸å…³å‘½ä»¤

- [`list`](./list.md) - åˆ—å‡ºæ‰€æœ‰é…ç½®
- [`current`](./current.md) - æŸ¥çœ‹å½“å‰é…ç½®
- [`history`](./history.md) - æŸ¥çœ‹æ“ä½œå†å²

## å‚è€ƒèµ„æº

- [Anthropic å®šä»·é¡µé¢](https://www.anthropic.com/pricing)
- [ç»Ÿè®¡åŠŸèƒ½å¼€å‘æ–‡æ¡£](../TODO_ANALYTICS.md)
- [CCR UI ç»Ÿè®¡è§†å›¾](../../ccr-ui/docs/frontend/components.md#statsview)
