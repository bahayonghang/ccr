# web - 启动 Web 界面

启动内置的 Web 配置界面,通过浏览器管理配置。

## 用法

```bash
ccr web [OPTIONS]
```

## 选项

- `--port <PORT>`: 指定监听端口(默认：8080)
- `--no-browser`: 不自动打开浏览器

::: tip 智能端口绑定
如果指定的端口已被占用，CCR 会自动尝试绑定其他可用端口，确保服务能够成功启动。
:::

## 功能特性

CCR Web 提供了一个现代化的、功能完整的 Web 管理界面，具有以下特性：

### 🎨 界面设计
- **现代化 UI**：采用玻璃拟态设计风格，支持明暗主题切换
- **三栏布局**：左侧边栏（当前状态）+ 中央内容区（配置管理）+ 右侧边栏（快速导航）
- **响应式设计**：自适应不同屏幕尺寸

### 📊 核心功能
- **配置管理**：查看、添加、编辑、删除、切换配置
- **多平台支持**：支持 Claude、Codex、Gemini、Qwen、iFlow 平台切换（Unified Mode）
- **实时状态显示**：当前配置、系统信息、CPU/内存使用率
- **操作历史**：完整的操作审计追踪
- **云同步**：WebDAV 云端备份与恢复
- **配置验证**：一键验证所有配置完整性
- **备份清理**：智能清理旧备份文件
- **导入/导出**：配置文件的导入导出功能

## 示例

```bash
# 使用默认端口 8080，自动打开浏览器
ccr web

# 使用自定义端口
ccr web --port 3000

# 启动但不自动打开浏览器（适合远程服务器）
ccr web --no-browser

# 指定端口且不打开浏览器
ccr web --port 9000 --no-browser
```

**启动示例输出：**

```
2025-10-31 16:05:12 [INFO] 🔄 系统信息缓存后台线程已启动，更新间隔: 2s
✓ 🌐 CCR Web 服务器已启动（异步模式）
ℹ 📍 地址: http://localhost:8080
ℹ ⏹️ 按 Ctrl+C 停止服务器
💡 请手动访问 http://localhost:8080
```

::: info 端口占用处理
如果 8080 端口被占用，CCR 会自动尝试 8081、8082 等端口，直到找到可用端口。实际使用的端口会在启动信息中显示。
:::

## Web 界面详解

### 界面布局

CCR Web 采用三栏式布局设计，让配置管理更加直观高效：

```
┌────────────────────────────────────────────────────────────────┐
│  🌐 CCR Multi-Platform Console    🌙 刷新 导入 导出 ➕添加配置 │ ← 顶部导航栏
├────────────────────────────────────────────────────────────────┤
│  🤖 Claude  💻 Codex  ✨ Gemini  🌟 Qwen  ⚡ iFlow            │ ← 平台切换栏
├──────────┬─────────────────────────────────────────┬──────────┤
│          │  📋 配置列表 | 📚 历史记录 | ☁️ 云同步  │          │
│  当前配置│                                          │  配置目录│
│  ────────│  ┌─────────────────────────────────┐   │  ────────│
│  ● ACTIVE│  │ anthropic_main                  │   │  • anthro│
│  anthro..│  │ 🔄 官方中转                     │   │  • anyrou│
│          │  │ Base: api.anthropic.com         │   │  • openro│
│  平台状态│  │ Model: claude-sonnet-4-5-...   │   │  • glm   │
│  ────────│  │ [✓ 当前] [✎ 编辑] [🗑️ 删除]   │   │          │
│  🤖Claude│  └─────────────────────────────────┘   │          │
│  ✓ 3配置 │                                          │          │
│          │  ┌─────────────────────────────────┐   │          │
│  系统信息│  │ anyrouter_main                  │   │          │
│  ────────│  │ 🔄 官方中转                     │   │          │
│  💻 主机 │  │ Base: api.anyrouter.ai          │   │          │
│  🖥️ 系统│  │ [切换]  [✎ 编辑]  [🗑️ 删除]   │   │          │
│  ⚙️ CPU  │  └─────────────────────────────────┘   │          │
│  📊 使用率│                                          │          │
│  💾 内存 │                                          │          │
│                                                               │
│  统计    │                                          │          │
│  ────────│                                          │          │
│  3 总配置│                                          │          │
│  15 历史 │                                          │          │
│          │                                          │          │
│  [✓ 验证]│                                          │          │
│  [🗑️清理]│                                          │          │
└──────────┴─────────────────────────────────────────┴──────────┘
```

### 1. 顶部导航栏

**左侧品牌区**：
- ⚡ CCR Logo 和 Multi-Platform Console 标识
- 当前模式指示器（Legacy / Unified）
- 当前激活平台显示（Unified Mode）

**右侧操作区**：
- 🌙 **主题切换**：在明暗主题之间切换
- 🔄 **刷新**：重新加载所有配置和状态
- 📥 **导入**：从 TOML 文件导入配置
- 📤 **导出**：导出配置到 TOML 文件
- ➕ **添加配置**：打开配置添加表单

### 2. 平台导航栏（Unified Mode）

仅在 Unified Mode 下显示，支持在多个 AI CLI 平台之间快速切换：

- 🤖 **Claude** - Claude Code AI Assistant
- 💻 **Codex** - GitHub Copilot CLI
- ✨ **Gemini** - Google Gemini CLI
- 🌟 **Qwen** - Alibaba Tongyi Qianwen CLI
- ⚡ **iFlow** - iFlow CLI

每个平台标签显示：
- 平台图标和名称
- 配置数量徽章
- 激活状态高亮

### 3. 左侧边栏

**当前配置卡片**：
- ● ACTIVE 状态指示灯（绿色跳动）
- 当前激活的配置名称

**平台状态列表**（Unified Mode）：
- 显示所有已初始化的平台
- 当前激活平台高亮
- 每个平台的配置数量

**系统信息卡片**：
- 💻 **主机名**：显示当前主机名
- 🖥️ **操作系统**：系统类型和版本
- ⚙️ **CPU 信息**：处理器型号
- 📊 **CPU 使用率**：实时进度条显示
- 💾 **内存使用**：已用/总内存，带进度条
- ⏱️ **系统运行时间**：系统启动时长

**统计信息**：
- 📋 总配置数量
- 📚 历史记录数量

**快捷操作**：
- ✓ **验证按钮**：验证所有配置
- 🗑️ **清理备份**：清理旧备份文件

### 4. 中央内容区

#### 标签页 1: 配置列表

**配置类型过滤器**：
- 📋 **全部配置**：显示所有配置
- 🔄 **官方中转**：仅显示官方 API 中转服务
- 🤖 **第三方模型**：仅显示第三方模型服务
- ❓ **未分类**：显示未分类的配置

**配置卡片**（每个配置显示为一张卡片）：
```
┌────────────────────────────────────────────────────┐
│ anthropic_main                          [● 当前]   │
│ 🔄 官方中转                                         │
│ ─────────────────────────────────────────────────  │
│ 描述：Anthropic Official API                       │
│ Base URL：api.anthropic.com                        │
│ 模型：claude-sonnet-4-5-20250929                   │
│ 快速模型：claude-3-5-haiku-20241022                │
│ Token：sk-a...cdef (脱敏显示)                      │
│ 提供商：Anthropic                                   │
│ 标签：official, stable                             │
│ ─────────────────────────────────────────────────  │
│  [✓ 当前使用]  [✎ 编辑]  [🗑️ 删除]               │
└────────────────────────────────────────────────────┘
```

**操作按钮**：
- ✓ **切换/当前**：切换到此配置（当前配置显示为绿色"当前使用"）
- ✎ **编辑**：修改配置详情
- 🗑️ **删除**：删除此配置（需确认）

#### 标签页 2: 历史记录

显示所有操作的完整审计日志：

```
┌────────────────────────────────────────────────────┐
│ 🔄 Switch Configuration                           │
│ 2025-10-31 14:23:15                                │
│ ─────────────────────────────────────────────────  │
│ 操作 ID：f47ac10b-58cc-4372-a567-0e02b2c3d479    │
│ 执行者：lyh                                        │
│ 配置：anthropic → anyrouter_main                  │
│ 结果：✅ Success                                   │
│ 详情：配置切换成功，已更新环境变量                │
└────────────────────────────────────────────────────┘
```

每条记录包含：
- 操作类型图标（🔄 Switch / ➕ Add / 🗑️ Delete 等）
- 操作时间戳
- 操作 UUID
- 执行者用户名
- 操作详情
- 结果状态（✅ 成功 / ❌ 失败 / ⚠️ 警告）

#### 标签页 3: 云同步

**同步配置表单**：
```
┌──────────────  云同步设置  ────────────────────────┐
│ ☑️ 启用 WebDAV 同步                                │
│                                                     │
│ WebDAV URL *                                        │
│ ┌───────────────────────────────────────────────┐  │
│ │ https://dav.jianguoyun.com/dav/              │  │
│ └───────────────────────────────────────────────┘  │
│                                                     │
│ 用户名 *                                            │
│ ┌───────────────────────────────────────────────┐  │
│ │ your_username                                 │  │
│ └───────────────────────────────────────────────┘  │
│                                                     │
│ 密码 *                                              │
│ ┌───────────────────────────────────────────────┐  │
│ │ ••••••••••                                    │  │
│ └───────────────────────────────────────────────┘  │
│                                                     │
│ 远程路径                                            │
│ ┌───────────────────────────────────────────────┐  │
│ │ /ccr/                                         │  │
│ └───────────────────────────────────────────────┘  │
│                                                     │
│ ☑️ 自动同步（未来版本）                            │
│                                                     │
│     [刷新状态]  [保存并测试连接]                   │
└─────────────────────────────────────────────────────┘
```

**同步状态显示**：
- 配置状态（已配置/未配置）
- 启用状态（已启用/已禁用）
- WebDAV 连接信息
- 本地/远程路径
- 远程文件存在状态

**同步操作**：
- ☑️ **Push 强制覆盖**：覆盖云端文件
- 📤 **Push 上传**：上传本地配置到云端
- ☑️ **Pull 强制覆盖**：覆盖本地文件
- 📥 **Pull 下载**：从云端下载配置

### 5. 右侧边栏

**配置目录**：
- 显示所有配置名称列表
- 点击可快速跳转到对应配置
- 当前配置高亮显示

### 6. 模态对话框

#### 添加/编辑配置对话框

```
┌────────────  添加配置  ─────────────┐
│                                      │
│  配置名称 *                          │
│  ┌────────────────────────────────┐ │
│  │ my_new_config                  │ │
│  └────────────────────────────────┘ │
│                                      │
│  描述                                │
│  ┌────────────────────────────────┐ │
│  │ My custom configuration        │ │
│  └────────────────────────────────┘ │
│                                      │
│  Base URL *                          │
│  ┌────────────────────────────────┐ │
│  │ https://api.example.com        │ │
│  └────────────────────────────────┘ │
│                                      │
│  Auth Token *                        │
│  ┌────────────────────────────────┐ │
│  │ sk-...                         │ │
│  └────────────────────────────────┘ │
│                                      │
│  Model                               │
│  ┌────────────────────────────────┐ │
│  │ claude-sonnet-4-5-20250929     │ │
│  └────────────────────────────────┘ │
│                                      │
│  Small Fast Model                    │
│  ┌────────────────────────────────┐ │
│  │ claude-3-5-haiku-20241022      │ │
│  └────────────────────────────────┘ │
│                                      │
│  提供商类型                          │
│  ┌────────────────────────────────┐ │
│  │ 🔄 官方中转               ▼    │ │
│  └────────────────────────────────┘ │
│                                      │
│  提供商名称                          │
│  ┌────────────────────────────────┐ │
│  │ anyrouter                      │ │
│  └────────────────────────────────┘ │
│  用于标识同一提供商的不同配置      │
│                                      │
│  账号标识                            │
│  ┌────────────────────────────────┐ │
│  │ personal                       │ │
│  └────────────────────────────────┘ │
│  用于区分同一提供商的不同账号      │
│                                      │
│  标签                                │
│  ┌────────────────────────────────┐ │
│  │ free, backup                   │ │
│  └────────────────────────────────┘ │
│  用逗号分隔，如: free, stable      │
│                                      │
│         [取消]  [保存]               │
└──────────────────────────────────────┘
```

#### 导出配置对话框

```
┌─────────  📤 导出配置  ──────────┐
│                                   │
│  ☑️ 包含敏感信息 (API 密钥)      │
│                                   │
│  ⚠️ 如果勾选,导出文件将包含      │
│  完整的 API 密钥，请妥善保管     │
│                                   │
│      [取消]  [📥 下载配置文件]   │
└───────────────────────────────────┘
```

#### 导入配置对话框

```
┌─────────  📥 导入配置  ──────────┐
│                                   │
│  选择配置文件 *                   │
│  ┌─────────────────────────────┐ │
│  │ [选择文件]                  │ │
│  └─────────────────────────────┘ │
│  请选择 .toml 格式的配置文件    │
│                                   │
│  导入模式                         │
│  ┌─────────────────────────────┐ │
│  │ 合并 - 保留现有配置      ▼ │ │
│  └─────────────────────────────┘ │
│                                   │
│  ☑️ 导入前备份当前配置           │
│                                   │
│  ┌────── 文件预览 ──────────────┐│
│  │ [configs]                    ││
│  │ default_config = "anthropic" ││
│  │ ...                          ││
│  └─────────────────────────────┘││
│                                   │
│         [取消]  [执行导入]        │
└───────────────────────────────────┘
```

#### 清理备份对话框

```
┌───────  清理备份文件  ────────┐
│                                │
│  保留天数                      │
│  ┌──────────────────────────┐ │
│  │ 7                        │ │
│  └──────────────────────────┘ │
│  将删除 7 天前的备份文件      │
│                                │
│  ☑️ 模拟运行(预览不删除)      │
│                                │
│  ┌──── 清理预览 ────────────┐ │
│  │ 找到 10 个待清理文件     │ │
│  │ 预计释放空间: 5.2 MB     │ │
│  │ • settings_20250101...   │ │
│  │ • settings_20250102...   │ │
│  │ ...                      │ │
│  └─────────────────────────┘  │
│                                │
│  [取消] [预览] [执行清理]      │
└────────────────────────────────┘
```

## RESTful API

Web 界面提供完整的 RESTful API,支持编程访问。

### 获取所有配置

```http
GET http://localhost:8080/api/configs
```

**响应：**
```json
{
  "configs": [
    {
      "name": "anthropic",
      "description": "Anthropic Official API",
      "base_url": "https://api.anthropic.com",
      "auth_token": "sk-a...key",
      "model": "claude-sonnet-4-5-20250929",
      "small_fast_model": "claude-3-5-haiku-20241022",
      "is_current": true,
      "is_complete": true
    }
  ]
}
```

### 切换配置

```http
POST http://localhost:8080/api/switch
Content-Type: application/json

{
  "config_name": "anyrouter"
}
```

**响应：**
```json
{
  "success": true,
  "message": "Configuration switched successfully"
}
```

### 获取操作历史

```http
GET http://localhost:8080/api/history?limit=20&type=switch
```

**查询参数：**
- `limit`: 返回记录数(默认：20)
- `type`: 操作类型过滤(可选)

### 验证配置

```http
POST http://localhost:8080/api/validate
```

**响应：**
```json
{
  "valid": true,
  "errors": [],
  "warnings": []
}
```

### 清理备份

```http
POST http://localhost:8080/api/clean
Content-Type: application/json

{
  "days": 7,
  "dry_run": false
}
```

**响应：**
```json
{
  "success": true,
  "deleted_count": 10,
  "freed_space": "5.2 MB"
}
```

### 添加配置

```http
POST http://localhost:8080/api/config
Content-Type: application/json

{
  "name": "newconfig",
  "description": "New Configuration",
  "base_url": "https://api.example.com",
  "auth_token": "your-token",
  "model": "claude-sonnet-4-5-20250929"
}
```

### 更新配置

```http
PUT http://localhost:8080/api/config/anthropic
Content-Type: application/json

{
  "description": "Updated Description",
  "auth_token": "new-token"
}
```

### 删除配置

```http
DELETE http://localhost:8080/api/config/oldconfig
```

## 使用场景

### 团队协作

在团队环境中使用 Web 界面统一管理配置：

```bash
# 在服务器上启动
ccr web --port 8080 --no-browser
```

团队成员可以通过浏览器访问 `http://server-ip:8080` 进行配置管理。

### 远程管理

通过 SSH 端口转发远程管理配置：

```bash
# 在远程服务器上
ccr web --no-browser

# 在本地
ssh -L 8080:localhost:8080 user@remote-server
# 访问 http://localhost:8080
```

### 自动化集成

使用 API 进行自动化操作：

```bash
# 使用 curl 切换配置
curl -X POST http://localhost:8080/api/switch \
  -H "Content-Type: application/json" \
  -d '{"config_name": "production"}'

# 使用 Python
import requests
response = requests.post(
    "http://localhost:8080/api/switch",
    json={"config_name": "production"}
)
print(response.json())
```

## 安全注意事项

::: warning 安全提示
Web 界面默认监听 `localhost`,仅本地访问。如需远程访问,请使用：
- SSH 端口转发
- VPN 连接
- 反向代理(nginx/caddy)+ HTTPS
- 防火墙限制访问 IP
:::

### 使用 nginx 反向代理

```nginx
server {
    listen 443 ssl;
    server_name ccr.example.com;

    ssl_certificate /path/to/cert.pem;
    ssl_certificate_key /path/to/key.pem;

    location / {
        proxy_pass http://localhost:8080;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
    }
}
```

## 停止 Web 服务

按 `Ctrl+C` 停止 Web 服务：

```
^C
Shutting down web server...
✓ Web server stopped
```

## 相关命令

- [list](./list) - 命令行查看配置
- [add](./add) - 命令行添加配置
- [delete](./delete) - 命令行删除配置
- [switch](./switch) - 命令行切换配置
- [history](./history) - 命令行查看历史
