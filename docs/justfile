# CCR Documentation Justfile
# å¿«é€Ÿæ„å»ºå’Œç®¡ç†æ–‡æ¡£çš„å‘½ä»¤é›†åˆ

# é»˜è®¤å‘½ä»¤ - æ˜¾ç¤ºå¸®åŠ©ä¿¡æ¯
default:
    @just --list

# æ£€æŸ¥ä¾èµ–æ˜¯å¦å·²å®‰è£…
_check-deps:
    #!/usr/bin/env bash
    if [ ! -d "node_modules" ]; then
        echo "âš ï¸  ä¾èµ–æœªå®‰è£…ï¼Œæ­£åœ¨è‡ªåŠ¨å®‰è£…..."
        npm install
    fi

# å®‰è£…ä¾èµ–
install:
    @echo "ğŸ“¦ å®‰è£…æ–‡æ¡£ä¾èµ–..."
    npm install

# å¯åŠ¨å¼€å‘æœåŠ¡å™¨
dev: _check-deps
    @echo "ğŸš€ å¯åŠ¨å¼€å‘æœåŠ¡å™¨..."
    @echo "ğŸ“ è®¿é—® http://localhost:5173"
    npm run dev

# æ„å»ºç”Ÿäº§ç‰ˆæœ¬
build: _check-deps
    @echo "ğŸ—ï¸  æ„å»ºç”Ÿäº§ç‰ˆæœ¬..."
    npm run build
    @echo "âœ… æ„å»ºå®Œæˆï¼è¾“å‡ºç›®å½•: .vitepress/dist"

# é¢„è§ˆç”Ÿäº§æ„å»º
preview: _check-deps build
    @echo "ğŸ‘€ é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬..."
    @echo "ğŸ“ è®¿é—® http://localhost:4173"
    npm run preview

# æ¸…ç†æ„å»ºæ–‡ä»¶å’Œç¼“å­˜
clean:
    @echo "ğŸ§¹ æ¸…ç†æ„å»ºæ–‡ä»¶..."
    rm -rf .vitepress/dist
    rm -rf .vitepress/cache
    rm -rf node_modules/.cache
    @echo "âœ… æ¸…ç†å®Œæˆï¼"

# å®Œå…¨æ¸…ç†(åŒ…æ‹¬ node_modules)
clean-all: clean
    @echo "ğŸ§¹ å®Œå…¨æ¸…ç†..."
    rm -rf node_modules
    @echo "âœ… å®Œå…¨æ¸…ç†å®Œæˆï¼"

# é‡æ–°å®‰è£…ä¾èµ–
reinstall: clean-all install
    @echo "âœ… é‡æ–°å®‰è£…å®Œæˆï¼"

# æ£€æŸ¥å®‰å…¨æ¼æ´
audit:
    @echo "ğŸ” æ£€æŸ¥å®‰å…¨æ¼æ´..."
    npm audit

# ä¿®å¤å®‰å…¨æ¼æ´(éç ´åæ€§)
audit-fix:
    @echo "ğŸ”§ ä¿®å¤å®‰å…¨æ¼æ´..."
    npm audit fix

# æ›´æ–°ä¾èµ–åˆ°æœ€æ–°ç‰ˆæœ¬
update:
    @echo "â¬†ï¸  æ›´æ–°ä¾èµ–..."
    npm update
    @echo "âœ… æ›´æ–°å®Œæˆï¼"

# æ£€æŸ¥è¿‡æœŸçš„ä¾èµ–
outdated:
    @echo "ğŸ“Š æ£€æŸ¥è¿‡æœŸä¾èµ–..."
    npm outdated

# å¿«é€Ÿé‡å»º(æ¸…ç†åé‡æ–°æ„å»º)
rebuild: clean build
    @echo "âœ… é‡å»ºå®Œæˆï¼"

# éªŒè¯æ„å»º(æ„å»ºå¹¶æ£€æŸ¥è¾“å‡º)
verify: build
    @echo "âœ… éªŒè¯æ„å»ºç»“æœ..."
    @ls -lh .vitepress/dist
    @echo ""
    @echo "ğŸ“Š æ–‡ä»¶æ•°é‡ç»Ÿè®¡:"
    @find .vitepress/dist -type f | wc -l
    @echo ""
    @echo "ğŸ’¾ æ€»å¤§å°:"
    @du -sh .vitepress/dist

# å¼€å‘ç¯å¢ƒå®Œæ•´è®¾ç½®
setup: install
    @echo "ğŸ‰ å¼€å‘ç¯å¢ƒè®¾ç½®å®Œæˆï¼"
    @echo ""
    @echo "å¯ç”¨å‘½ä»¤:"
    @echo "  just dev      - å¯åŠ¨å¼€å‘æœåŠ¡å™¨"
    @echo "  just build    - æ„å»ºç”Ÿäº§ç‰ˆæœ¬"
    @echo "  just preview  - é¢„è§ˆç”Ÿäº§ç‰ˆæœ¬"
    @echo ""

# ç”Ÿäº§éƒ¨ç½²å‡†å¤‡
deploy: clean build verify
    @echo "ğŸš€ ç”Ÿäº§éƒ¨ç½²å‡†å¤‡å®Œæˆï¼"
    @echo "ğŸ“¦ éƒ¨ç½²ç›®å½•: .vitepress/dist"

# æ ¼å¼åŒ– justfile
fmt:
    @echo "âœ¨ æ ¼å¼åŒ– justfile..."
    just --fmt --unstable
