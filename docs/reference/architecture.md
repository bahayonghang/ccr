# CCR æ¶æ„è®¾è®¡ï¼ˆv3.10.0+ï¼‰

> é¢å‘ Rust 2024 Edition çš„åˆ†å±‚æ¶æ„ï¼›é»˜è®¤å¼€å¯ `web` + `tui` ç‰¹æ€§ã€‚CCR æœ¬èº«æä¾› CLI/TUI/è½»é‡ Web APIï¼ŒåŒæ—¶ä½œä¸º CCR UI åç«¯çš„æ ¸å¿ƒä¾èµ–ã€‚

## æ€»è§ˆ

- **å·¥ä½œåŒº (Workspace)**ï¼šæ ¹ crate `ccr` + `ccr-ui/backend`ï¼ˆAxum æœåŠ¡ï¼‰+ `ccr-ui/frontend`ï¼ˆVue3+Vite+Piniaï¼‰+ `docs`ï¼ˆVitePressï¼‰
- **é…ç½®æ¨¡å¼**ï¼š`Unified`ï¼ˆé»˜è®¤ï¼Œ`~/.ccr/config.toml` + `platforms/<name>/profiles.toml`ï¼‰ä¸ `Legacy`ï¼ˆå…¼å®¹ `~/.ccs_config.toml`ï¼‰å¹¶å­˜
- **æ¥å£å½¢æ€**ï¼šCLIï¼ˆClap è§£æï¼‰ã€TUIï¼ˆRatatuiï¼‰ã€è½»é‡ Web API (`ccr web`ï¼ŒAxum) ä¸å®Œæ•´ CCR UI (`ccr ui`ï¼Œè‡ªåŠ¨æ£€æµ‹æœ¬åœ°/ç”¨æˆ·ç›®å½•/è¿œç¨‹ä¸‹è½½)
- **æ ¸å¿ƒèƒ½åŠ›**ï¼šå¤šå¹³å°æ³¨å†Œè¡¨ä¸åˆ‡æ¢ã€é…ç½® CRUDã€å®¡è®¡ä¸å¤‡ä»½ã€ä¸´æ—¶è¦†ç›–ã€WebDAV å¤šç›®å½•åŒæ­¥ã€æŠ€èƒ½/æç¤ºè¯/MCP é¢„è®¾ç®¡ç†ã€æˆæœ¬è¿½è¸ªã€é¢„ç®—æ§åˆ¶ã€Provider å¥åº·æ£€æŸ¥

## å·¥ä½œåŒºç»“æ„

```
ccr/                     # Workspace root
â”œâ”€â”€ Cargo.toml           # workspace + shared deps (clap/serde/tokio/axum/...)
â”œâ”€â”€ src/                 # æ ¸å¿ƒ CLI/åº“
â”‚   â”œâ”€â”€ cli/             # CLI ç»“æ„å®šä¹‰å’Œå‘½ä»¤åˆ†å‘
â”‚   â”œâ”€â”€ commands/        # å‘½ä»¤å®ç°ï¼ˆåˆ†ç±»ç»„ç»‡ï¼‰
â”‚   â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘å’Œç¼–æ’å±‚
â”‚   â”œâ”€â”€ managers/        # æ•°æ®è®¿é—®å’ŒæŒä¹…åŒ–å±‚
â”‚   â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹å®šä¹‰
â”‚   â”œâ”€â”€ platforms/       # å¹³å°å®ç°ï¼ˆClaude/Codex/Gemini/Qwen/iFlowï¼‰
â”‚   â”œâ”€â”€ core/            # æ ¸å¿ƒåŸºç¡€è®¾æ–½
â”‚   â”œâ”€â”€ utils/           # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ web/             # Web APIï¼ˆå¯é€‰ featureï¼‰
â”‚   â”œâ”€â”€ tui/             # TUI ç•Œé¢ï¼ˆå¯é€‰ featureï¼‰
â”‚   â”œâ”€â”€ sync/            # WebDAV åŒæ­¥ï¼ˆå¯é€‰ featureï¼‰
â”‚   â”œâ”€â”€ sessions/        # Session ç®¡ç†
â”‚   â””â”€â”€ storage/         # æ•°æ®å­˜å‚¨
â”œâ”€â”€ ccr-ui/
â”‚   â”œâ”€â”€ backend/         # Axum åç«¯ï¼Œç›´æ¥ä¾èµ– ccr crate
â”‚   â””â”€â”€ frontend/        # Vue3 + Vite + Pinia + Tailwind
â”œâ”€â”€ docs/                # VitePress æ–‡æ¡£ï¼ˆä¸­/è‹±ï¼‰
â”œâ”€â”€ examples/            # é…ç½®ç¤ºä¾‹
â””â”€â”€ tests/               # é›†æˆæµ‹è¯•
```

### é…ç½®ä¸æ•°æ®è·¯å¾„

```
~/.ccr/                      # Unified æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰
  â”œâ”€â”€ config.toml            # å¹³å°æ³¨å†Œè¡¨ï¼ˆcurrent_platform ç­‰ï¼‰
  â”œâ”€â”€ platforms/
  â”‚   â”œâ”€â”€ claude/
  â”‚   â”‚   â”œâ”€â”€ profiles.toml      # Profile é…ç½®
  â”‚   â”‚   â””â”€â”€ settings.json      # Settings é…ç½®
  â”‚   â”œâ”€â”€ codex/profiles.toml
  â”‚   â”œâ”€â”€ gemini/profiles.toml
  â”‚   â”œâ”€â”€ qwen/profiles.toml     # Stubï¼ˆæœªå®ç°ï¼‰
  â”‚   â””â”€â”€ iflow/profiles.toml    # Stubï¼ˆæœªå®ç°ï¼‰
  â”œâ”€â”€ history/               # å®¡è®¡å†å²
  â”‚   â”œâ”€â”€ claude.json
  â”‚   â”œâ”€â”€ codex.json
  â”‚   â””â”€â”€ gemini.json
  â”œâ”€â”€ backups/               # è‡ªåŠ¨å¤‡ä»½
  â”‚   â”œâ”€â”€ claude/
  â”‚   â”œâ”€â”€ codex/
  â”‚   â””â”€â”€ gemini/
  â”œâ”€â”€ sync/                  # WebDAV åŒæ­¥é…ç½®
  â”‚   â””â”€â”€ folders.json
  â”œâ”€â”€ sessions.db            # Session æ•°æ®åº“
  â”œâ”€â”€ costs.json             # æˆæœ¬è¿½è¸ª
  â”œâ”€â”€ budget.json            # é¢„ç®—é…ç½®
  â”œâ”€â”€ pricing.json           # å®šä»·é…ç½®
  â”œâ”€â”€ prompts/               # æç¤ºè¯é¢„è®¾
  â”œâ”€â”€ skills/                # æŠ€èƒ½ç®¡ç†
  â”œâ”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶ï¼ˆæŒ‰å¤©è½®è½¬ï¼‰
  â””â”€â”€ ccr-ui/                # UI ä¾èµ–/ç¼“å­˜

~/.ccs_config.toml           # Legacy æ¨¡å¼ï¼ˆå…¼å®¹ CCSï¼‰
~/.claude/settings.json      # Claude Code è®¾ç½®ï¼ˆç›´æ¥å†™å…¥ï¼‰
~/.codex/settings.json       # Codex è®¾ç½®ï¼ˆç›´æ¥å†™å…¥ï¼‰
~/.gemini/settings.json      # Gemini è®¾ç½®ï¼ˆç›´æ¥å†™å…¥ï¼‰
```

## åˆ†å±‚æ¶æ„

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  CLI / Web API / TUI / CCR UI                           â”‚
â”‚  â€¢ cli/definitions.rs - CLI ç»“æ„å®šä¹‰ï¼ˆClapï¼‰            â”‚
â”‚  â€¢ cli/dispatch.rs - å‘½ä»¤åˆ†å‘é€»è¾‘                       â”‚
â”‚  â€¢ web/routes.rs - Web API è·¯ç”±                         â”‚
â”‚  â€¢ tui/app.rs - TUI åº”ç”¨                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Commands Layerï¼ˆå‘½ä»¤å®ç°å±‚ï¼‰                           â”‚
â”‚  â”œâ”€â”€ common/        - å…¬å…±å·¥å…·ï¼ˆæ¨¡å¼æ£€æµ‹ã€è¡¨æ ¼ã€æç¤ºï¼‰  â”‚
â”‚  â”œâ”€â”€ platform/      - å¹³å°ç®¡ç†ï¼ˆlist/current/info/      â”‚
â”‚  â”‚                     init/switchï¼‰                     â”‚
â”‚  â”œâ”€â”€ profile/       - Profile ç®¡ç†ï¼ˆadd/list/current/   â”‚
â”‚  â”‚                     switch/delete/enable/disableï¼‰    â”‚
â”‚  â”œâ”€â”€ lifecycle/     - ç”Ÿå‘½å‘¨æœŸï¼ˆinit/clean/clear/       â”‚
â”‚  â”‚                     validate/optimize/migrateï¼‰       â”‚
â”‚  â”œâ”€â”€ data/          - æ•°æ®æ“ä½œï¼ˆexport/import/history/  â”‚
â”‚  â”‚                     stats/budget/pricingï¼‰            â”‚
â”‚  â””â”€â”€ ç‹¬ç«‹å‘½ä»¤       - sync/tui/web/ui/temp-token/temp/  â”‚
â”‚                       check/skills/prompts/sessions/     â”‚
â”‚                       provider/update                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Services Layerï¼ˆæœåŠ¡å±‚ - ä¸šåŠ¡é€»è¾‘ç¼–æ’ï¼‰               â”‚
â”‚  â€¢ config_service      - é…ç½®æ“ä½œï¼ˆåˆ‡æ¢/å¯¼å…¥/å¯¼å‡º/éªŒè¯ï¼‰â”‚
â”‚  â€¢ settings_service    - settings.json ç®¡ç†             â”‚
â”‚  â€¢ history_service     - å®¡è®¡æ—¥å¿—                       â”‚
â”‚  â€¢ backup_service      - å¤‡ä»½æ“ä½œ                       â”‚
â”‚  â€¢ multi_backup_service - å¤šå¹³å°å¤‡ä»½æ¸…ç†                â”‚
â”‚  â€¢ validate_service    - éªŒè¯æ“ä½œ                       â”‚
â”‚  â€¢ sync_service        - WebDAV åŒæ­¥                    â”‚
â”‚  â€¢ ui_service          - CCR UI å¯åŠ¨ç¼–æ’                â”‚
â”‚  â€¢ health_check        - Provider å¥åº·æ£€æŸ¥              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Managers Layerï¼ˆç®¡ç†å±‚ - æ•°æ®è®¿é—®ä¸æŒä¹…åŒ–ï¼‰           â”‚
â”‚  â”œâ”€â”€ config/            - é…ç½®ç®¡ç†ï¼ˆLegacy/Unifiedï¼‰    â”‚
â”‚  â”‚   â”œâ”€â”€ manager.rs    - é…ç½®ç®¡ç†å™¨                    â”‚
â”‚  â”‚   â”œâ”€â”€ ccs_config.rs - Legacy é…ç½®                   â”‚
â”‚  â”‚   â”œâ”€â”€ types.rs      - Unified é…ç½®ç±»å‹              â”‚
â”‚  â”‚   â””â”€â”€ migration.rs  - è¿ç§»é€»è¾‘                      â”‚
â”‚  â”œâ”€â”€ platform_config    - å¹³å°æ³¨å†Œè¡¨ç®¡ç†                â”‚
â”‚  â”œâ”€â”€ settings           - Settings.json ç®¡ç†            â”‚
â”‚  â”œâ”€â”€ history            - å†å²è®°å½•ç®¡ç†                  â”‚
â”‚  â”œâ”€â”€ cost_tracker       - æˆæœ¬è¿½è¸ª                      â”‚
â”‚  â”œâ”€â”€ budget_manager     - é¢„ç®—æ§åˆ¶                      â”‚
â”‚  â”œâ”€â”€ pricing_manager    - ä»·æ ¼è¡¨ç®¡ç†                    â”‚
â”‚  â”œâ”€â”€ prompts_manager    - æç¤ºè¯ç®¡ç†                    â”‚
â”‚  â”œâ”€â”€ builtin_prompts    - å†…ç½®æç¤ºè¯                    â”‚
â”‚  â”œâ”€â”€ skills_manager     - æŠ€èƒ½ç®¡ç†                      â”‚
â”‚  â”œâ”€â”€ mcp_preset_manager - MCP é¢„è®¾ç®¡ç†                  â”‚
â”‚  â”œâ”€â”€ sync_config        - åŒæ­¥é…ç½®                      â”‚
â”‚  â”œâ”€â”€ sync_folder_manager - åŒæ­¥æ–‡ä»¶å¤¹ç®¡ç†               â”‚
â”‚  â”œâ”€â”€ temp_override      - ä¸´æ—¶è¦†ç›–                      â”‚
â”‚  â”œâ”€â”€ config_editor      - é…ç½®ç¼–è¾‘                      â”‚
â”‚  â”œâ”€â”€ config_file_handler - é…ç½®æ–‡ä»¶å¤„ç†                 â”‚
â”‚  â”œâ”€â”€ config_validator   - é…ç½®éªŒè¯                      â”‚
â”‚  â””â”€â”€ conflict_checker   - å†²çªæ£€æµ‹                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Models Layerï¼ˆæ•°æ®æ¨¡å‹å±‚ï¼‰                             â”‚
â”‚  â€¢ platform        - å¹³å°ç±»å‹å’Œé…ç½® trait               â”‚
â”‚  â€¢ budget          - é¢„ç®—æ¨¡å‹                            â”‚
â”‚  â€¢ pricing         - å®šä»·æ¨¡å‹                            â”‚
â”‚  â€¢ stats           - ç»Ÿè®¡æ¨¡å‹                            â”‚
â”‚  â€¢ sync_folder     - åŒæ­¥æ–‡ä»¶å¤¹æ¨¡å‹                      â”‚
â”‚  â€¢ prompt          - æç¤ºè¯æ¨¡å‹                          â”‚
â”‚  â€¢ skill           - æŠ€èƒ½æ¨¡å‹                            â”‚
â”‚  â€¢ mcp_preset      - MCP é¢„è®¾æ¨¡å‹                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Platforms Layerï¼ˆå¹³å°å®ç°å±‚ï¼‰                          â”‚
â”‚  â€¢ base            - åŸºç¡€åŠŸèƒ½ï¼ˆå…¬å…±è¾…åŠ©å‡½æ•°ï¼‰            â”‚
â”‚  â€¢ claude          - Claude Code å¹³å°ï¼ˆâœ… å·²å®ç°ï¼‰       â”‚
â”‚  â€¢ codex           - Codex CLI å¹³å°ï¼ˆâœ… å·²å®ç°ï¼‰         â”‚
â”‚  â€¢ gemini          - Gemini CLI å¹³å°ï¼ˆâœ… å·²å®ç°ï¼‰        â”‚
â”‚  â€¢ qwen            - Qwen CLI å¹³å°ï¼ˆğŸš§ Stubï¼‰           â”‚
â”‚  â€¢ iflow           - iFlow CLI å¹³å°ï¼ˆğŸš§ Stubï¼‰          â”‚
â”‚  â€¢ PlatformRegistry - å¹³å°æ³¨å†Œè¡¨                        â”‚
â”‚  â€¢ PlatformDetector - å¹³å°æ£€æµ‹å™¨                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Core & Utils Layerï¼ˆæ ¸å¿ƒåŸºç¡€è®¾æ–½å±‚ï¼‰                  â”‚
â”‚  â”œâ”€â”€ core/                                              â”‚
â”‚  â”‚   â”œâ”€â”€ error          - ç»Ÿä¸€é”™è¯¯å¤„ç†ï¼ˆCcrErrorï¼‰     â”‚
â”‚  â”‚   â”œâ”€â”€ lock           - æ–‡ä»¶é” + è¿›ç¨‹å†…äº’æ–¥          â”‚
â”‚  â”‚   â”œâ”€â”€ logging        - tracing + å½©è‰²è¾“å‡º           â”‚
â”‚  â”‚   â”œâ”€â”€ atomic_writer  - åŸå­æ–‡ä»¶å†™å…¥                 â”‚
â”‚  â”‚   â”œâ”€â”€ file_manager   - æ–‡ä»¶ç®¡ç†æŠ½è±¡                 â”‚
â”‚  â”‚   â”œâ”€â”€ fileio         - ç»Ÿä¸€æ–‡ä»¶ I/O                 â”‚
â”‚  â”‚   â”œâ”€â”€ cache          - é…ç½®ç¼“å­˜                     â”‚
â”‚  â”‚   â””â”€â”€ http           - HTTP å®¢æˆ·ç«¯                  â”‚
â”‚  â””â”€â”€ utils/                                             â”‚
â”‚      â”œâ”€â”€ validation     - éªŒè¯è¾…åŠ©                     â”‚
â”‚      â”œâ”€â”€ mask           - æ•æ„Ÿæ•°æ®æ©ç                  â”‚
â”‚      â”œâ”€â”€ toml_json      - TOML/JSON è½¬æ¢               â”‚
â”‚      â””â”€â”€ auto_complete  - è‡ªåŠ¨å®Œæˆ                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ä¾èµ–æ–¹å‘

- **ä¸¥æ ¼å•å‘ä¾èµ–**ï¼šCLI/Web/TUI â†’ Commands â†’ Services â†’ Managers â†’ Core/Utils
- **å…±äº«å±‚**ï¼šModelsã€Platformsã€Utils å¯è¢«ä¸Šå±‚å…±äº«
- **ç‰¹æ€§éš”ç¦»**ï¼š`web`ã€`tui` ç‰¹æ€§å¯é€‰ç¼–è¯‘
- **UI é›†æˆ**ï¼š`ccr-ui/backend` ç›´æ¥å¤ç”¨ `ccr` crateï¼ˆå…³é—­é»˜è®¤ç‰¹æ€§ï¼‰ï¼Œåœ¨è‡ªèº«å±‚å®ç°è·¯ç”±/èŠ‚æµ/ä¸­é—´ä»¶

## æ ¸å¿ƒæµç¨‹

### Profile åˆ‡æ¢ï¼ˆUnified é»˜è®¤ï¼‰

1. **CLI è§£æ**ï¼š`commands::switch_command` æˆ–å¿«æ· `ccr <name>`
2. **é…ç½®åŠ è½½**ï¼š
   - `ConfigService`ï¼šè¯»å– `~/.ccr/config.toml` â†’ å®šä½å½“å‰å¹³å°
   - åŠ è½½ `~/.ccr/platforms/<platform>/profiles.toml`
3. **è®¾ç½®æ›´æ–°**ï¼š
   - `SettingsService`ï¼šè·å–æ–‡ä»¶é” â†’ å¤‡ä»½ç°æœ‰ `settings.json`
   - åŸå­å†™å…¥æ–°é…ç½®
4. **å†å²è®°å½•**ï¼š
   - `HistoryService`ï¼šè®°å½•æ“ä½œã€ç¯å¢ƒå˜é‡å·®å¼‚ï¼ˆè‡ªåŠ¨æ©ç æ•æ„Ÿä¿¡æ¯ï¼‰
5. **ä¸´æ—¶è¦†ç›–**ï¼ˆå¯é€‰ï¼‰ï¼š
   - `TempOverrideManager`ï¼šæ³¨å…¥ä¸´æ—¶ token/base_url/model

### å¹³å°ç®¡ç†

- **å¹³å°å‘½ä»¤**ï¼š`platform list/current/info/init/switch`
- **ç®¡ç†å™¨**ï¼šé€šè¿‡ `PlatformConfigManager` ç»´æŠ¤ `config.toml` ä¸­çš„æ³¨å†Œè¡¨ä¸å½“å‰å¹³å°æŒ‡é’ˆ
- **å¹³å°å®ç°**ï¼š
  - å®ç° `PlatformConfig` traitï¼Œæš´éœ²è·¯å¾„ä¸ profile è¯»å†™
  - æœªå®ç°çš„å¹³å°è¿”å› `PlatformNotSupported` é”™è¯¯

### WebDAV å¤šç›®å½•åŒæ­¥

1. **é…ç½®åŒæ­¥**ï¼š`sync config` å†™å…¥ WebDAV è¿æ¥ä¿¡æ¯ï¼ˆ`SyncConfigManager`ï¼‰
2. **æ–‡ä»¶å¤¹æ³¨å†Œ**ï¼š`sync folder ...` æ³¨å†Œ/å¯ç”¨ç›®å½•ï¼ˆé»˜è®¤æŒ‚è½½ `~/.ccr`ã€`platforms/*` ç­‰ï¼‰
3. **æ¨é€/æ‹‰å–**ï¼š
   - `SyncService` é€’å½’éå†ï¼Œè¿‡æ»¤å¤‡ä»½/å†å²/locks/UI
   - æ”¯æŒ `--force`ã€äº¤äº’å¼å†…å®¹é€‰æ‹©ã€å•ç›®å½•æˆ– `sync all`

### CCR UI å¯åŠ¨

- **æ£€æµ‹é¡ºåº**ï¼š`UiService` ä¾åºæ£€æŸ¥ï¼š
  1. `./ccr-ui`ï¼ˆæœ¬åœ°æºç ï¼‰
  2. `~/.ccr/ccr-ui`ï¼ˆç”¨æˆ·å®‰è£…ï¼‰
  3. GitHub ä¸‹è½½ï¼ˆäº¤äº’ç¡®è®¤ï¼‰
- **ç«¯å£é…ç½®**ï¼šé€šè¿‡ `-p/--backend-port` è¦†ç›–
- **è¿›ç¨‹ç®¡ç†**ï¼šè‡ªåŠ¨å¯åŠ¨å‰åç«¯ï¼Œç›‘æ§è¿›ç¨‹çŠ¶æ€

### Session ç®¡ç†

- **å­˜å‚¨**ï¼šSQLite æ•°æ®åº“ (`~/.ccr/sessions.db`)
- **åŠŸèƒ½**ï¼š
  - ä¼šè¯åˆ—è¡¨ã€æœç´¢ã€ç»Ÿè®¡
  - å…¨æ–‡ç´¢å¼•ã€é‡å»ºç´¢å¼•
  - ä¼šè¯åˆ†æï¼ˆæˆæœ¬ã€Token ä½¿ç”¨ï¼‰

### æˆæœ¬è¿½è¸ªä¸é¢„ç®—æ§åˆ¶

- **æˆæœ¬è¿½è¸ª**ï¼š
  - `CostTracker`ï¼šè®°å½•å’Œç»Ÿè®¡ API è°ƒç”¨æˆæœ¬
  - æ”¯æŒæŒ‰æ—¶é—´èŒƒå›´ã€æ¨¡å‹ã€å¹³å°ç»Ÿè®¡
  - å­˜å‚¨åˆ° `~/.ccr/costs.json`
- **é¢„ç®—æ§åˆ¶**ï¼š
  - `BudgetManager`ï¼šç®¡ç†é¢„ç®—é™åˆ¶ï¼ˆæ—¥/å‘¨/æœˆï¼‰
  - æ”¯æŒé¢„ç®—è­¦å‘Šã€è¶…é™åŠ¨ä½œ
  - å­˜å‚¨åˆ° `~/.ccr/budget.json`
- **å®šä»·ç®¡ç†**ï¼š
  - `PricingManager`ï¼šç®¡ç†æ¨¡å‹å®šä»·
  - å­˜å‚¨åˆ° `~/.ccr/pricing.json`

### Provider å¥åº·æ£€æŸ¥

- **ç«¯ç‚¹æµ‹è¯•**ï¼šæµ‹è¯• Provider API è¿é€šæ€§
- **è®¤è¯éªŒè¯**ï¼šéªŒè¯ API Key æœ‰æ•ˆæ€§
- **å“åº”æ—¶é—´**ï¼šæµ‹é‡ API å“åº”å»¶è¿Ÿ
- **é”™è¯¯è¯Šæ–­**ï¼šæä¾›è¯¦ç»†çš„é”™è¯¯ä¿¡æ¯

## å¯é æ€§ä¸æ€§èƒ½

### å¹¶å‘å®‰å…¨

- **æ–‡ä»¶é”**ï¼š`fs4` æä¾›è·¨è¿›ç¨‹æ–‡ä»¶é”å®š
- **è¿›ç¨‹å†…äº’æ–¥**ï¼š`CONFIG_LOCK` å…¨å±€é™æ€é”
- **åŸå­å†™å…¥**ï¼šä¸´æ—¶æ–‡ä»¶ + åŸå­é‡å‘½åï¼Œé¿å…æŸå

### å¤‡ä»½ç­–ç•¥

- **è‡ªåŠ¨å¤‡ä»½**ï¼šåˆ‡æ¢/å¯¼å…¥å‰è‡ªåŠ¨å¤‡ä»½é…ç½®
- **å¤šå¹³å°æ”¯æŒ**ï¼š`MultiBackupService` æ”¯æŒå¤šå¹³å°å¤‡ä»½æ¸…ç†
- **è¿‡æœŸæ¸…ç†**ï¼š`clean` å‘½ä»¤æ¸…ç†è¿‡æœŸå¤‡ä»½

### æ—¥å¿—ç³»ç»Ÿ

- **æ—¥å¿—çº§åˆ«**ï¼š`CCR_LOG_LEVEL` ç¯å¢ƒå˜é‡æ§åˆ¶
- **è¾“å‡ºä½ç½®**ï¼šç»ˆç«¯å½©è‰²è¾“å‡º + `~/.ccr/logs/` æ–‡ä»¶
- **æ—¥å¿—è½®è½¬**ï¼šæŒ‰å¤©è½®è½¬ï¼Œä¿ç•™ 14 å¤©

### æ€§èƒ½ä¼˜åŒ–

- **å¹¶è¡ŒéªŒè¯**ï¼š`rayon` å¹¶è¡ŒéªŒè¯é…ç½®
- **ç»Ÿä¸€ I/O**ï¼š`fileio` ç»Ÿä¸€æ–‡ä»¶è¯»å†™
- **ç¼–è¯‘ä¼˜åŒ–**ï¼šdev profile `opt-level=1` + ä¾èµ– `opt-level=2`
- **ç¼“å­˜æœºåˆ¶**ï¼š
  - Axum å±‚ç¼“å­˜ç³»ç»Ÿä¿¡æ¯
  - `ConfigCache` ç¼“å­˜é…ç½®æ–‡ä»¶

## æµ‹è¯•ä¸è´¨é‡

### æµ‹è¯•ç­–ç•¥

- **å•å…ƒæµ‹è¯•**ï¼šè¦†ç›–å¹³å°/ç®¡ç†å™¨/é”ç­‰æ ¸å¿ƒæ¨¡å—
- **é›†æˆæµ‹è¯•**ï¼š`tests/` è¿›è¡Œç«¯åˆ°ç«¯æµ‹è¯•ï¼ˆä¸´æ—¶ç›®å½•éš”ç¦»ï¼‰
- **æµ‹è¯•è¦†ç›–**ï¼š95%+ æ ¸å¿ƒä»£ç è¦†ç›–ç‡

### è´¨é‡ä¿è¯

- **é›¶ panic**ï¼šé»˜è®¤é›¶ `panic!`ï¼Œä½¿ç”¨ `Result` ç±»å‹
- **é”™è¯¯é›†ä¸­**ï¼šç»Ÿä¸€ `CcrError` é”™è¯¯ç±»å‹
- **é€€å‡ºç **ï¼šå‘½ä»¤è¿”å›æ ‡å‡†é€€å‡ºç 
- **Clippy**ï¼šé€šè¿‡ä¸¥æ ¼çš„ Clippy æ£€æŸ¥
  - æ ‡å‡†ï¼š`-D warnings`
  - ä¸¥æ ¼ï¼ˆCIï¼‰ï¼š`-D warnings -W clippy::unwrap_used`
- **æ ¼å¼åŒ–**ï¼š`cargo fmt` ç»Ÿä¸€æ ¼å¼

## æ‰©å±•æŒ‡å—

### æ–°å¢å‘½ä»¤

1. åœ¨ `src/commands/<domain>/` åˆ›å»ºå‘½ä»¤æ¨¡å—
2. åœ¨ `src/commands/mod.rs` å¯¼å‡ºå‘½ä»¤å‡½æ•°
3. åœ¨ `src/cli/definitions.rs` æ·»åŠ  CLI å®šä¹‰
4. åœ¨ `src/cli/dispatch.rs` æ·»åŠ å‘½ä»¤è·¯ç”±

### æ–°å¢å¹³å°

1. åœ¨ `src/platforms/` åˆ›å»ºå¹³å°æ¨¡å—ï¼ˆå¦‚ `new_platform.rs`ï¼‰
2. å®ç° `PlatformConfig` trait
3. åœ¨ `src/models/platform.rs` çš„ `Platform` æšä¸¾ä¸­æ·»åŠ å¹³å°ç±»å‹
4. åœ¨ `src/platforms/mod.rs` çš„ `create_platform` å‡½æ•°ä¸­æ³¨å†Œ

### æ–°å¢åŒæ­¥æº

1. æ‰©å±• `SyncService` å®ç°æ–°çš„åŒæ­¥åè®®
2. åœ¨ `sync::commands` ä¸­å¢åŠ å†…å®¹é€‰æ‹©å™¨ç­–ç•¥
3. æ›´æ–° `SyncConfig` æ¨¡å‹ä»¥æ”¯æŒæ–°é…ç½®

## å‚è€ƒæ–‡æ¡£

- [å‘½ä»¤å‚è€ƒ](/reference/commands/index.md)
- [å¹³å°æ”¯æŒ](/reference/platforms/)
- [é…ç½®æŒ‡å—](/guide/configuration.md)
- [è¿ç§»æŒ‡å—](/reference/platforms/migration.md)
