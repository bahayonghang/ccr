# update - æ›´æ–° CCR

ä» GitHub è‡ªåŠ¨æ›´æ–° CCR åˆ°æœ€æ–°ç‰ˆæœ¬,æ”¯æŒå®æ—¶è¿›åº¦æ˜¾ç¤ºã€‚

## ç”¨æ³•

```bash
ccr update [OPTIONS]
```

## é€‰é¡¹

- `--check, -c`: ä»…æ£€æŸ¥æ›´æ–°æ¨¡å¼,é¢„è§ˆæ›´æ–°å‘½ä»¤ä½†ä¸æ‰§è¡Œå®é™…æ›´æ–°

## åŠŸèƒ½ç‰¹æ€§

- âœ¨ **å®æ—¶è¿›åº¦æ˜¾ç¤º** - æ˜¾ç¤º cargo ç¼–è¯‘å’Œä¸‹è½½çš„å®æ—¶è¿›åº¦
- ğŸš€ **è‡ªåŠ¨æ›´æ–°** - ä½¿ç”¨ `cargo install --git` ç›´æ¥ä» GitHub æ›´æ–°
- ğŸ”’ **æ›´æ–°å‰ç¡®è®¤** - æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯å¹¶ç­‰å¾…ç”¨æˆ·ç¡®è®¤
- ğŸ“‹ **è¯¦ç»†ä¿¡æ¯** - æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬ã€ä»“åº“åœ°å€å’Œæ‰§è¡Œå‘½ä»¤
- ğŸ›¡ï¸ **é”™è¯¯è¯Šæ–­** - æä¾›è¯¦ç»†çš„é”™è¯¯åŸå› å’Œè§£å†³æ–¹æ¡ˆ
- ğŸ“ **åç»­æŒ‡å¼•** - æ›´æ–°å®Œæˆåæä¾›éªŒè¯å’ŒæŸ¥çœ‹æ–°åŠŸèƒ½çš„æ­¥éª¤

## ç³»ç»Ÿè¦æ±‚

- å·²å®‰è£… Rust å’Œ Cargo å·¥å…·é“¾
- å¯è®¿é—® GitHub (https://github.com)
- ç½‘ç»œè¿æ¥ç¨³å®š

## ç­‰æ•ˆå‘½ä»¤

```bash
cargo install --git https://github.com/bahayonghang/ccr ccr --force
```

## ç¤ºä¾‹

### 1. æ£€æŸ¥æ›´æ–°(æ¨èå…ˆä½¿ç”¨)

```bash
# æŸ¥çœ‹æ›´æ–°ä¿¡æ¯ä½†ä¸æ‰§è¡Œæ›´æ–°
ccr update --check

# ç®€å†™å½¢å¼
ccr update -c
```

### 2. æ‰§è¡Œæ›´æ–°

```bash
# æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
ccr update
```

## ç¤ºä¾‹è¾“å‡º

### æ£€æŸ¥æ›´æ–°æ¨¡å¼

```bash
$ ccr update --check

CCR è‡ªåŠ¨æ›´æ–°
â•â•â•â•â•â•â•â•

  å½“å‰ç‰ˆæœ¬: 0.3.2
  ä»“åº“åœ°å€: https://github.com/bahayonghang/ccr

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â„¹ æ£€æŸ¥æ¨¡å¼ - ä¸ä¼šæ‰§è¡Œå®é™…æ›´æ–°

â–¶ æ›´æ–°å‘½ä»¤é¢„è§ˆ
  cargo install --git https://github.com/bahayonghang/ccr ccr --force

â„¹ ğŸ’¡ æç¤º: è¿è¡Œ 'ccr update' æ‰§è¡Œæ›´æ–°(å»æ‰ --check å‚æ•°)
```

### æ‰§è¡Œæ›´æ–°

```bash
$ ccr update

CCR è‡ªåŠ¨æ›´æ–°
â•â•â•â•â•â•â•â•

  å½“å‰ç‰ˆæœ¬: 0.3.2
  ä»“åº“åœ°å€: https://github.com/bahayonghang/ccr

? ç¡®è®¤æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬? [Y/n]: y

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

â–¶ å¼€å§‹æ›´æ–° CCR

â„¹ æ‰§è¡Œå‘½ä»¤:
  cargo install --git https://github.com/bahayonghang/ccr ccr --force

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

    Updating git repository `https://github.com/bahayonghang/ccr`
   Compiling proc-macro2 v1.0.86
   Compiling unicode-ident v1.0.13
   Compiling libc v0.2.168
   ... (å®æ—¶æ˜¾ç¤ºç¼–è¯‘è¿›åº¦)
   Compiling ccr v0.3.2 (https://github.com/bahayonghang/ccr)
    Finished `release` profile [optimized] target(s) in 1m 23s
  Installing /home/user/.cargo/bin/ccr
   Installed package `ccr v0.3.2` (executable `ccr`)

â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ‰ æ›´æ–°æˆåŠŸå®Œæˆ

â„¹ åç»­æ­¥éª¤:
  1. è¿è¡Œ 'ccr version' æŸ¥çœ‹æ–°ç‰ˆæœ¬ä¿¡æ¯
  2. è¿è¡Œ 'ccr --help' æŸ¥çœ‹æ–°åŠŸèƒ½
```

### å–æ¶ˆæ›´æ–°

```bash
$ ccr update

CCR è‡ªåŠ¨æ›´æ–°
â•â•â•â•â•â•â•â•

  å½“å‰ç‰ˆæœ¬: 0.3.2
  ä»“åº“åœ°å€: https://github.com/bahayonghang/ccr

? ç¡®è®¤æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬? [Y/n]: n

â„¹ å·²å–æ¶ˆæ›´æ–°
```

## æ›´æ–°è¿‡ç¨‹è¯¦è§£

### 1. æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯

æ˜¾ç¤ºå½“å‰ç‰ˆæœ¬å’Œä»“åº“åœ°å€,è®©ç”¨æˆ·äº†è§£æ›´æ–°æ¥æºã€‚

### 2. ç”¨æˆ·ç¡®è®¤

é™¤éä½¿ç”¨ `--check` æ¨¡å¼,å¦åˆ™ä¼šè¯¢é—®ç”¨æˆ·æ˜¯å¦ç»§ç»­æ›´æ–°ã€‚

### 3. å®æ—¶æ‰§è¡Œæ›´æ–°

æ‰§è¡Œ cargo install å¹¶å®æ—¶æ˜¾ç¤ºï¼š
- Git å…‹éš†è¿›åº¦
- ä¾èµ–ä¸‹è½½è¿›åº¦
- ç¼–è¯‘è¿›åº¦(æ¯ä¸ª crate)
- å®‰è£…è¿›åº¦

### 4. æ˜¾ç¤ºç»“æœ

æ›´æ–°å®Œæˆåæ˜¾ç¤ºæˆåŠŸæ¶ˆæ¯å’Œåç»­æ“ä½œå»ºè®®ã€‚

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯ 1: å®šæœŸæ£€æŸ¥æ–°åŠŸèƒ½

```bash
# æ¯å‘¨æ£€æŸ¥æ˜¯å¦æœ‰æ›´æ–°
ccr update --check

# å¦‚æœæœ‰æ–°åŠŸèƒ½,æ‰§è¡Œæ›´æ–°
ccr update
```

### åœºæ™¯ 2: è·å– Bug ä¿®å¤

```bash
# ç›´æ¥æ›´æ–°åˆ°æœ€æ–°ç‰ˆæœ¬
ccr update

# éªŒè¯ä¿®å¤æ•ˆæœ
ccr validate
```

### åœºæ™¯ 3: æ›´æ–°å‰å¤‡ä»½

```bash
# å¯¼å‡ºå½“å‰é…ç½®
ccr export -o backup-before-update.toml

# æ‰§è¡Œæ›´æ–°
ccr update

# éªŒè¯é…ç½®
ccr validate
```

### åœºæ™¯ 4: è‡ªåŠ¨åŒ–è„šæœ¬

```bash
#!/bin/bash
# è‡ªåŠ¨æ›´æ–°æ£€æŸ¥è„šæœ¬

echo "æ£€æŸ¥ CCR æ›´æ–°..."
ccr update --check

if [ $? -eq 0 ]; then
    read -p "å‘ç°å¯ç”¨æ›´æ–°,æ˜¯å¦ç«‹å³æ›´æ–°? [y/N] " -n 1 -r
    echo
    if [[ $REPLY =~ ^[Yy]$ ]]; then
        ccr export -o ~/backups/ccr-$(date +%Y%m%d).toml
        ccr update
    fi
fi
```

## æ•…éšœæ’é™¤

### é—®é¢˜ 1: Cargo æœªå®‰è£…

**é”™è¯¯ä¿¡æ¯ï¼š**
```
æ— æ³•å¯åŠ¨ cargo å‘½ä»¤: No such file or directory

å¯èƒ½åŸå› ï¼š
  â€¢ æœªå®‰è£… Rust å·¥å…·é“¾
  â€¢ cargo ä¸åœ¨ç³»ç»Ÿ PATH ä¸­
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# å®‰è£… Rust å·¥å…·é“¾
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh

# é‡æ–°åŠ è½½ç¯å¢ƒ
source $HOME/.cargo/env

# éªŒè¯å®‰è£…
cargo --version

# é‡æ–°è¿è¡Œæ›´æ–°
ccr update
```

### é—®é¢˜ 2: ç½‘ç»œè¿æ¥å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
âŒ æ›´æ–°å¤±è´¥

â„¹ å¯èƒ½çš„åŸå› :
  â€¢ ç½‘ç»œè¿æ¥é—®é¢˜(æ— æ³•è®¿é—® GitHub)
  â€¢ Git æœªå®‰è£…æˆ–é…ç½®ä¸æ­£ç¡®
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ£€æŸ¥ç½‘ç»œè¿æ¥
ping github.com

# 2. æ£€æŸ¥ Git æ˜¯å¦å®‰è£…
git --version

# 3. é…ç½®ä»£ç†(å¦‚éœ€è¦)
export https_proxy=http://proxy.example.com:8080
export http_proxy=http://proxy.example.com:8080

# 4. é‡è¯•æ›´æ–°
ccr update

# 5. æˆ–æ‰‹åŠ¨å…‹éš†å¹¶å®‰è£…
git clone https://github.com/bahayonghang/ccr
cd ccr
cargo install --path . --locked
```

### é—®é¢˜ 3: ç¼–è¯‘å¤±è´¥

**é”™è¯¯ä¿¡æ¯ï¼š**
```
error: failed to compile ccr v0.3.2
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ›´æ–° Rust å·¥å…·é“¾
rustup update stable

# 2. æ£€æŸ¥ Rust ç‰ˆæœ¬(éœ€è¦è¾ƒæ–°ç‰ˆæœ¬)
rustc --version

# 3. æ¸…ç†ç¼“å­˜
cargo clean

# 4. é‡è¯•æ›´æ–°
ccr update

# 5. å¦‚ä»å¤±è´¥,å°è¯•æ‰‹åŠ¨ç¼–è¯‘
git clone https://github.com/bahayonghang/ccr
cd ccr
cargo build --release --locked
cargo install --path .
```

### é—®é¢˜ 4: æƒé™é”™è¯¯

**é”™è¯¯ä¿¡æ¯ï¼š**
```
error: failed to install

â„¹ å¯èƒ½çš„åŸå› :
  â€¢ æƒé™ä¸è¶³(æ— æ³•å†™å…¥ ~/.cargo/bin)
```

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ£€æŸ¥ç›®å½•æƒé™
ls -la ~/.cargo/bin

# 2. ä¿®å¤æƒé™
chmod 755 ~/.cargo/bin
chmod 755 ~/.cargo/bin/ccr 2>/dev/null || true

# 3. é‡è¯•æ›´æ–°
ccr update
```

### é—®é¢˜ 5: æ—§ç‰ˆæœ¬æ®‹ç•™

**ç—‡çŠ¶ï¼š** æ›´æ–°åè¿è¡Œä»æ˜¾ç¤ºæ—§ç‰ˆæœ¬

**è§£å†³æ–¹æ¡ˆï¼š**
```bash
# 1. æ£€æŸ¥ ccr ä½ç½®
which ccr

# 2. æ£€æŸ¥æ˜¯å¦æœ‰å¤šä¸ªç‰ˆæœ¬
find ~ -name ccr -type f 2>/dev/null

# 3. é‡æ–°å®‰è£…
cargo install --git https://github.com/bahayonghang/ccr ccr --force

# 4. åˆ·æ–° shell
hash -r

# 5. éªŒè¯ç‰ˆæœ¬
ccr version
```

## ç‰ˆæœ¬å›é€€

å¦‚æœæ›´æ–°åé‡åˆ°é—®é¢˜,å¯ä»¥å›é€€åˆ°ä¹‹å‰çš„ç‰ˆæœ¬ã€‚

### æ–¹æ³• 1: å®‰è£…ç‰¹å®šç‰ˆæœ¬æ ‡ç­¾

```bash
# åˆ—å‡ºæ‰€æœ‰å¯ç”¨ç‰ˆæœ¬
git ls-remote --tags https://github.com/bahayonghang/ccr

# å®‰è£…ç‰¹å®šç‰ˆæœ¬
cargo install --git https://github.com/bahayonghang/ccr ccr --tag v0.3.1 --force
```

### æ–¹æ³• 2: å®‰è£…ç‰¹å®š Commit

```bash
# å®‰è£…æŒ‡å®š commit
cargo install --git https://github.com/bahayonghang/ccr ccr --rev abc123def --force
```

### æ–¹æ³• 3: ä»å¤‡ä»½æ¢å¤

```bash
# å¦‚æœä¹‹å‰å¤‡ä»½äº†äºŒè¿›åˆ¶æ–‡ä»¶
cp ~/.cargo/bin/ccr.backup ~/.cargo/bin/ccr
chmod 755 ~/.cargo/bin/ccr

# éªŒè¯ç‰ˆæœ¬
ccr version
```

## æ›´æ–°åéªŒè¯

### 1. æ£€æŸ¥ç‰ˆæœ¬

```bash
ccr version
```

### 2. éªŒè¯æ ¸å¿ƒåŠŸèƒ½

```bash
# åˆ—å‡ºé…ç½®
ccr list

# éªŒè¯é…ç½®
ccr validate

# æŸ¥çœ‹å†å²
ccr history -l 5
```

### 3. æŸ¥çœ‹æ–°åŠŸèƒ½

```bash
# æŸ¥çœ‹å¸®åŠ©
ccr --help

# æŸ¥çœ‹å„å‘½ä»¤å¸®åŠ©
ccr <command> --help
```

### 4. æµ‹è¯•é…ç½®åˆ‡æ¢

```bash
# è®°å½•å½“å‰é…ç½®
CURRENT=$(ccr current | grep "å½“å‰é…ç½®" | awk '{print $2}')

# åˆ‡æ¢æµ‹è¯•
ccr list
ccr switch <test-config>

# åˆ‡æ¢å›æ¥
ccr switch $CURRENT
```

## æœ€ä½³å®è·µ

### 1. æ›´æ–°å‰å¤‡ä»½

```bash
# å¯¼å‡ºé…ç½®
ccr export -o ~/backups/ccr-backup-$(date +%Y%m%d_%H%M%S).toml

# å¤‡ä»½äºŒè¿›åˆ¶(å¯é€‰)
cp ~/.cargo/bin/ccr ~/.cargo/bin/ccr.$(ccr version | head -1 | awk '{print $2}')

# æ‰§è¡Œæ›´æ–°
ccr update
```

### 2. å®šæœŸæ£€æŸ¥æ›´æ–°

```bash
# æ·»åŠ åˆ° crontab(æ¯å‘¨ä¸€ä¸Šåˆ 9 ç‚¹æ£€æŸ¥)
0 9 * * 1 /home/user/.cargo/bin/ccr update --check > /tmp/ccr-update-check.log
```

### 3. æµ‹è¯•ç¯å¢ƒå…ˆæ›´æ–°

```bash
# å¼€å‘/æµ‹è¯•ç¯å¢ƒ
ssh dev-server "ccr update"
ssh dev-server "ccr validate"

# éªŒè¯æˆåŠŸåæ›´æ–°ç”Ÿäº§ç¯å¢ƒ
ccr update
```

### 4. ä¿æŒå·¥å…·é“¾æœ€æ–°

```bash
# æ›´æ–° Rust å·¥å…·é“¾
rustup update

# æ›´æ–° CCR
ccr update
```

### 5. è®°å½•æ›´æ–°å†å²

```bash
# åˆ›å»ºæ›´æ–°æ—¥å¿—
echo "$(date): Updated CCR from $(ccr version) to latest" >> ~/ccr-updates.log

# æ›´æ–°
ccr update

# è®°å½•æ–°ç‰ˆæœ¬
echo "$(date): Now running $(ccr version)" >> ~/ccr-updates.log
```

## ç›¸å…³å‘½ä»¤

- [version](./version) - æŸ¥çœ‹ç‰ˆæœ¬ä¿¡æ¯å’ŒåŠŸèƒ½ç‰¹æ€§
- [validate](./validate) - éªŒè¯é…ç½®å®Œæ•´æ€§
- [export](./export) - å¯¼å‡ºé…ç½®å¤‡ä»½
- [init](./init) - åˆå§‹åŒ–é…ç½®æ–‡ä»¶

## æŠ€æœ¯ç»†èŠ‚

### æ›´æ–°æœºåˆ¶

CCR ä½¿ç”¨ `cargo install --git` æœºåˆ¶ï¼š

1. ä» GitHub å…‹éš†æœ€æ–°ä»£ç 
2. ç¼–è¯‘ release ç‰ˆæœ¬(å¸¦ä¼˜åŒ–)
3. å®‰è£…åˆ° `~/.cargo/bin/ccr`
4. æ›¿æ¢æ—§ç‰ˆæœ¬

### è¿›åº¦æ˜¾ç¤ºå®ç°

ä½¿ç”¨ `Stdio::inherit()` å®ç°å®æ—¶è¾“å‡ºï¼š

```rust
Command::new("cargo")
    .stdout(Stdio::inherit())  // å®æ—¶æ˜¾ç¤ºæ ‡å‡†è¾“å‡º
    .stderr(Stdio::inherit())  // å®æ—¶æ˜¾ç¤ºæ ‡å‡†é”™è¯¯
    .spawn()?
    .wait()?
```

### ç‰ˆæœ¬è¯†åˆ«

å½“å‰ç‰ˆæœ¬åœ¨ç¼–è¯‘æ—¶åµŒå…¥ï¼š

```rust
env!("CARGO_PKG_VERSION")  // ä» Cargo.toml è¯»å–
```

## å®‰å…¨æ³¨æ„äº‹é¡¹

1. **ä»…ä»å®˜æ–¹ä»“åº“æ›´æ–°** - ç¡®è®¤ URL ä¸º `https://github.com/bahayonghang/ccr`
2. **æ£€æŸ¥ç½‘ç»œç¯å¢ƒ** - é¿å…åœ¨ä¸ä¿¡ä»»çš„ç½‘ç»œç¯å¢ƒæ›´æ–°
3. **å¤‡ä»½é…ç½®** - æ›´æ–°å‰å¯¼å‡ºé…ç½®ä»¥é˜²ä¸‡ä¸€
4. **éªŒè¯å®‰è£…** - æ›´æ–°åè¿è¡Œ `ccr validate` ç¡®è®¤åŠŸèƒ½æ­£å¸¸

## å¸¸è§é—®é¢˜ (FAQ)

**Q: æ›´æ–°ä¼šä¸¢å¤±é…ç½®å—ï¼Ÿ**
A: ä¸ä¼šã€‚é…ç½®å­˜å‚¨åœ¨ `~/.ccs_config.toml` å’Œ `~/.claude/settings.json`,æ›´æ–°ä»…æ›¿æ¢å¯æ‰§è¡Œæ–‡ä»¶ã€‚

**Q: éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ**
A: é€šå¸¸ 1-3 åˆ†é’Ÿ,å–å†³äºç½‘ç»œé€Ÿåº¦å’Œæœºå™¨æ€§èƒ½ã€‚

**Q: å¯ä»¥è·³è¿‡ç¡®è®¤å—ï¼Ÿ**
A: å½“å‰ä¸æ”¯æŒã€‚ä¸ºäº†å®‰å…¨,æ€»æ˜¯éœ€è¦ç”¨æˆ·ç¡®è®¤ã€‚

**Q: å¯ä»¥è‡ªåŠ¨æ›´æ–°å—ï¼Ÿ**
A: ä¸å»ºè®®å®Œå…¨è‡ªåŠ¨åŒ–ã€‚å¯ä»¥è‡ªåŠ¨æ£€æŸ¥(`--check`),ä½†æ‰§è¡Œæ›´æ–°å»ºè®®æ‰‹åŠ¨ç¡®è®¤ã€‚

**Q: æ›´æ–°å¤±è´¥ä¼šå½±å“å½“å‰ç‰ˆæœ¬å—ï¼Ÿ**
A: ä¸ä¼šã€‚åªæœ‰æˆåŠŸç¼–è¯‘åæ‰ä¼šæ›¿æ¢æ—§ç‰ˆæœ¬ã€‚

**Q: èƒ½çœ‹åˆ°è¯¦ç»†çš„ç¼–è¯‘è¾“å‡ºå—ï¼Ÿ**
A: å¯ä»¥ã€‚æ›´æ–°æ—¶ä¼šå®æ—¶æ˜¾ç¤ºæ‰€æœ‰ cargo çš„è¾“å‡ºä¿¡æ¯ã€‚
