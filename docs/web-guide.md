# CCR Web 界面使用指南

本指南详细介绍 CCR Web 界面的功能和使用方法。

## 启动 Web 服务

### 基本用法

```bash
# 使用默认端口 8080，自动打开浏览器
ccr web

# 指定端口
ccr web --port 3000

# 不自动打开浏览器（适合远程服务器）
ccr web --no-browser

# 指定端口且不打开浏览器
ccr web --port 9000 --no-browser
```

### 启动输出

```
2025-10-31 16:05:12 [INFO] 🔄 系统信息缓存后台线程已启动，更新间隔: 2s
✓ 🌐 CCR Web 服务器已启动（异步模式）
ℹ 📍 地址: http://localhost:8080
ℹ ⏹️ 按 Ctrl+C 停止服务器
💡 请手动访问 http://localhost:8080
```

::: tip 智能端口绑定
如果指定的端口已被占用，CCR 会自动尝试其他可用端口（如 8081、8082 等），确保服务能够成功启动。实际使用的端口会在启动信息中显示。
:::

## 界面概览

CCR Web 采用现代化的三栏式布局设计：

### 布局结构

```
┌────────────────────────────────────────────────────────────────┐
│  ⚡ CCR Multi-Platform Console    🌙 刷新 导入 导出 ➕添加配置│ ← 顶部导航栏
├────────────────────────────────────────────────────────────────┤
│  🤖 Claude  💻 Codex  ✨ Gemini  🌟 Qwen  ⚡ iFlow            │ ← 平台切换栏
├──────────┬─────────────────────────────────────────┬──────────┤
│  左侧栏  │           中央内容区                    │  右侧栏  │
│          │                                          │          │
│  当前配置│  📋 配置列表                            │  快速导航│
│  平台状态│  📚 历史记录                            │          │
│  系统信息│  ☁️ 云同步                              │          │
│  统计信息│                                          │          │
│  快捷操作│                                          │          │
└──────────┴─────────────────────────────────────────┴──────────┘
```

## 主要功能

### 1. 配置管理

#### 查看配置列表

配置列表以卡片形式展示，每张卡片包含：

- 配置名称和当前状态
- 提供商类型图标（🔄 官方中转 / 🤖 第三方模型）
- Base URL 和模型信息
- API Token（脱敏显示）
- 标签和提供商信息

#### 配置类型过滤

使用顶部过滤器快速筛选：

- 📋 **全部配置**：显示所有配置
- 🔄 **官方中转**：仅显示官方 API 中转服务
- 🤖 **第三方模型**：仅显示第三方模型服务
- ❓ **未分类**：显示未分类的配置

#### 切换配置

1. 在配置列表中找到目标配置
2. 点击 **"切换"** 按钮（当前配置显示为绿色 **"当前使用"**）
3. 系统自动更新 `~/.claude/settings.json`
4. 配置立即生效

#### 添加配置

1. 点击顶部导航栏的 **"➕ 添加配置"** 按钮
2. 填写配置表单：
   - **配置名称** *（必填）：唯一标识符
   - **描述**：配置说明
   - **Base URL** *（必填）：API 端点地址
   - **Auth Token** *（必填）：认证令牌
   - **Model**：默认模型名称
   - **Small Fast Model**：快速模型（可选）
   - **提供商类型**：官方中转 / 第三方模型 / 未分类
   - **提供商名称**：如 anyrouter, glm, moonshot
   - **账号标识**：用于区分同一提供商的不同账号
   - **标签**：用逗号分隔，如 `free, stable, backup`
3. 点击 **"保存"** 按钮

#### 编辑配置

1. 在配置卡片中点击 **"✎ 编辑"** 按钮
2. 修改配置信息（配置名称不可更改）
3. 点击 **"保存"** 按钮

#### 删除配置

1. 在配置卡片中点击 **"🗑️ 删除"** 按钮
2. 确认删除操作
3. 配置将从 `~/.ccs_config.toml` 中移除

::: warning 删除警告
删除配置不可恢复，请谨慎操作。如果删除当前使用的配置，需要手动切换到其他配置。
:::

### 2. 多平台支持（Unified Mode）

在 Unified Mode 下，顶部会显示平台切换栏，支持管理多个 AI CLI 平台：

#### 支持的平台

- 🤖 **Claude** - Claude Code AI Assistant
- 💻 **Codex** - GitHub Copilot CLI
- ✨ **Gemini** - Google Gemini CLI
- 🌟 **Qwen** - Alibaba Tongyi Qianwen CLI
- ⚡ **iFlow** - iFlow CLI

#### 平台切换

1. 点击平台标签切换到对应平台
2. 每个平台独立管理自己的配置列表
3. 平台徽章显示配置数量
4. 当前激活平台高亮显示

### 3. 历史记录

查看所有操作的完整审计日志：

#### 显示内容

每条历史记录包含：

- **操作类型**：Switch / Add / Delete / Export / Import 等
- **时间戳**：精确到秒
- **操作 ID**：UUID 唯一标识
- **执行者**：系统用户名
- **操作详情**：具体变更内容
- **结果状态**：✅ 成功 / ❌ 失败 / ⚠️ 警告

#### 使用场景

- 审计配置变更记录
- 追踪问题操作
- 了解配置切换历史
- 回溯配置变更时间

### 4. 云同步（WebDAV）

CCR 支持通过 WebDAV 协议将配置同步到云端。

#### 配置云同步

1. 切换到 **"☁️ 云同步"** 标签页
2. 勾选 **"启用 WebDAV 同步"**
3. 填写 WebDAV 配置：
   - **WebDAV URL**：云存储服务地址（如坚果云）
   - **用户名**：WebDAV 账号
   - **密码**：WebDAV 密码
   - **远程路径**：云端存储路径（默认 `/ccr/`）
4. 点击 **"保存并测试连接"** 验证配置

#### 同步操作

**Push（上传）**：
1. 配置完成后，点击 **"📤 Push 上传"** 按钮
2. 本地配置将上传到云端
3. 如需强制覆盖云端文件，勾选 **"Push 强制覆盖"**

**Pull（下载）**：
1. 点击 **"📥 Pull 下载"** 按钮
2. 云端配置将下载到本地
3. 如需强制覆盖本地文件，勾选 **"Pull 强制覆盖"**

::: tip 同步建议
- 首次同步建议先备份本地配置
- 多设备同步时注意避免配置冲突
- 定期 Push 确保云端配置最新
:::

### 5. 系统信息监控

左侧边栏实时显示系统状态：

#### 监控项目

- 💻 **主机名**：当前主机标识
- 🖥️ **操作系统**：系统类型和版本
- ⚙️ **CPU 信息**：处理器型号
- 📊 **CPU 使用率**：实时进度条 + 百分比
- 💾 **内存使用**：已用/总内存 + 进度条
- ⏱️ **系统运行时间**：系统启动时长

::: info 更新频率
系统信息每 2 秒自动更新一次，无需手动刷新。
:::

### 6. 配置验证

#### 验证功能

点击左侧边栏的 **"✓ 验证"** 按钮，系统会检查：

- 配置文件格式是否正确
- 所有配置段的完整性
- Claude Code 设置文件状态
- 必需的环境变量

#### 验证结果

验证完成后会显示：
- ✅ 验证通过的项目
- ❌ 验证失败的项目及原因
- ⚠️ 警告信息和建议

### 7. 备份清理

智能清理旧备份文件，释放磁盘空间。

#### 清理步骤

1. 点击左侧边栏的 **"🗑️ 清理备份"** 按钮
2. 在对话框中设置 **"保留天数"**（默认 7 天）
3. 勾选 **"模拟运行"** 预览清理效果
4. 点击 **"预览"** 查看待清理文件列表
5. 确认无误后，点击 **"执行清理"**

#### 清理说明

- 系统自动保留最近 10 个备份
- 清理操作仅删除超过指定天数的备份
- 预览模式不会实际删除文件
- 显示预计释放的磁盘空间

### 8. 导入/导出

#### 导出配置

1. 点击顶部导航栏的 **"📤 导出"** 按钮
2. 选择是否 **"包含敏感信息（API 密钥）"**
3. 点击 **"📥 下载配置文件"**
4. 浏览器自动下载 `.toml` 配置文件

#### 导入配置

1. 点击顶部导航栏的 **"📥 导入"** 按钮
2. 点击 **"选择文件"** 上传 `.toml` 配置文件
3. 选择导入模式：
   - **合并**：保留现有配置，添加/更新导入的配置
   - **替换**：完全替换为导入的配置
4. 勾选 **"导入前备份当前配置"**（推荐）
5. 预览文件内容
6. 点击 **"执行导入"**

::: warning 导入警告
- 替换模式会删除所有现有配置，请谨慎使用
- 建议导入前勾选备份选项
- 导入后验证配置完整性
:::

### 9. 主题切换

点击顶部导航栏的 **"🌙"** 按钮在明暗主题之间切换：

- **明亮主题**：适合白天使用，图标显示为 🌙
- **暗黑主题**：适合夜间使用，图标显示为 ☀️

主题偏好保存在浏览器本地存储中，下次访问自动恢复。

## 使用场景

### 场景 1：日常配置管理

```bash
# 启动 Web 服务
ccr web

# 浏览器访问 http://localhost:8080
# 在界面中查看、切换、添加配置
# 查看操作历史
# 按 Ctrl+C 停止服务
```

### 场景 2：团队协作

在服务器上部署 CCR Web 服务，团队成员通过浏览器统一管理配置：

```bash
# 在服务器上启动（不打开浏览器）
ccr web --port 8080 --no-browser

# 团队成员访问 http://server-ip:8080
```

::: warning 安全提示
如需远程访问，建议：
- 使用 SSH 端口转发
- 通过 VPN 连接
- 使用反向代理（nginx/caddy）+ HTTPS
- 防火墙限制访问 IP
:::

### 场景 3：远程管理

通过 SSH 端口转发在本地管理远程服务器的配置：

```bash
# 在远程服务器上启动
ccr web --no-browser

# 在本地建立 SSH 隧道
ssh -L 8080:localhost:8080 user@remote-server

# 本地浏览器访问 http://localhost:8080
```

### 场景 4：配置迁移

使用导入/导出功能在不同机器间迁移配置：

```bash
# 机器 A：导出配置
# 在 Web 界面点击"导出"，下载 ccr-config.toml

# 机器 B：导入配置
# 在 Web 界面点击"导入"，上传 ccr-config.toml
# 选择"合并"模式，保留现有配置
```

## RESTful API

Web 服务提供完整的 RESTful API，支持编程访问。

### 主要端点

#### 配置管理

```http
GET    /api/configs           # 列出所有配置
POST   /api/switch            # 切换配置
POST   /api/config            # 创建新配置
POST   /api/config/{name}     # 更新配置
DELETE /api/config/{name}     # 删除配置
```

#### 设置和历史

```http
GET    /api/settings          # 获取当前 Claude 设置
GET    /api/settings/backups  # 列出备份文件
POST   /api/settings/restore  # 恢复备份
GET    /api/history           # 查看操作历史
```

#### 操作

```http
POST   /api/validate          # 验证配置
POST   /api/export            # 导出配置
POST   /api/import            # 导入配置
POST   /api/clean             # 清理备份
GET    /api/system            # 获取系统信息
```

详细 API 文档请参考 [web 命令文档](/commands/web#restful-api)。

## 常见问题

### Q: 如何更改 Web 服务端口？

A: 使用 `--port` 选项指定端口：

```bash
ccr web --port 3000
```

如果端口被占用，CCR 会自动尝试其他端口。

### Q: 如何在远程服务器上使用 Web 界面？

A: 使用 SSH 端口转发：

```bash
# 服务器上
ccr web --no-browser

# 本地
ssh -L 8080:localhost:8080 user@server
# 然后访问 http://localhost:8080
```

### Q: Web 界面的主题设置会保存吗？

A: 是的，主题偏好保存在浏览器的 localStorage 中，下次访问会自动恢复。

### Q: 如何停止 Web 服务？

A: 在终端按 `Ctrl+C` 即可停止服务。

### Q: Web 界面和 TUI 有什么区别？

A:
- **Web 界面**：通过浏览器访问，支持多用户同时访问，更适合远程管理和团队协作
- **TUI**：终端界面，单用户使用，更适合本地快速管理

### Q: 导出的配置文件可以在其他机器上使用吗？

A: 可以。导出的 `.toml` 文件是标准格式，可以在任何安装了 CCR 的机器上导入。

## 下一步

- 查看 [web 命令详细文档](/commands/web)
- 查看 [配置管理文档](/configuration)
- 查看 [快速开始指南](/quick-start)

